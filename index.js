import{P as J}from"./assets/vendor-DcNUN_h1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Et=(window.API_BASE||"").trim(),yt="gc_user",_t="gc_token",Ut="gc_state";async function Ot(a,t){if(!Et)throw new Error("offline");const e=await fetch(Et+a,{credentials:"include",...t});if(!e.ok)throw new Error("http "+e.status);return e.json()}const pt={isAuthed:!1,user:null,token:null,async ensure(){const a=localStorage.getItem(_t),t=localStorage.getItem(yt);return a&&t?(this.isAuthed=!0,this.token=a,this.user=JSON.parse(t),!0):Et?(this.isAuthed=!1,!1):(this.isAuthed=!0,this.user={id:"guest",email:"guest@local"},this.token="guest",localStorage.setItem(yt,JSON.stringify(this.user)),localStorage.setItem(_t,this.token),!0)},async register({email:a,password:t}){try{const e=await Ot("/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});return this.isAuthed=!0,this.user=e.user,this.token=e.token,localStorage.setItem(yt,JSON.stringify(this.user)),localStorage.setItem(_t,this.token),{ok:!0,offline:!1}}catch{const e={id:a,email:a},s="dev-"+btoa(a).slice(0,16);return this.isAuthed=!0,this.user=e,this.token=s,localStorage.setItem(yt,JSON.stringify(e)),localStorage.setItem(_t,s),{ok:!0,offline:!0}}},async login({email:a,password:t}){try{const e=await Ot("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});return this.isAuthed=!0,this.user=e.user,this.token=e.token,localStorage.setItem(yt,JSON.stringify(this.user)),localStorage.setItem(_t,this.token),{ok:!0,offline:!1}}catch{const e={id:a||"guest",email:a||"guest@local"},s="dev-"+btoa((a||"guest")+Date.now()).slice(0,16);return this.isAuthed=!0,this.user=e,this.token=s,localStorage.setItem(yt,JSON.stringify(e)),localStorage.setItem(_t,s),{ok:!0,offline:!0}}},logout(){this.isAuthed=!1,this.user=null,this.token=null,localStorage.removeItem(yt),localStorage.removeItem(_t)}},Ct={async loadState(){try{return await Ot("/state",{method:"GET"})}catch{const a=localStorage.getItem(Ut);return a?JSON.parse(a):null}},async saveState(a){localStorage.setItem(Ut,JSON.stringify(a));try{return await Ot("/state",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch{return{ok:!0,offline:!0}}}},v={_s:Object.create(null),get(a,t){return Object.prototype.hasOwnProperty.call(this._s,a)?this._s[a]:t},set(a,t){return this._s[a]=t,this._save(),t},setMany(a){Object.assign(this._s,a),this._save()},has(a){return Object.prototype.hasOwnProperty.call(this._s,a)},del(a){this.has(a)&&(delete this._s[a],this._save())},clear(){this._s=Object.create(null),this._save()},_persist:!1,_lsKey:"rf.vm",init({persist:a=!1,key:t}={}){if(this._persist=!!a,t&&(this._lsKey=t),this._persist)try{const e=localStorage.getItem(this._lsKey);e&&(this._s=JSON.parse(e)||Object.create(null))}catch{this._s=Object.create(null)}return this},_save(){if(this._persist)try{localStorage.setItem(this._lsKey,JSON.stringify(this._s))}catch{}},resetClock(){this.del("clockAnchorMs"),this.del("clockOffsetMin"),this.del("clockDayLengthMin")},snapshotFromStart(a){var t,e,s,i;this.setMany({gear:a.gear,keepnet:a.keepnet,wallet:a.wallet,rigDepthM:a.rigDepthM,inventory:a.inventory,keepnetCap:a.keepnetCap??25,locationId:((e=(t=a.locationMgr)==null?void 0:t.getCurrentId)==null?void 0:e.call(t))||((s=a.locationMgr)==null?void 0:s.current)||"lake",level:((i=a.progress)==null?void 0:i.level)??this.get("level",1)})},defaults(){return{gear:null,keepnet:[],wallet:{coins:0,gold:0},keepnetCap:25,rigDepthM:1.2,locationId:"lake",level:1,inventory:{rods:["rod_wood_1"],reels:["reel_rusty"],lines:["line_old_1"],hooks:["hook_rusty"],bait:{worm:25},hookPacks:{hook_rusty:5}}}}};class we{constructor(t,e,s){this.scene=t;let i,o,n;typeof e=="number"?(n=e,i=s,o={}):(i=e,o=s||{}),this.gear=i||{},this.onClick=o;const r=t.scale.width,h=t.scale.height;this.MARGIN_X=16,this.GAP=10,this.SIZE=Math.min(96,Math.floor((r-this.MARGIN_X*2-this.GAP*4)/5)),this.h=this.SIZE,this.yBottom=typeof n=="number"?n:h-12,this.yTop=this.yBottom-this.h,this.items=["rod","reel","line","hook","bait"],this.icons={rod:"üé£",reel:"üéõÔ∏è",line:"üßµ",hook:"ü™ù",bait:"ü™±"},this.xs=[];for(let l=0;l<5;l++)this.xs.push(this.MARGIN_X+l*(this.SIZE+this.GAP));this._elems=[],this.items.forEach((l,c)=>{const d=this.xs[c],f=t.add.graphics().setDepth(700);f.fillStyle(1119522,.9),f.fillRoundedRect(d,this.yTop,this.SIZE,this.SIZE,14),f.lineStyle(2,16777215,.18),f.strokeRoundedRect(d,this.yTop,this.SIZE,this.SIZE,14);const u=t.add.text(d+this.SIZE/2,this.yTop+16,this.icons[l],{fontFamily:"Arial, sans-serif",fontSize:"34px",color:"#ffffff"}).setOrigin(.5,0).setDepth(701),p=t.add.text(d+this.SIZE/2,this.yTop+this.SIZE-22,"",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#dfeaff"}).setOrigin(.5,0).setDepth(701),g=t.add.zone(d,this.yTop,this.SIZE,this.SIZE).setOrigin(0,0).setInteractive().setDepth(702);g.on("pointerdown",()=>{var _;const m=(_=this.onClick)==null?void 0:_[l];typeof m=="function"&&m()}),this._elems.push({bg:f,icon:u,value:p,hit:g,key:l})}),this.update(this.gear)}update(t){var i;const e=t||this.gear||{},s={rod:e.rod?`${e.rod.capKg} –∫–≥`:"",line:e.line?`${e.line.capKg} –∫–≥`:"",reel:e.reel&&e.reel.pullBoost!=null?`${Math.round(e.reel.pullBoost*100)}%`:"",hook:e.hook&&e.hook.count!=null?`${e.hook.count} —à—Ç`:"",bait:`√ó ${((i=e.inv)==null?void 0:i.bait)??0}`};this._elems.forEach(o=>o.value.setText(s[o.key]??""))}setVisible(t){this._elems.forEach(({bg:e,icon:s,value:i,hit:o})=>{e.setVisible(t),s.setVisible(t),i.setVisible(t),o.setInteractive(t)})}}const re=[{id:"crucian",name:"–ö–∞—Ä–∞—Å—å",rarity:"common",baseWeight:[.2,2.3],weightBias:1.7,marketMinKg:.8,pricePerKg:4,wholesaleFactor:.6,info:"–ù–µ–ø—Ä–∏—Ö–æ—Ç–ª–∏–≤—ã–π, –¥–µ—Ä–∂–∏—Ç—Å—è —É —Ç—Ä–∞–≤—ã –∏ –∫—Ä–æ–º–æ–∫, –ª—é–±–∏—Ç —Ç—ë–ø–ª—É—é –≤–æ–¥—É –∏ –ø—Ä–∏–∫–æ—Ä–º.",habitats:["lake","pond"],prefers:{baits:["worm","bread","corn"],time:["dawn","day","evening"],depth:[.3,2.5]}},{id:"roach",name:"–ü–ª–æ—Ç–≤–∞",rarity:"common",baseWeight:[.1,1.2],weightBias:1.6,marketMinKg:.6,pricePerKg:3,wholesaleFactor:.6,info:"–°—Ç–∞–∏ –¥–µ—Ä–∂–∞—Ç—Å—è –Ω–∞ –±—Ä–æ–≤–∫–∞—Ö –∏ —É –∫—É–≤—à–∏–Ω–æ–∫, —Ö–æ—Ä–æ—à–æ –±–µ—Ä—ë—Ç —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å–∞–¥–∫–∏.",habitats:["lake","river"],prefers:{baits:["worm","bread"],time:["dawn","day","evening"],depth:[.4,3]}},{id:"bleak",name:"–£–∫–ª–µ–π–∫–∞",rarity:"common",baseWeight:[.03,.15],weightBias:1.2,marketMinKg:.1,pricePerKg:2.2,wholesaleFactor:.55,info:"–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–∞—è —Å—Ç–∞–π–Ω–∞—è —Ä—ã–±–∞, —á–∞—Å—Ç–æ –Ω–∞ –º–µ–ª–∫–æ–≤–æ–¥—å–µ –∏ –ø–æ–¥ —Å–∞–º–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç—å—é –≤–æ–¥—ã.",habitats:["lake","river"],prefers:{baits:["bread","worm"],time:["dawn","day","evening"],depth:[.1,1]}},{id:"bream",name:"–õ–µ—â",rarity:"uncommon",baseWeight:[.6,3],weightBias:1.7,marketMinKg:1.2,pricePerKg:6,wholesaleFactor:.65,info:"–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —Å–≤–∞–ª—ã –∏ —è–º—ã, –∞–∫—Ç–∏–≤–Ω–µ–µ —Å—É–º–µ—Ä–∫–∞–º–∏ –∏ –Ω–æ—á—å—é. –õ—é–±–∏—Ç –ø—Ä–∏–∫–æ—Ä–º.",habitats:["lake","river"],prefers:{baits:["worm","corn"],time:["dawn","evening","night"],depth:[1.5,6]}},{id:"tench",name:"–õ–∏–Ω—å",rarity:"uncommon",baseWeight:[.4,2.8],weightBias:1.7,marketMinKg:1,pricePerKg:7,wholesaleFactor:.7,info:"–¢–∏—Ö–∏–µ –∑–∞—Ä–æ—Å—à–∏–µ –∑–∞–ª–∏–≤—ã; –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ –∑–æ—Ä—è—Ö.",habitats:["lake","pond"],prefers:{baits:["worm","corn"],time:["dawn","evening"],depth:[.5,2.5]}},{id:"ide",name:"–Ø–∑—å",rarity:"uncommon",baseWeight:[.5,2.5],weightBias:1.6,marketMinKg:1.2,pricePerKg:6,wholesaleFactor:.65,info:"–°–∏–ª—å–Ω–∞—è —Ä—ã–±–∞ —Å—Ç—Ä—É–π –∏ –æ–±—Ä–∞—Ç–æ–∫; –∫–ª—é—ë—Ç –Ω–∞ –∂–∏–≤–æ—Ç–Ω—ã–µ –∏ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å–∞–¥–∫–∏.",habitats:["lake","river"],prefers:{baits:["worm","bread"],time:["dawn","day","evening"],depth:[.5,2.5]}},{id:"rudd",name:"–ö—Ä–∞—Å–Ω–æ–ø—ë—Ä–∫–∞",rarity:"common",baseWeight:[.05,.6],weightBias:1.5,marketMinKg:.25,pricePerKg:3.5,wholesaleFactor:.6,info:"–õ—é–±–∏—Ç –∫—É–≤—à–∏–Ω–∫–∏ –∏ –∫—Ä–æ–º–∫–∏ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏; –±–µ—Ä—ë—Ç –ª—ë–≥–∫–∏–µ –Ω–∞—Å–∞–¥–∫–∏ –≤ –ø–æ–ª–≤–æ–¥—ã.",habitats:["lake","pond","river"],prefers:{baits:["bread","worm"],time:["dawn","day","evening"],depth:[.3,2]}},{id:"silver_bream",name:"–ì—É—Å—Ç–µ—Ä–∞",rarity:"common",baseWeight:[.2,1.2],weightBias:1.7,marketMinKg:.6,pricePerKg:3.8,wholesaleFactor:.6,info:"–†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏—Ü–∞ –ª–µ—â–∞; –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç –ø–æ–≥–ª—É–±–∂–µ –∏ –∞–∫—Ç–∏–≤–Ω–∞ —Å—É–º–µ—Ä–∫–∞–º–∏.",habitats:["lake","river"],prefers:{baits:["worm"],time:["dawn","evening","night"],depth:[1.5,4]}},{id:"dace",name:"–ï–ª–µ—Ü",rarity:"common",baseWeight:[.05,.4],weightBias:1.5,marketMinKg:.2,pricePerKg:3.2,wholesaleFactor:.6,info:"–ú–µ–ª–∫–∏–µ –±—ã—Å—Ç—Ä—ã–µ —Å—Ç—Ä—É–∏, —á–∏—Å—Ç–∞—è –≤–æ–¥–∞; –ª—é–±–∏—Ç –º–µ–ª–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –Ω–∞—Å–∞–¥–∫–∏.",habitats:["river"],prefers:{baits:["worm","bread"],time:["dawn","day","evening"],depth:[.3,2]}},{id:"chub",name:"–ì–æ–ª–∞–≤–ª—å",rarity:"uncommon",baseWeight:[.4,3],weightBias:1.6,marketMinKg:1,pricePerKg:7,wholesaleFactor:.7,info:"–ü–µ—Ä–µ–∫–∞—Ç—ã –∏ –∫–æ—Ä—è–∂–Ω–∏–∫; –ø–æ–ª—É-—Ö–∏—â–Ω–∏–∫, –±–µ—Ä—ë—Ç –Ω–∞—Å–∞–¥–∫–∏ –∏ –≤–µ—Ä—Ç—É—à–∫–∏.",habitats:["river"],prefers:{baits:["worm","bread","spinner"],time:["dawn","day","evening"],depth:[.4,2.5]}},{id:"perch",name:"–û–∫—É–Ω—å",rarity:"common",baseWeight:[.2,1.5],weightBias:1.5,marketMinKg:.6,pricePerKg:5,wholesaleFactor:.65,info:"–°—Ç–∞–∏ —É –∫–æ—Ä—è–∂–Ω–∏–∫–∞ –∏ —Å–≤–∞–ª–æ–≤; —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –±–ª—ë—Å–Ω—ã –∏ –º–∞–ª—å–∫–∞.",habitats:["lake","river"],prefers:{baits:["worm","spinner","fish"],time:["dawn","day","evening"],depth:[.5,4]}},{id:"pike",name:"–©—É–∫–∞",rarity:"rare",baseWeight:[.8,3.5],weightBias:1.8,marketMinKg:2,pricePerKg:9,wholesaleFactor:.7,info:"–ê–º–±—É—à—é—Ä–Ω—ã–π —Ö–∏—â–Ω–∏–∫ —É —Ç—Ä–∞–≤—ã; –ø–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Äî —Ä–∞—Å—Å–≤–µ—Ç –∏ –∑–∞–∫–∞—Ç.",habitats:["lake","river"],prefers:{baits:["fish","spinner"],time:["dawn","evening","day"],depth:[.5,3.5]}},{id:"zander",name:"–°—É–¥–∞–∫",rarity:"rare",baseWeight:[1,6],weightBias:1.9,marketMinKg:1.8,pricePerKg:10,wholesaleFactor:.72,info:"–ì–ª—É–±–æ–∫–∏–µ –±—Ä–æ–≤–∫–∏; –∞–∫—Ç–∏–≤–µ–Ω –≤ —Ç–µ–º–Ω–æ—Ç–µ –∏ –Ω–∞ –∑–æ—Ä—è—Ö.",habitats:["lake","river"],prefers:{baits:["fish","spinner"],time:["dawn","evening","night"],depth:[2,8]}},{id:"asp",name:"–ñ–µ—Ä–µ—Ö",rarity:"rare",baseWeight:[1,4],weightBias:1.8,marketMinKg:1.5,pricePerKg:9,wholesaleFactor:.7,info:"–ü–µ–ª–∞–≥–∏—á–µ—Å–∫–∏–π —Ä–µ—á–Ω–æ–π —Ö–∏—â–Ω–∏–∫; –≤—ã—Ö–æ–¥–∏—Ç –±–∏—Ç—å –º–∞–ª—å–∫–∞ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ.",habitats:["river"],prefers:{baits:["spinner","fish"],time:["dawn","day"],depth:[.5,3]}},{id:"burbot",name:"–ù–∞–ª–∏–º",rarity:"uncommon",baseWeight:[.6,3],weightBias:1.7,marketMinKg:1,pricePerKg:7,wholesaleFactor:.7,info:"–ù–æ—á–Ω–æ–π —Ö–æ–ª–æ–¥–æ–ª—é–±–∏–≤—ã–π —Ö–∏—â–Ω–∏–∫; –¥–µ—Ä–∂–∏—Ç—Å—è —è–º, –±–µ—Ä—ë—Ç –Ω–∞ —Ä—ã–±—å–∏ –∫—É—Å–∫–∏ –∏ —á–µ—Ä–≤—è.",habitats:["lake","river"],prefers:{baits:["fish","worm"],time:["night","dawn"],depth:[2,6]}},{id:"catfish",name:"–°–æ–º",rarity:"epic",baseWeight:[1.5,8],weightBias:2,marketMinKg:2.5,pricePerKg:11,wholesaleFactor:.75,info:"–ö—Ä—É–ø–Ω—ã–π –¥–æ–Ω–Ω—ã–π —Ö–∏—â–Ω–∏–∫; –∞–∫—Ç–∏–≤–µ–Ω –Ω–æ—á—å—é, –ª—é–±–∏—Ç —è–º—ã –∏ –∫–æ—Ä—è–∂–Ω–∏–∫.",habitats:["lake","river"],prefers:{baits:["fish","worm"],time:["night","evening"],depth:[2,8]}},{id:"carp",name:"–ö–∞—Ä–ø",rarity:"rare",baseWeight:[1,4],weightBias:1.9,marketMinKg:2,pricePerKg:8,wholesaleFactor:.7,info:"–°–∏–ª—å–Ω–∞—è –¥–æ–Ω–Ω–∞—è —Ä—ã–±–∞; –ª—é–±–∏—Ç –ø—Ä–∏–∫–æ—Ä–º–ª–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –∏ –æ–∫–Ω–∞ –≤ —Ç—Ä–∞–≤–µ.",habitats:["lake","pond"],prefers:{baits:["corn","bread","worm"],time:["dawn","day","evening"],depth:[1,5]}}],he=[{id:"loot_coins_small",kind:"loot",name:"–ö–æ—à–µ–ª—ë–∫ –º–æ–Ω–µ—Ç",rarity:"uncommon",habitats:["lake","river","pond"],prefers:{baits:["worm","bread"],time:["day","evening"],depth:[1,3]},reward:{coins:[50,150]}},{id:"chest_wood",kind:"loot",name:"–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —è—â–∏–∫",rarity:"rare",habitats:["lake"],prefers:{baits:["worm","bread","corn","fish"],time:["day","evening","night","dawn"],depth:[3,5]},reward:{coins:[2e3,6e4]}},{id:"crayfish",kind:"bycatch",name:"–†–∞–∫",rarity:"uncommon",habitats:["lake","river"],prefers:{baits:["worm"],time:["evening","night"],depth:[1,3]},sell:{price:2}},{id:"frog",kind:"bycatch",name:"–ñ–∞–±–∞",rarity:"common",habitats:["pond","lake"],prefers:{baits:["worm","bread"],time:["evening","night"],depth:[0,1]},sell:{price:1}},{id:"rusty_can",kind:"trash",name:"–†–∂–∞–≤–∞—è –±–∞–Ω–∫–∞",rarity:"common",habitats:["lake","river"],prefers:{baits:["worm","bread"],time:["day","evening"],depth:[0,1]},reward:{coins:[0,2]}},{id:"stick",kind:"trash",name:"–ü–∞–ª–∫–∞",rarity:"common",habitats:["lake"],prefers:{baits:["worm","bread"],time:["day","evening"],depth:[0,1]},reward:{coins:[0,1]}},{id:"grass_snake",kind:"bycatch",name:"–£–∂",rarity:"rare",habitats:["lake","river"],prefers:{baits:["fish","worm"],time:["day"],depth:[0,1]},reward:{coins:[1,3]}}],At={lake:{crucian:1.2,roach:1.1,perch:.9,ruffe:.8,bleak:.7,bream:.6,tench:.5,ide:.6,pike:.35,carp:.4,rudd:.9,silver_bream:.7,dace:0,chub:0,zander:.25,asp:0,burbot:.35,catfish:.15,minDepth:2,pike:.35,loot_coins_small:.06,chest_wood:.015,crayfish:.2,frog:.12,rusty_can:.15,stick:.12,grass_snake:.03},river:{crucian:.6,roach:1.2,perch:1,ruffe:1,bleak:1.1,bream:.7,tench:0,ide:.9,pike:.4,carp:.3},sea:{crucian:0,roach:0,perch:0,ruffe:0,bleak:0,bream:0,tench:0,ide:0,pike:0,carp:0}},ke=[...re.map(a=>({...a,kind:"fish"})),...he];function Yt(a,t){const e=(At[a]||{})[t];return e==null?0:typeof e=="number"?e:e.w??1}function Se(a,t){var s;const e=(s=a==null?void 0:a.prefers)==null?void 0:s.time;return!e||!Array.isArray(e)||e.length===0?!0:e.includes(t)}function Me(a,t){const e=(At[a]||{})[t];return e&&typeof e=="object"?[e.minDepth??-1/0,e.maxDepth??1/0]:[-1/0,1/0]}function ve(a){var s;const t=a.reduce((i,[,o])=>i+o,0);if(t<=0)return((s=a[0])==null?void 0:s[0])??null;let e=Math.random()*t;for(const[i,o]of a)if(e-=o,e<=0)return i;return a[a.length-1][0]}function Pe(a,t){var r,h;const[e,s]=a.baseWeight||[.2,2],i=a.weightBias??1.6,o=(h=(r=a.prefers)==null?void 0:r.baits)!=null&&h.includes(t)?i*.8:i,n=Math.pow(Math.random(),o);return+(e+n*(s-e)).toFixed(3)}function Ce(a,t){return Math.floor(a+Math.random()*(t-a+1))}function Ae(a){var t,e;if((t=a.reward)!=null&&t.coins){const[s,i]=a.reward.coins;return{coins:Ce(s,i)}}return(e=a.sell)!=null&&e.price?{coins:a.sell.price}:{}}function Te(a={}){var f,u;const t=a.bait??"worm",e=a.timeOfDay??"day",s=a.locationId??"lake",i=a.depthM??1.5;console.log("[spawnFish ctx]",{bait:t,tod:e,loc:s,depthM:i});const o=ke.filter(p=>{var b,y,k,P;if(p.habitats&&!p.habitats.includes(s))return console.log("‚Äì",p.id,"–Ω–µ—Ç –≤ habitat",s),!1;if((b=p.prefers)!=null&&b.baits&&!p.prefers.baits.includes(t))return console.log("‚Äì",p.id,"bait!=",t),!1;if(!Se(p,e))return console.log("‚Äì",p.id,"time!=",e,"need one of",(y=p.prefers)==null?void 0:y.time),!1;if(((P=(k=p.prefers)==null?void 0:k.depth)==null?void 0:P.length)===2){const[M,I]=p.prefers.depth;if(i<M||i>I)return console.log("‚Äì",p.id,`depth ${i} ‚àâ [${M}, ${I}]`),!1}const[g,m]=Me(s,p.id);return i<g||i>m?(console.log("‚Äì",p.id,`depth ${i} ‚àâ table[${g}, ${m}]`),!1):Yt(s,p.id)>0?!0:(console.log("‚Äì",p.id,"weight=0"),!1)});if(!o.length)return console.warn("[spawnFish] no candidates after filters",{loc:s,d:i,bait:t,tod:e}),null;const n=o;if(!n.length)return console.warn("[spawnFish] empty pool",{loc:s,d:i,bait:t,tod:e}),null;const r=(p,g)=>typeof a.getAreaMods=="function"?a.getAreaMods(p,g):typeof a.getSpotMods=="function"?a.getSpotMods(p,g):null,h={fish:1,loot:.06,bycatch:.12,trash:.1},l=n.map(p=>{var m,_;let g=Yt(s,p.id)*(h[p.kind]??1);if(p.kind==="fish"&&a.cast){const b=(_=(m=r(a.cast.x,a.cast.y))==null?void 0:m.species)==null?void 0:_[p.id];b&&(g*=b)}return[p,Math.max(0,g)]});console.log("[spawnFish pool]",n.map(p=>`${p.kind}:${p.id}`)),console.table(l.map(([p,g])=>({id:p.id,kind:p.kind,w:g})));const c=ve(l)||l[0][0],d=(f=l.find(([p])=>p.id===c.id))==null?void 0:f[1];if(console.log("[spawnFish chosen]",c.kind,c.id,"w=",d,"depth=",i),c.kind==="fish"){const p=Pe(c,t);return{kind:"fish",id:c.id,name:c.name,weightKg:p,priceKg:c.pricePerKg??1,maxKg:((u=c.baseWeight)==null?void 0:u[1])??p,spec:c}}else{const p=Ae(c);return{kind:c.kind,id:c.id,name:c.name,reward:p,spec:c}}}const jt={tension:{fillTimeAt1:.9,curveAlpha:1.2,downPerSec:150},speeds:{basePull:1500,baseFish:7,minPull:30,minFish:18,hookQPullBonus:.25,heavinessFishBonus:.1},caps:{fishCapBase:1.12,fishCapByMiss:.08},escape:{base:3.2,byHookQ:1.4,byHookCtrl:.5,byMeanRatio:.4,byEndurance:.6},jerk:{minMs:2400,maxMs:3600,baseAdd:5,addPerHeav:12,maxAdd:22,chance:.65,burstChanceScale:.2},env:{currentToFish:.3,wavesToFish:.1,vegToPlayer:-.1},hook:{penaltyPerRigM:.15},slip:{base:.12,byHookCtrl:-.04,byHookQ:-.03,byMeanRatio:.05},side:{baseFactor:.75}},ct=(a,t,e)=>Math.max(t,Math.min(e,a)),Ie=Math.pow;function De(a,t,e,s={}){var L,Y,j,nt,Q,et;const i=le(jt,s.tuning||{}),o=s.env||{},n=ct(s.difficulty??.5,0,1),r=((L=a==null?void 0:a.rod)==null?void 0:L.capKg)??1,h=((Y=a==null?void 0:a.line)==null?void 0:Y.capKg)??1,l=((j=a==null?void 0:a.reel)==null?void 0:j.pullBoost)??1,c=((nt=a==null?void 0:a.hook)==null?void 0:nt.control)??1,d=Math.max(.001,(t==null?void 0:t.weightKg)??.5),f=(t==null?void 0:t.spec)||(t==null?void 0:t.meta)||{},u=f.aggression??f.agg??1,p=f.burstiness??1,g=f.endurance??1,m=f.agility??1,_=d/r,b=d/h,y=(_+b)*.5,k=ct((s.rigDeltaM??0)*(((Q=i.hook)==null?void 0:Q.penaltyPerRigM)??0),0,.9),P=ct((e??0)-k,0,1),M=100/Math.max(.01,i.tension.fillTimeAt1),I=i.tension.curveAlpha,x=1+.1*(n-.5)*2,A=mt=>M*Ie(Math.max(mt,.01),I)*x,F=A(_),C=A(b),T=i.tension.downPerSec,B=1+(o.current??0)*i.env.currentToFish+(o.waves??0)*i.env.wavesToFish,K=1+(o.vegetation??0)*i.env.vegToPlayer,D=i.speeds.basePull,S=i.speeds.baseFish;let w=D*l*(1+i.speeds.hookQPullBonus*P)*K,W=S*u*(1+i.speeds.heavinessFishBonus*(y-1))/Math.max(.25,c)*B;w=Math.max(i.speeds.minPull,w),W=Math.max(i.speeds.minFish,W);const z=i.caps.fishCapBase+(1-P)*i.caps.fishCapByMiss;W=Math.min(W,w*z);const R=Math.max(2,i.escape.base+i.escape.byHookQ*P+i.escape.byHookCtrl*(c-1)-i.escape.byMeanRatio*(y-1)-i.escape.byEndurance*(g-1)),E=Math.max(0,y-.3),X=ct(i.jerk.baseAdd+Math.min(i.jerk.maxAdd,i.jerk.addPerHeav*E)*ct(p,.5,1.5),2,i.jerk.maxAdd),H=ct(i.jerk.chance*(1+i.jerk.burstChanceScale*(p-1))*(1+.08*(y-1)),.05,.95),G=ct(i.slip.base+i.slip.byHookCtrl*(c-1)+i.slip.byHookQ*(P-.5)*2+i.slip.byMeanRatio*(y-1),.02,.45);return{rodUp:F,lineUp:C,down:T,pullSpeed:w,fishPullSpeed:W,escapeLimit:R,ratioRod:_,ratioLine:b,jerk:{add:X,minMs:i.jerk.minMs,maxMs:i.jerk.maxMs,chance:H},sideFactor:(((et=jt.side)==null?void 0:et.baseFactor)??.75)*ct(m,.6,1.4),baseSlipChance:G,debug:{meanRatio:y,effHookQ:P,rigPenalty:k,envFishK:B,envPullK:K}}}function le(a,t){if(!t)return a;const e={...a};for(const s in t)t[s]&&typeof t[s]=="object"&&!Array.isArray(t[s])?e[s]=le(a[s]??{},t[s]):e[s]=t[s];return e}class qt{constructor(t,e,s,i,o,n,r={}){this.scene=t,this.x=Math.round(e),this.yBottom=Math.round(s),this.w=Math.round(i),this.h=Math.round(o),this.value=0,this.enabled=!1,this.threshold=80,this.icon=r.icon||"",this.depth=r.depth??706,this.colors={bg:988452,border:16777215,fillIdle:10133670,fillSafe:3066993,fillDanger:15105570},this.g=t.add.graphics().setDepth(this.depth),this.text=t.add.text(this.x+10,this.yBottom-this.h/2,`${this.icon?this.icon+" ":""}${n}`,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#e8f1ff",fontStyle:"bold"}).setOrigin(0,.5).setDepth(this.depth+2),this.draw(0)}setThreshold(t){this.threshold=Phaser.Math.Clamp(t,1,99),this.draw(this.value)}setEnabled(t){this.enabled=!!t,this.text.setAlpha(this.enabled?1:.75),this.draw(this.value)}set(t){this.value=Phaser.Math.Clamp(t,0,100),this.draw(this.value)}setVisible(t){this.g.setVisible(t),this.text.setVisible(t)}destroy(){var t,e;(t=this.g)==null||t.destroy(),(e=this.text)==null||e.destroy()}draw(t){const{g:e,x:s,yBottom:i,w:o,h:n,threshold:r}=this,h=Math.floor(n/2),l=Phaser.Math.Clamp(t,0,100);e.clear(),e.fillStyle(this.colors.bg,this.enabled?.85:.6),e.fillRoundedRect(s,i-n,o,n,h),e.lineStyle(2,this.colors.border,this.enabled?.22:.15),e.strokeRoundedRect(s,i-n,o,n,h);const c=Math.max(2,Math.round(o*(l/100))),d=l>=r,f=this.enabled?d?this.colors.fillDanger:this.colors.fillSafe:this.colors.fillIdle;e.fillStyle(f,this.enabled?1:.7);const u=Math.min(h,Math.floor(c/2));e.fillRoundedRect(s,i-n,c,n,u);const p=Math.max(1,Math.floor(n*.35));if(e.fillStyle(16777215,this.enabled?.08:.05),e.fillRoundedRect(s,i-n,c,p,u),this.enabled){const g=Math.round(s+o*(r/100));e.lineStyle(1,16777215,.28),e.beginPath(),e.moveTo(g,i-n+2),e.lineTo(g,i-2),e.strokePath()}}}class Be{constructor(t,e,s){this.scene=t,this.slots=e;const i=12,o=e.xs[4]+e.SIZE+i,n=((s==null?void 0:s.x)??t.scale.width-16)-((s==null?void 0:s.width)??0)/2-i;this.w=Math.max(160,n-o),this.h=e.h,this.x=o,this.yTop=e.yTop,this.yBottom=e.yBottom,this.bg=t.add.graphics().setDepth(705),this.bg.fillStyle(1119522,.9),this.bg.fillRoundedRect(this.x,this.yTop,this.w,this.h,14),this.bg.lineStyle(2,16777215,.18),this.bg.strokeRoundedRect(this.x,this.yTop,this.w,this.h,14);const r=16,h=this.x+r,l=this.x+this.w-r,c=Math.max(60,l-h),d=18,f=14,u=this.yBottom-r;this.rodBar=new qt(t,h,u-(d+f),c,d,"–£–¥–æ—á–∫–∞",{icon:"üé£",depth:706}),this.lineBar=new qt(t,h,u,c,d,"–õ–µ—Å–∫–∞",{icon:"üßµ",depth:706}),this.yTopBars=this.yTop}setMode(t){const e=t==="fight";this.bg.setAlpha(e?.9:.55),this.rodBar.setEnabled(e),this.lineBar.setEnabled(e),e||(this.rodBar.set(0),this.lineBar.set(0))}setVisible(t){this.setMode(t?"fight":"idle")}set(t,e){this.rodBar.set(t),this.lineBar.set(e)}destroy(){this.bg.destroy(),this.rodBar.destroy(),this.lineBar.destroy()}}class Ft{constructor(t){this.scene=t,this.level=1,this.xp=0,this.totalXp=0,this.load()}xpNeeded(t){return Math.floor(5*Math.pow(t,1.35))}static rarityMult(t){return t==="rare"?2:t==="uncommon"?1.4:1}xpForFish(t){var n;const e=Math.max(0,(t==null?void 0:t.weightKg)||0),s=((n=t==null?void 0:t.species)==null?void 0:n.rarity)||"common",i=5+10*e,o=Ft.rarityMult(s);return Math.round(i*o)}grantCatchXP(t,{released:e=!1}={}){const s=this.xpForFish(t),i=e?s*2:s;return this.addXp(i)}addXp(t){let e=Math.max(0,Math.floor(t||0));this.totalXp+=e;let s=0;for(;e>0;){const i=this.xpNeeded(this.level)-this.xp;e>=i?(e-=i,this.level+=1,this.xp=0,s+=1):(this.xp+=e,e=0)}return this.save(),{leveled:s,level:this.level,xp:this.xp,toNext:this.xpNeeded(this.level)}}save(){try{localStorage.setItem("rf.progress",JSON.stringify({level:this.level,xp:this.xp,totalXp:this.totalXp}))}catch{}}load(){try{const t=localStorage.getItem("rf.progress");if(t){const e=JSON.parse(t);this.level=e.level||1,this.xp=e.xp||0,this.totalXp=e.totalXp||0}}catch{}}}class Re{constructor(t,e,s,i,o,n){this.scene=t,this.kind=e,this.list=s||[],this.activeId=i||null,this.onPick=o,this.onClose=n,this.killed=!1,this.depthBase=2e3,this.build(),this.layout(),this.bindResize()}build(){const t=this.scene,e=t.scale.width,s=t.scale.height;this.overlay=t.add.rectangle(0,0,e,s,0,.6).setOrigin(0,0).setDepth(this.depthBase).setInteractive(),this.panel=t.add.rectangle(0,0,560,380,2370102,1).setStrokeStyle(2,16777215,.22).setDepth(this.depthBase+1);const i={rod:"–£–¥–æ—á–∫–∏",reel:"–ö–∞—Ç—É—à–∫–∏",line:"–õ–µ—Å–∫–∏",hook:"–ö—Ä—é—á–∫–∏"}[this.kind]||"–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞";this.title=t.add.text(0,0,i,{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#ffffff"}).setOrigin(.5,0).setDepth(this.depthBase+2),this.btnClose=t.add.text(0,0,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(.5,0).setDepth(this.depthBase+2).setInteractive(),this.btnClose.on("pointerdown",()=>this.close()),this.listContainer=t.add.container(0,0).setDepth(this.depthBase+2),this.rows=[],this.list.forEach((o,n)=>{const r=this.buildRow(o);this.rows.push(r),this.listContainer.add([r.bg,r.name,r.sub,r.tick])})}buildRow(t){const e=this.scene,s=56,n=e.add.rectangle(0,0,100,s,3818840,1).setStrokeStyle(2,16777215,this.activeId===t.id?.35:.18).setInteractive();n.on("pointerover",()=>n.setFillStyle(4345958,1)),n.on("pointerout",()=>n.setFillStyle(3818840,1)),n.on("pointerdown",()=>{this.killed||this.pick(t)});const r=e.add.text(0,0,t.name||"‚Äî",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(0,.5),h=this.kind==="rod"?`–ü—Ä–æ—á–Ω–æ—Å—Ç—å: ${t.capKg} –∫–≥`:this.kind==="line"?`–ü—Ä–æ—á–Ω–æ—Å—Ç—å: ${t.capKg} –∫–≥`:this.kind==="reel"?`–¢—è–≥–∞: ${(t.pullBoost*100).toFixed(0)}%`:this.kind==="hook"?`–ö–æ–Ω—Ç—Ä–æ–ª—å: ${(t.control*100).toFixed(0)}%`:"",l=e.add.text(0,0,h,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#d6deea"}).setOrigin(0,.5),c=e.add.text(0,0,this.activeId===t.id?"‚úì":"",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#7ddc7a"}).setOrigin(1,.5);return{bg:n,name:r,sub:l,tick:c,rowH:s,it:t}}layout(){const t=this.scene,e=t.scale.width,s=t.scale.height,i=Math.min(560,e-120),o=Math.min(380,s-160);this.panel.setSize(i,o),this.panel.setPosition(e/2,s/2),this.title.setPosition(this.panel.x,this.panel.y-o/2+18),this.btnClose.setPosition(this.panel.x+i/2-22,this.panel.y-o/2+8);const n=18,r=this.panel.x-i/2+n,h=this.panel.y-o/2+62,l=i-n*2,c=8;let d=h;this.rows.forEach(f=>{f.bg.setSize(l,f.rowH),f.bg.setPosition(r+l/2,d+f.rowH/2);const u=r+14;f.name.setPosition(u,f.bg.y-8),f.sub.setPosition(u,f.bg.y+12),f.tick.setPosition(r+l-12,f.bg.y),d+=f.rowH+c}),this.overlay.setSize(e,s)}pick(t){this.rows.forEach(e=>{const s=e.it.id===t.id;e.tick.setText(s?"‚úì":""),e.bg.setStrokeStyle(2,16777215,s?.35:.18)});try{this.onPick&&this.onPick(t)}catch{}this.close()}bindResize(){this._onResize=()=>{this.killed||this.layout()},this.scene.scale.on("resize",this._onResize)}close(){if(!this.killed){this.killed=!0,[this.overlay,this.panel,this.title,this.btnClose].forEach(t=>t&&t.destroy()),this.rows&&(this.rows.forEach(t=>{t.bg.destroy(),t.name.destroy(),t.sub.destroy(),t.tick.destroy()}),this.rows.length=0),this.listContainer&&this.listContainer.destroy(!0),this._onResize&&this.scene.scale.off("resize",this._onResize);try{this.onClose&&this.onClose()}catch{}}}}const ce={rods:[{id:"rod_wood_1",name:"–£–¥–æ—á–∫–∞ –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è",capKg:1},{id:"rod_fib_5",name:"–£–¥–æ—á–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ç–Ω–∞—è",capKg:5}],lines:[{id:"line_old_1",name:"–õ–µ—Å–∫–∞ —Å—Ç–∞—Ä–∞—è",capKg:1},{id:"line_nylon_4",name:"–õ–µ—Å–∫–∞ –Ω–µ–π–ª–æ–Ω–æ–≤–∞—è",capKg:4}],reels:[{id:"reel_rusty",name:"–ö–∞—Ç—É—à–∫–∞ —Ä–∂–∞–≤–∞—è",pullBoost:.01},{id:"reel_pro",name:"–ö–∞—Ç—É—à–∫–∞ –∫–∞—Ä–ø–æ–≤–∞—è",pullBoost:1.15}],hooks:[{id:"hook_rusty",name:"–ö—Ä—é—á–æ–∫ —Ä–∂–∞–≤—ã–π",control:1},{id:"hook_sharp",name:"–ö—Ä—é—á–æ–∫ –æ—Å—Ç—Ä—ã–π",control:1.12}],baits:["bread","worm","corn","fish"]};function Oe(){return{rod:{id:"rod_wood_1",capKg:1,durability:100},line:{id:"line_old_1",capKg:1,durability:100},reel:{id:"reel_rusty",pullBoost:1},hook:{id:"hook_rusty",control:1,count:5},bait:"worm",inv:{bait:25}}}class Fe{constructor(t,e,s){this.s=t,this.c=t.add.container(e,s).setDepth(805);const i=t.add.graphics();i.fillStyle(16777215,1).fillEllipse(0,-8,10,20),i.fillStyle(16726843,1).fillRect(-2,-18,4,8),this.c.add(i),this.minStandingDepth=.45,this._tweens=new Set}get x(){return this.c.x}set x(t){this.c.x=t}get y(){return this.c.y}set y(t){this.c.y=t}setPosition(t,e){this.c.setPosition(t,e)}setShallow(t){this.c.setRotation(t?Phaser.Math.DegToRad(70):0)}startIdleBobbing(){this.stopAllTweens();const t=this.s.tweens.add({targets:this.c,y:{from:this.c.y,to:this.c.y+6},duration:900,yoyo:!0,repeat:-1,ease:"Sine.inOut"});this._tweens.add(t)}biteShake(){this.stopAllTweens();const t=this.s.tweens.add({targets:this.c,y:{from:this.c.y,to:this.c.y+14},duration:140,yoyo:!0,repeat:6,ease:"Sine.inOut",onComplete:()=>{this.startIdleBobbing()}});this._tweens.add(t)}stopAllTweens(){for(const t of this._tweens)t.remove();this._tweens.clear(),this.s.tweens.killTweensOf(this.c)}destroy(){this.stopAllTweens(),this.c.destroy()}get x(){return this.c.x}set x(t){this.c.x=t}get y(){return this.c.y}set y(t){this.c.y=t}}const O={scale(a){const t=a.scale.width,e=a.scale.height;return Phaser.Math.Clamp(Math.min(t/1280,e/720),.85,1.25)},rem(a,t){return Math.round(t*O.scale(a))},z:{bg:11100,world:0,bobber:5,slots:700,bars:705,bottomHudBg:704,levelBadge:940,keepnet:950,wallet:952,sonar:965,depthBtn:980,map:900,modal:2e3,market:2100},color:{panel:1119522,panelStroke:{c:16777215,a:.18},tile:2765640,tileHover:3358810,good:3066993,warn:15105570},radius:14,pad:16,layout:{sonar:{anchorX:150,size:{w:240,h:150},raiseRem:456,depthAttachGap:14},top:{gap:12,btnW:160},pull:{outerPad:18}}};class de{constructor(t,e=2e3){this.s=t,this.base=e,this.stack=[],this.root=t.add.container(0,0).setDepth(e).setScrollFactor(0),this.root.setVisible(!1);const s=t.scale.width,i=t.scale.height,o=(n,r,h,l)=>{var d,f;const c=l||(n==null?void 0:n.event);(d=c==null?void 0:c.stopImmediatePropagation)==null||d.call(c),(f=c==null?void 0:c.stopPropagation)==null||f.call(c)};this.overlay=t.add.rectangle(0,0,s,i,0,.6).setOrigin(0,0).setScrollFactor(0).setInteractive().setDepth(e),this.overlay.on("pointerdown",o),this.root.add(this.overlay),t.scale.on("resize",()=>{this.overlay.setSize(t.scale.width,t.scale.height)})}open(t,e=1){var h;this.root.setVisible(!0);const s=this.s.add.container(0,0);this.root.add(s);let i=!1,o=null;const n={close:()=>{i||(i=!0,this.close(s))},onEsc:l=>{o=l}};this.stack.push(s);const r=()=>{i||(typeof o=="function"?o():n.close())};return(h=this.s.input.keyboard)==null||h.once("keydown-ESC",r),t(s,n),n}close(t){const e=this.stack.indexOf(t);e>=0&&this.stack.splice(e,1),t==null||t.destroy(),this.stack.length===0&&this.root.setVisible(!1)}destroy(){var t;(t=this.root)==null||t.destroy(),this.stack.length=0}}const We="/greate-catch/assets/bg_lake_day-BLw-xlH1.png",ze="/greate-catch/assets/bg_lake_evening-noJ4i7zW.png",He="/greate-catch/assets/bg_lake_night-Buts0xhq.png",Ke="/greate-catch/assets/bg_lake_sunset-CqPkEYmV.png",wt=a=>new URL(Object.assign({"../assets/bg/bg_lake_day.png":We,"../assets/bg/bg_lake_evening.png":ze,"../assets/bg/bg_lake_night.png":He,"../assets/bg/bg_lake_sunset.png":Ke})[`../assets/bg/${a}.png`],import.meta.url).href,St=[{id:"lake",title:"–û–∑–µ—Ä–æ",bgSet:{day:{key:"bg_lake_day",url:wt("bg_lake_day")},night:{key:"bg_lake_night",url:wt("bg_lake_night")},bgDay:{key:"bg_lake_day",url:wt("bg_lake_day")},bgNight:{key:"bg_lake_night",url:wt("bg_lake_night")},bgDawn:{key:"bg_lake_evening",url:wt("bg_lake_evening")},bgDusk:{key:"bg_lake_sunset",url:wt("bg_lake_sunset")}},depthGrid:{cols:8,rows:4,data:[1.2,1.6,2,2.8,3.6,3.2,2,1.5,1.4,1.8,2.4,3.2,3.8,3.4,2.2,1.6,1.6,2,2.6,3.4,3.9,3.5,2.4,1.8,1,1.2,1.6,2.2,2.6,2.2,1.6,1.1]},depthColumns:{cols:10,profiles:[[[0,3.7],[.25,2.6],[.55,1.1],[1,2.6]],[[.3,4.1],[.3,2.8],[.6,2.3],[1,2.6]],[[.2,3.6],[.3,2.8],[.6,3.3],[1,1.6]],[[0,3.5],[.4,2.6],[.75,4.8],[1,2.2]],[[0,3.3],[.5,2],[.8,2.2],[1,3.4]],[[0,2.9],[.45,2.8],[.78,3.1],[1,2.3]],[[0,3],[.4,2.4],[.7,3.7],[1,2]],[[0,3.6],[.35,2],[.65,4.4],[1,2.8]],[[0,2.7],[.3,2],[.55,2.1],[1,1.6]],[[0,2.7],[.25,2.6],[.52,2],[1,2.5]]]},castMask:{allowedPolys:[[[.016,.644],[.174,.614],[.224,.569],[.356,.554],[.591,.56],[.727,.592],[1,.662],[.994,.989],[.001,.977]]],blockedPolys:[[[.004,.851],[.996,.831],[.993,.985],[0,.98]]]},fishIds:["carp","perch","roach","pike"],speciesAreas:[{speciesId:"carp",mult:1.5,polys:[[[.047,.286],[.067,.406],[.09,.288]]]}]},{id:"river",title:"–†–µ–∫–∞",bg:{key:"bg_river_day",url:new URL("../assets/bg/bg_river_day.png",import.meta.url).href},depthGrid:{cols:10,rows:4,data:[.8,1,1.2,1.6,2.2,2.6,2.2,1.6,1.2,1,.9,1.1,1.4,1.8,2.6,3,2.6,1.8,1.4,1.1,1,1.2,1.6,2,2.8,3.2,2.8,2,1.6,1.2,.8,.9,1.1,1.4,2,2.4,2,1.4,1.1,.9]}},{id:"sea",title:"–ú–æ—Ä–µ",bg:{key:"bg_sea_day",url:new URL("../assets/bg/bg_sea_day.png",import.meta.url).href},depthGrid:{cols:6,rows:3,data:[1.5,2,3,6,8,4,2,3.5,6,9,12,7,1.8,2.5,4,7,10,5]}}];class Tt{constructor(t,e="lake"){this.s=t,this.current=e,this.bg=null,this.bgLayers=null,this.bgWaterLayers=null,this._veil=null,this._grade=null,this._resizeBound=!1,this._waterMaskG=null,this._waterGeomMask=null,this._waterPipeline=null,this._waterTime=0,this._waterFxEnabled=!0,this._maskG=null,this._castMaskEnabled=!0,this._depthDebug=null,this.waterTop=0,this.waterBottom=this.s.scale.height,this._waterAreaLockedByScene=!1,this._bgTimer=null,this._castUV={minV:0,maxV:1}}static loadAssets(t){var e,s,i,o,n,r,h,l,c,d;for(const f of St){const u=f.bgSet||{},p=((e=u.day)==null?void 0:e.key)||((s=f.bgDay)==null?void 0:s.key)||((i=f.bg)==null?void 0:i.key),g=((o=u.day)==null?void 0:o.url)||((n=f.bgDay)==null?void 0:n.url)||((r=f.bg)==null?void 0:r.url),m=((h=u.night)==null?void 0:h.key)||((l=f.bgNight)==null?void 0:l.key)||p,_=((c=u.night)==null?void 0:c.url)||((d=f.bgNight)==null?void 0:d.url)||g;p&&g&&t.load.image(p,g),m&&_&&t.load.image(m,_)}t.load.on(Phaser.Loader.Events.LOAD_ERROR,f=>console.warn("LOAD_ERROR:",f.key,f.src))}applyBackground(){var h,l,c,d,f,u,p,g,m,_,b;const{width:t,height:e}=this.s.scale;(h=this.bg)==null||h.destroy(),this.bg=null,this.bgLayers&&Object.values(this.bgLayers).forEach(y=>y==null?void 0:y.destroy()),this.bgWaterLayers&&Object.values(this.bgWaterLayers).forEach(y=>y==null?void 0:y.destroy()),this.bgLayers={},this.bgWaterLayers={};const s=this.data||{},i=s.bgSet||{},o=((l=i.day)==null?void 0:l.key)||((c=s.bgDay)==null?void 0:c.key)||((d=s.bg)==null?void 0:d.key)||null,n=((f=i.night)==null?void 0:f.key)||((u=s.bgNight)==null?void 0:u.key)||o||null;if(!o&&!n)return;const r=-300;if(o){const y=this.s.add.image(t/2,e/2,o).setOrigin(.5).setDepth(r+1).setScrollFactor(0).setAlpha(0);this._fitCover(y),this.bgLayers.day=y}if(n){const y=this.s.add.image(t/2,e/2,n).setOrigin(.5).setDepth(r+1).setScrollFactor(0).setAlpha(0);this._fitCover(y),this.bgLayers.night=y}if(o){const y=this.s.add.image(t/2,e/2,o).setOrigin(.5).setDepth(r+1.5).setScrollFactor(0).setAlpha(0);this._fitCover(y),this.bgWaterLayers.day=y}if(n){const y=this.s.add.image(t/2,e/2,n).setOrigin(.5).setDepth(r+1.5).setScrollFactor(0).setAlpha(0);this._fitCover(y),this.bgWaterLayers.night=y}(p=this.bgLayers.day||this.bgLayers.night)==null||p.setAlpha(1),(g=this.bgWaterLayers.day||this.bgWaterLayers.night)==null||g.setAlpha(1),(m=this._veil)==null||m.destroy(),this._veil=this.s.add.rectangle(0,0,t,e,0,0).setOrigin(0,0).setDepth(r+2).setScrollFactor(0),(_=this._grade)==null||_.destroy(),this._grade=this.s.add.rectangle(0,0,t,e,16777215,0).setOrigin(0,0).setDepth(r+2.1).setScrollFactor(0).setBlendMode(Phaser.BlendModes.MULTIPLY),this._waterAreaLockedByScene||this._resolveWaterAreaFromConfig(),this.setWaterMaskFromCastMask((b=this.data)==null?void 0:b.castMask),this._resizeBound||(this._resizeBound=!0,this.s.scale.on("resize",()=>{var P,M,I,x;const y=this.s.scale.width,k=this.s.scale.height;this.bgLayers.day&&this._fitCover(this.bgLayers.day),this.bgLayers.night&&this._fitCover(this.bgLayers.night),this.bgWaterLayers.day&&this._fitCover(this.bgWaterLayers.day),this.bgWaterLayers.night&&this._fitCover(this.bgWaterLayers.night),(P=this._veil)==null||P.setSize(y,k),(M=this._grade)==null||M.setSize(y,k),this._waterAreaLockedByScene||this._resolveWaterAreaFromConfig(),this.setWaterMaskFromCastMask((I=this.data)==null?void 0:I.castMask),this._waterPipeline&&this._setU(2,"uResolution",y,k),(x=this._depthDebug)!=null&&x.visible&&this.drawDepthDebug(!0),this._maskG&&this.toggleCastMaskDebug(!0)}),this._bgTimer||(this._bgTimer=this.s.time.addEvent({delay:1e3,loop:!0,callback:()=>{var k,P;const y=(P=(k=this.s.timeCycle)==null?void 0:k.getInfo)==null?void 0:P.call(k);this.setPhaseBlend((y==null?void 0:y.phase)??"day",(y==null?void 0:y.t)??0)}}),this.s.events.once(Phaser.Scenes.Events.SHUTDOWN,()=>{var y;(y=this._bgTimer)==null||y.remove(),this._bgTimer=null})))}useConfigWaterArea(){var t;this._waterAreaLockedByScene=!1,this._resolveWaterAreaFromConfig(),this.setWaterMaskFromCastMask((t=this.data)==null?void 0:t.castMask)}setPhaseBlend(t,e){var f,u,p,g,m,_;if(!this.bgLayers)return;const s=this.bgLayers.day,i=this.bgLayers.night;if(!s&&!i)return;const o=this._hourNow(t,e),n=o>=6&&o<24;s==null||s.setAlpha(0),i==null||i.setAlpha(0),(f=n?s:i)==null||f.setAlpha(1);const r=(u=this.bgWaterLayers)==null?void 0:u.day,h=(p=this.bgWaterLayers)==null?void 0:p.night;r==null||r.setAlpha(0),h==null||h.setAlpha(0),(g=n?r:h)==null||g.setAlpha(1);const l=this._veilAlphaForHour(o);(m=this._veil)==null||m.setFillStyle(0,l);const{color:c,alpha:d}=this._gradeColorForHour(o);(_=this._grade)==null||_.setFillStyle(c,d)}setPhase(t){this.setPhaseBlend(t,0)}_hourNow(t,e){var o,n;const s=(n=(o=this.s.timeCycle)==null?void 0:o.getInfo)==null?void 0:n.call(o);if(s&&typeof s.pct24=="number"){let r=s.pct24*24;return r=(r%24+24)%24,r}const i=Phaser.Math.Clamp(e??0,0,1);return t==="dawn"?6+3*i:t==="day"?9+12*i:t==="dusk"?21+3*i:t==="night"?0+6*i:12}_veilAlphaForHour(t){return t>=6&&t<9?.25*(1-(t-6)/3):t>=21&&t<24?.25*((t-21)/3):0}_gradeColorForHour(t){return t>=6&&t<9?{color:16760944,alpha:.18*(1-(t-6)/3)}:t>=21&&t<24?{color:16760944,alpha:.18*((t-21)/3)}:{color:16777215,alpha:0}}enableWaterFX(t={}){var c;if(!this._waterFxEnabled||this.s.sys.game.config.renderType!==Phaser.WEBGL)return;const e=(c=this.s.game.renderer)==null?void 0:c.pipelines;if(!e)return;let s=typeof e.get=="function"?e.get("WaterWave"):null;if(!s)return;this._waterPipeline=s;const{width:i,height:o}=this.s.scale,{amp:n=2,waveLen:r=56,speed:h=22}=t;this._setU(2,"uResolution",i,o),this._setU(1,"uAmp",n),this._setU(1,"uWaveLen",r),this._setU(1,"uSpeed",h),this._setU(1,"uTime",0),(this.bgWaterLayers?Object.values(this.bgWaterLayers):[]).forEach(d=>(d==null?void 0:d.setPipeline)&&d.setPipeline("WaterWave")),this._boundUpdate||(this._boundUpdate=(d,f)=>{this._waterTime+=(f||0)/1e3,this._setU(1,"uTime",this._waterTime)},this.s.events.on("update",this._boundUpdate))}disableWaterFX(){if(!this._waterPipeline)return;(this.bgWaterLayers?Object.values(this.bgWaterLayers):[]).forEach(e=>(e==null?void 0:e.resetPipeline)&&e.resetPipeline()),this._waterPipeline=null,this._boundUpdate&&(this.s.events.off("update",this._boundUpdate),this._boundUpdate=null)}_setU(t,e,...s){const i=this._waterPipeline;if(!i)return;const o=i[`setFloat${t}`],n=i[`set${t}f`];if(typeof o=="function")return o.call(i,e,...s);if(typeof n=="function")return n.call(i,e,...s)}setWaterArea(t,e,{lock:s=!0}={}){var i;this.waterTop=t??0,this.waterBottom=e??this.s.scale.height,s&&(this._waterAreaLockedByScene=!0),this.setWaterMaskFromCastMask((i=this.data)==null?void 0:i.castMask),this._maskG&&this.toggleCastMaskDebug(!0)}_waterBounds(){return{top:this.waterTop??0,shore:this.waterBottom??this.s.scale.height}}_resolveWaterAreaFromConfig(){var n;if(this._waterAreaLockedByScene)return;const t=this.s.scale.height,e=((n=this.data)==null?void 0:n.water)||{},s=r=>r<=1?Math.round(r*t):r|0,i=e.top!=null?s(e.top):0,o=e.bottom!=null?s(e.bottom):t;this.setWaterArea(i,o,{lock:!0})}_uvToXY(t,e){const s=this.s.scale.width,{top:i,shore:o}=this._waterBounds(),n=Math.max(1,o-i);return{x:t*s,y:i+e*n}}_buildWaterMaskFromAllowed(t){var h;(h=this._waterMaskG)==null||h.destroy(),this._waterGeomMask=null;const e=this._waterMaskG=this.s.add.graphics().setScrollFactor(0).setDepth(-9999).setVisible(!1);e.clear(),e.fillStyle(16777215,1);const s=Array.isArray(t)&&t.length?t:[[[0,0],[1,0],[1,1],[0,1]]];for(const l of s){if(!l||l.length<3)continue;const c=this._uvToXY(l[0][0],l[0][1]);e.beginPath(),e.moveTo(c.x,c.y);for(let d=1;d<l.length;d++){const f=this._uvToXY(l[d][0],l[d][1]);e.lineTo(f.x,f.y)}e.closePath(),e.fillPath()}this._waterGeomMask=new Phaser.Display.Masks.GeometryMask(this.s,e);let i=!1,o=1,n=0;if(Array.isArray(t)&&t.length){for(const l of t)if(Array.isArray(l))for(const c of l){const d=Array.isArray(c)?c[1]:null;typeof d=="number"&&(i=!0,d<o&&(o=d),d>n&&(n=d))}}this._castUV=i?{minV:o,maxV:n}:{minV:0,maxV:1},(this.bgWaterLayers?Object.values(this.bgWaterLayers):[]).forEach(l=>l.setMask(this._waterGeomMask))}setWaterMaskFromCastMask(t){this._buildWaterMaskFromAllowed(Array.isArray(t==null?void 0:t.allowedPolys)?t.allowedPolys:null)}_toUV(t,e){const s=Math.max(1,this.s.scale.width),{top:i,shore:o}=this._waterBounds(),n=Phaser.Math.Clamp(t/s,0,1),r=Phaser.Math.Clamp((e-i)/Math.max(1,o-i),0,1);return{u:n,v:r}}getShoreDistanceRatio(t){const{top:e,shore:s}=this._waterBounds(),i=Math.max(1,s-e);return 1-Phaser.Math.Clamp((t-e)/i,0,1)}getLocatorXForY(t,e,s){const i=this.getShoreDistanceRatio(t);return e+i*Math.max(0,s)}getCastDistanceRatio(t){const{top:e,shore:s}=this._waterBounds(),i=Math.max(1,s-e),o=Phaser.Math.Clamp((t-e)/i,0,1),{minV:n=0,maxV:r=1}=this._castUV||{},h=Math.max(1e-6,r-n),l=Phaser.Math.Clamp(o,n,r);return(r-l)/h}static _pointInPoly(t,e){let s=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const n=e[i][0],r=e[i][1],h=e[o][0],l=e[o][1];r>t.v!=l>t.v&&t.u<(h-n)*(t.v-r)/(l-r||1e-9)+n&&(s=!s)}return s}_inAnyPoly(t,e=[]){for(const s of e)if(Array.isArray(s)&&s.length>=3&&Tt._pointInPoly(t,s))return!0;return!1}canCastAt(t,e){var r,h,l;const{top:s,shore:i}=this._waterBounds();if(e<s||e>i)return!1;if(!this._castMaskEnabled)return!0;const o=(r=this.data)==null?void 0:r.castMask;if(!o)return!0;const n=this._toUV(t,e);return Array.isArray(o.allowedPolys)||Array.isArray(o.blockedPolys)?!(((h=o.allowedPolys)==null?void 0:h.some(f=>Array.isArray(f)&&f.length>=3))&&!this._inAnyPoly(n,o.allowedPolys)||((l=o.blockedPolys)==null?void 0:l.length)&&this._inAnyPoly(n,o.blockedPolys)):Array.isArray(o.polys)&&o.polys.length&&o.polys.some(d=>Array.isArray(d)&&d.length>=3)?o.mode==="allow"?this._inAnyPoly(n,o.polys):!this._inAnyPoly(n,o.polys):!0}setCastMaskEnabled(t=!0){this._castMaskEnabled=!!t}toggleCastMaskDebug(t=!0){var c,d,f;if(!t){(c=this._maskG)==null||c.destroy(),this._maskG=null;return}(d=this._maskG)==null||d.destroy();const e=this._maskG=this.s.add.graphics().setDepth(5e3),s=this.s.scale.width,{top:i,shore:o}=this._waterBounds(),n=Math.max(1,o-i),r=([u,p])=>({x:u*s,y:i+p*n}),h=(u,p,g)=>{const m=u.map(r);e.fillStyle(p,g),e.lineStyle(2,p,.9),e.beginPath(),e.moveTo(m[0].x,m[0].y);for(let _=1;_<m.length;_++)e.lineTo(m[_].x,m[_].y);e.closePath(),e.fillPath(),e.strokePath()},l=(f=this.data)==null?void 0:f.castMask;l&&(Array.isArray(l.allowedPolys)&&l.allowedPolys.forEach(u=>h(u,65416,.15)),Array.isArray(l.blockedPolys)&&l.blockedPolys.forEach(u=>h(u,16724821,.25)),Array.isArray(l.polys)&&(l.mode==="allow"?l.polys.forEach(u=>h(u,65416,.15)):l.polys.forEach(u=>h(u,16724821,.25))))}_evalProfile(t,e){if(!(t!=null&&t.length))return 0;if(e<=t[0][0])return t[0][1];for(let s=1;s<t.length;s++)if(e<=t[s][0]){const[i,o]=t[s-1],[n,r]=t[s],h=(e-i)/Math.max(1e-6,n-i);return o+(r-o)*h}return t[t.length-1][1]}getColumnIndexForX(t){var o,n,r,h;const e=((n=(o=this.data)==null?void 0:o.depthColumns)==null?void 0:n.cols)??((h=(r=this.data)==null?void 0:r.depthGrid)==null?void 0:h.cols)??10,s=Math.max(1,this.s.scale.width),i=Phaser.Math.Clamp(t/s,0,.999999);return Math.floor(i*e)}getDepthProfileForColumn(t,e=64){var d,f,u,p;const s=(d=this.data)==null?void 0:d.depthColumns;if((f=s==null?void 0:s.profiles)!=null&&f.length){const g=s.profiles[t]||s.profiles[t%s.profiles.length],m=new Array(e);let _=0;for(let b=0;b<e;b++){const y=e===1?0:b/(e-1),k=this._evalProfile(g,y);m[b]=k,k>_&&(_=k)}return{depths:m,max:_}}const i=((p=(u=this.data)==null?void 0:u.depthGrid)==null?void 0:p.cols)??(s==null?void 0:s.cols)??10,o=Math.max(1,this.s.scale.width),n=(t+.5)/i*o,{top:r,shore:h}=this._waterBounds(),l=new Array(e);let c=0;for(let g=0;g<e;g++){const m=e===1?0:g/(e-1),_=r+m*(h-r),b=this.getDepthAtXY(n,_);l[g]=b,b>c&&(c=b)}return{depths:l,max:c}}getDepthAtXY(t,e){var u,p,g;const s=this.data;if(!s)return 2;const{top:i,shore:o}=this._waterBounds(),n=Phaser.Math.Clamp((e-i)/Math.max(1,o-i),0,1),r=s.depthColumns;if((u=r==null?void 0:r.profiles)!=null&&u.length){const m=this.getColumnIndexForX(t),_=r.profiles[m]||r.profiles[m%r.profiles.length];return this._evalProfile(_,n)}const h=s.depthGrid;if(h!=null&&h.data&&h.cols>0&&h.rows>0){const m=Math.max(1,this.s.scale.width),b=Phaser.Math.Clamp(t/m,0,.999999)*(h.cols-1),y=n*(h.rows-1),k=Math.floor(b),P=Math.min(k+1,h.cols-1),M=Math.floor(y),I=Math.min(M+1,h.rows-1),x=b-k,A=y-M,F=(w,W)=>w*h.cols+W,C=h.data[F(M,k)]??0,T=h.data[F(M,P)]??0,B=h.data[F(I,k)]??0,K=h.data[F(I,P)]??0,D=C*(1-x)+T*x,S=B*(1-x)+K*x;return D*(1-A)+S*A}let l=2;const c=(p=s.depth)==null?void 0:p.bands;if(c!=null&&c.length){const m=Math.max(1,this.s.scale.width),_=Phaser.Math.Clamp(t/m,0,.999999);l=(c.find(y=>_>=y.from&&_<y.to)||c[c.length-1]).m??2}const d=((g=s.depth)==null?void 0:g.yGradient)||{top:1.25,bottom:.75},f=Phaser.Math.Linear(d.top,d.bottom,n);return l*f}getDepthAtX(t){var o;const e=this.data;if(!e)return 2;const s=e.depthGrid;if(s!=null&&s.data&&s.cols&&s.rows){const n=Math.max(1,this.s.scale.width),r=Phaser.Math.Clamp(t/n,0,.999999),h=Math.floor(r*s.cols);let l=0;for(let c=0;c<s.rows;c++){const d=s.data[c*s.cols+h]??0;d>l&&(l=d)}return l||2}const i=(o=e.depth)==null?void 0:o.bands;if(i!=null&&i.length){const n=Math.max(1,this.s.scale.width),r=Phaser.Math.Clamp(t/n,0,.999999);return(i.find(l=>r>=l.from&&r<l.to)||i[i.length-1]).m??2}return 2}getSpeciesAreaModsAt(t,e){var n,r;const s=((n=this.data)==null?void 0:n.speciesAreas)||[];if(!s.length)return null;const i=this._toUV(t,e),o={};for(const h of s){if(!((r=h==null?void 0:h.polys)!=null&&r.length)||!h.speciesId||!h.mult)continue;h.polys.some(c=>Tt._pointInPoly(i,c))&&(o[h.speciesId]=Math.max(o[h.speciesId]||1,h.mult))}return Object.keys(o).length?{species:o}:null}get data(){return St.find(t=>t.id===(this.current||"lake"))||null}getCurrentId(){return this.current}set(t){var e;St.some(s=>s.id===t)&&(this.current=t,this.applyBackground(),this.drawDepthDebug(!1),this.toggleCastMaskDebug(!1),(e=this._bgTimer)==null||e.remove(),this._bgTimer=null)}_fitCover(t){if(!t)return;const e=this.s.scale.width,s=this.s.scale.height,i=Math.max(e/t.width,s/t.height);t.setScale(i).setPosition(Math.round(e/2),Math.round(s/2))}getWaterArea(){const{top:t,shore:e}=this._waterBounds();return{top:t,bottom:e}}}const at={categories:["sets","rods","reels","lines","hooks","bait"],meta:{version:1,currency:{coins:"–ú–æ–Ω–µ—Ç—ã",gold:"–ó–æ–ª–æ—Ç–æ"}},items:{sets:[{id:"set_wood",name:"–ù–∞–±–æ—Ä ¬´–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π¬ª",level:1,price:65,rarity:"common",contains:[{kind:"rods",id:"rod_wood_1"},{kind:"reels",id:"reel_rusty"},{kind:"lines",id:"line_old_1"},{kind:"hooks",id:"hook_rusty"},{kind:"bait",id:"worm",qty:25}],note:"–ë—é–¥–∂–µ—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Ç",tags:["starter","budget"]},{id:"set_birch",name:"–ù–∞–±–æ—Ä ¬´–ë–µ—Ä—ë–∑–æ–≤—ã–π¬ª",level:3,price:170,rarity:"common",contains:[{kind:"rods",id:"rod_birch_2"},{kind:"reels",id:"reel_bronze"},{kind:"lines",id:"line_solid_2"},{kind:"hooks",id:"hook_bronze"},{kind:"bait",id:"worm",qty:25}],note:"–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –ø—Ä–æ—á–Ω–æ—Å—Ç—å —Å–Ω–∞—Å—Ç–µ–π",tags:["balanced"]},{id:"set_pine",name:"–ù–∞–±–æ—Ä ¬´–°–æ—Å–Ω–æ–≤—ã–π¬ª",level:5,price:320,rarity:"uncommon",contains:[{kind:"rods",id:"rod_pine_3"},{kind:"reels",id:"reel_iron"},{kind:"lines",id:"line_braided_3"},{kind:"hooks",id:"hook_steel"},{kind:"bait",id:"worm",qty:25}],note:"–ü—Ä–∏—è—Ç–Ω—ã–π –±—É—Å—Ç –ø–æ —Ç—è–≥–µ –∏ –∑–∞–ø–∞—Å—É –ø—Ä–æ—á–Ω–æ—Å—Ç–∏",tags:["power"]},{id:"set_ash",name:"–ù–∞–±–æ—Ä ¬´–Ø—Å–µ–Ω—å¬ª",level:7,price:520,rarity:"uncommon",contains:[{kind:"rods",id:"rod_ash_4"},{kind:"reels",id:"reel_steel"},{kind:"lines",id:"line_braided_4"},{kind:"hooks",id:"hook_tempered"},{kind:"bait",id:"worm_premium",qty:25}],note:"–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ä–µ–¥–Ω–∏—Ö —Ç—Ä–æ—Ñ–µ—è—Ö",tags:["control","midgame"]},{id:"set_maple",name:"–ù–∞–±–æ—Ä ¬´–ö–ª—ë–Ω¬ª",level:9,price:760,rarity:"rare",contains:[{kind:"rods",id:"rod_maple_5"},{kind:"reels",id:"reel_chrome"},{kind:"lines",id:"line_fluoro_5"},{kind:"hooks",id:"hook_chrome"},{kind:"bait",id:"worm_premium",qty:25}],note:"–¢—è–≥–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è –∫—Ä—É–ø–Ω—è–∫–∞",tags:["big-fish","control"]},{id:"set_fiberglass",name:"–ù–∞–±–æ—Ä ¬´–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫¬ª",level:11,price:1040,rarity:"rare",contains:[{kind:"rods",id:"rod_fiber_6"},{kind:"reels",id:"reel_graphite"},{kind:"lines",id:"line_fluoro_6"},{kind:"hooks",id:"hook_titanium"},{kind:"bait",id:"worm_premium",qty:25}],note:"–õ—ë–≥–∫–æ—Å—Ç—å –∏ –∑–∞–ø–∞—Å –ø–æ –ø—Ä–æ—á–Ω–æ—Å—Ç–∏",tags:["light","durable"]},{id:"set_carbon",name:"–ù–∞–±–æ—Ä ¬´Carbon Pro¬ª",level:14,price:1420,goldPrice:2,rarity:"epic",contains:[{kind:"rods",id:"rod_carbon_7"},{kind:"reels",id:"reel_carbonpro"},{kind:"lines",id:"line_ultra_7"},{kind:"hooks",id:"hook_titanium_pro"},{kind:"bait",id:"worm_premium",qty:25}],note:"–ú–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Ä—ã–≤–∫–∞",tags:["endgame","premium"]}],rods:[{id:"rod_wood_1",name:"–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —É–¥–æ—á–∫–∞",capKg:1,level:1,price:30,rarity:"common",set:"–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π",desc:"–ü—Ä–æ—Å—Ç–æ–π, –Ω–æ —Ä–∞–±–æ—á–∏–π —Å—Ç–∞—Ä—Ç"},{id:"rod_birch_2",name:"–ë–µ—Ä—ë–∑–æ–≤–∞—è —É–¥–æ—á–∫–∞",capKg:2.4,level:3,price:90,rarity:"common",set:"–ë–µ—Ä—ë–∑–æ–≤—ã–π",desc:"–ü–æ–ø—Ä–∞–∫—Ç–∏—á–Ω–µ–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π"},{id:"rod_pine_3",name:"–°–æ—Å–Ω–æ–≤–∞—è —É–¥–æ—á–∫–∞",capKg:3.2,level:5,price:160,rarity:"uncommon",set:"–°–æ—Å–Ω–æ–≤—ã–π",desc:"–ë–æ–ª—å—à–µ –∑–∞–ø–∞—Å –ø–æ –∫–∞–ø—É"},{id:"rod_ash_4",name:"–Ø—Å–µ–Ω–µ–≤–∞—è —É–¥–æ—á–∫–∞",capKg:4.4,level:7,price:260,rarity:"uncommon",set:"–Ø—Å–µ–Ω—å",desc:"–•–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∏—Ç –Ω–∞—Ç—è–∂–µ–Ω–∏–µ"},{id:"rod_maple_5",name:"–ö–ª—ë–Ω–æ–≤–∞—è —É–¥–æ—á–∫–∞",capKg:5.6,level:9,price:380,rarity:"rare",set:"–ö–ª—ë–Ω",desc:"–î–ª—è —Ç—è–∂—ë–ª—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤"},{id:"rod_fiber_6",name:"–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫–æ–≤–∞—è",capKg:7,level:11,price:520,rarity:"rare",set:"–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫",desc:"–õ—ë–≥–∫–æ –∏ –∫—Ä–µ–ø–∫–æ"},{id:"rod_carbon_7",name:"Carbon Pro",capKg:9,level:14,price:700,rarity:"epic",set:"Carbon",desc:"–¢–æ–ø–æ–≤—ã–π –∫–∞–ø –∏ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å"}],reels:[{id:"reel_rusty",name:"–†–∂–∞–≤–∞—è –∫–∞—Ç—É—à–∫–∞",pullBoost:.9,level:1,price:20,rarity:"common",set:"–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π",desc:"–ß—É—Ç—å —Ö—É–∂–µ –±–∞–∑–æ–≤–æ–π —Ç—è–≥–∏"},{id:"reel_bronze",name:"–ë—Ä–æ–Ω–∑–æ–≤–∞—è –∫–∞—Ç—É—à–∫–∞",pullBoost:1.1,level:3,price:70,rarity:"common",set:"–ë–µ—Ä—ë–∑–æ–≤—ã–π",desc:"–ü–ª—é—Å –∫ —Ç—è–≥–µ"},{id:"reel_iron",name:"–ñ–µ–ª–µ–∑–Ω–∞—è –∫–∞—Ç—É—à–∫–∞",pullBoost:1.2,level:5,price:120,rarity:"uncommon",set:"–°–æ—Å–Ω–æ–≤—ã–π",desc:"–ù–∞–¥—ë–∂–Ω–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞"},{id:"reel_steel",name:"–°—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ç—É—à–∫–∞",pullBoost:1.35,level:7,price:200,rarity:"uncommon",set:"–Ø—Å–µ–Ω—å",desc:"–†–æ–≤–Ω–∞—è —Ç—è–≥–∞"},{id:"reel_chrome",name:"–•—Ä–æ–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è",pullBoost:1.5,level:9,price:300,rarity:"rare",set:"–ö–ª—ë–Ω",desc:"–°–æ–ª–∏–¥–Ω—ã–π –±—É—Å—Ç"},{id:"reel_graphite",name:"–ì—Ä–∞—Ñ–∏—Ç–æ–≤–∞—è",pullBoost:1.65,level:11,price:420,rarity:"rare",set:"–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫",desc:"–õ—ë–≥–∫–∞—è, —Ç—è–≥–æ–≤–∏—Ç–∞—è"},{id:"reel_carbonpro",name:"Carbon Pro Spool",pullBoost:1.85,level:14,price:560,rarity:"epic",set:"Carbon",desc:"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç—è–≥–∞"}],lines:[{id:"line_old_1",name:"–°—Ç–∞—Ä–∞—è –ª–µ—Å–∫–∞",capKg:1.2,level:1,price:15,rarity:"common",set:"–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π",desc:"–ë–∞–∑–æ–≤—ã–π –∫–∞–ø"},{id:"line_solid_2",name:"–ü—Ä–æ—á–Ω–∞—è –ª–µ—Å–∫–∞",capKg:2.1,level:3,price:55,rarity:"common",set:"–ë–µ—Ä—ë–∑–æ–≤—ã–π",desc:"–ß—É—Ç—å –∫—Ä–µ–ø—á–µ"},{id:"line_braided_3",name:"–ü–ª–µ—Ç—ë–Ω–∫–∞ –ú–öIII",capKg:3,level:5,price:95,rarity:"uncommon",set:"–°–æ—Å–Ω–æ–≤—ã–π",desc:"–•–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∏—Ç —Ä—ã–≤–∫–∏"},{id:"line_braided_4",name:"–ü–ª–µ—Ç—ë–Ω–∫–∞ –ú–öIV",capKg:4,level:7,price:150,rarity:"uncommon",set:"–Ø—Å–µ–Ω—å",desc:"–°–∏–ª—å–Ω–µ–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ"},{id:"line_fluoro_5",name:"–§–ª—é–æ—Ä–æ–∫–∞—Ä–±–æ–Ω X5",capKg:5,level:9,price:210,rarity:"rare",set:"–ö–ª—ë–Ω",desc:"–ò–∑–Ω–æ—Å–æ—Å—Ç–æ–π–∫–∞—è"},{id:"line_fluoro_6",name:"–§–ª—é–æ—Ä–æ–∫–∞—Ä–±–æ–Ω X6",capKg:6.2,level:11,price:280,rarity:"rare",set:"–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫",desc:"–¢–æ–ø –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö"},{id:"line_ultra_7",name:"ULTRA Mono 7",capKg:7.8,level:14,price:360,rarity:"epic",set:"Carbon",desc:"–ó–∞–ø–∞—Å –¥–ª—è —Ç—Ä–æ—Ñ–µ–µ–≤"}],hooks:[{id:"hook_rusty",name:"–†–∂–∞–≤—ã–π –∫—Ä—é—á–æ–∫",control:.9,level:1,price:10,pack:5,rarity:"common",set:"–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π",desc:"–°—Ä—ã–≤—ã —Å–ª—É—á–∞—é—Ç—Å—è"},{id:"hook_bronze",name:"–ë—Ä–æ–Ω–∑–æ–≤—ã–π –∫—Ä—é—á–æ–∫",control:1.1,level:3,price:35,pack:5,rarity:"common",set:"–ë–µ—Ä—ë–∑–æ–≤—ã–π",desc:"–ü–æ–ø–ª–æ—Ç–Ω–µ–µ –¥–µ—Ä–∂–∏—Ç"},{id:"hook_steel",name:"–°—Ç–∞–ª—å–Ω–æ–π –∫—Ä—é—á–æ–∫",control:1.2,level:5,price:60,pack:5,rarity:"uncommon",set:"–°–æ—Å–Ω–æ–≤—ã–π",desc:"–ß–∞—â–µ –¥–æ—Å–∞–∂–∏–≤–∞–µ—Ç —Ä—ã–±–µ"},{id:"hook_tempered",name:"–ó–∞–∫–∞–ª—ë–Ω–Ω—ã–π –∫—Ä—é—á–æ–∫",control:1.3,level:7,price:85,pack:5,rarity:"uncommon",set:"–Ø—Å–µ–Ω—å",desc:"–ù–∞–¥—ë–∂–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è"},{id:"hook_chrome",name:"–•—Ä–æ–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—Ä—é—á–æ–∫",control:1.42,level:9,price:115,pack:5,rarity:"rare",set:"–ö–ª—ë–Ω",desc:"–ú–µ–Ω—å—à–µ —Å—Ö–æ–¥–æ–≤"},{id:"hook_titanium",name:"–¢–∏—Ç–∞–Ω–æ–≤—ã–π –∫—Ä—é—á–æ–∫",control:1.55,level:11,price:160,pack:5,rarity:"rare",set:"–°—Ç–µ–∫–ª–æ–ø–ª–∞—Å—Ç–∏–∫",desc:"–õ–µ–≥–∫–∏–π –∏ –∑–ª–æ–π"},{id:"hook_titanium_pro",name:"Titan Pro Hook",control:1.7,level:14,price:220,pack:5,rarity:"epic",set:"Carbon",desc:"–ü–æ—á—Ç–∏ ¬´–∫–∞–∫ –Ω–∞ –ª–∏–ø—É—á–∫–µ¬ª"}],bait:[{id:"worm",name:"–ß–µ—Ä–≤—å (25 —à—Ç.)",pack:25,level:1,price:15,rarity:"common",desc:"–ë–∞–∑–æ–≤–∞—è –Ω–∞–∂–∏–≤–∫–∞"},{id:"worm_premium",name:"–ß–µ—Ä–≤—å –ø—Ä–µ–º–∏—É–º (25 —à—Ç.)",pack:25,level:2,price:25,rarity:"uncommon",desc:"–î–æ–ª—å—à–µ –∂–∏–≤—ë—Ç"}]}};function Ee(a){const t=(e,s,i="id")=>{a[e]=a[e]||[],a[e].some(n=>n[i]===s[i])||a[e].push(s)};for(const e of at.items.rods)t("rods",{id:e.id,name:e.name,capKg:e.capKg});for(const e of at.items.lines)t("lines",{id:e.id,name:e.name,capKg:e.capKg});for(const e of at.items.hooks)t("hooks",{id:e.id,name:e.name,control:e.control});for(const e of at.items.reels)t("reels",{id:e.id,name:e.name,pullBoost:e.pullBoost})}const Le="/greate-catch/assets/bleak-DGHkV-qU.png",Ge="/greate-catch/assets/bream-4_nJIvBe.png",Ne="/greate-catch/assets/carp-BzjO2-mq.png",Xe="/greate-catch/assets/crucian-1gcVIWMe.png",$e="/greate-catch/assets/ide-BykERWlM.png",Ve="/greate-catch/assets/perch-DhY7TGBn.png",Ue="/greate-catch/assets/pike-CvOUOXDT.png",Ye="/greate-catch/assets/roach-DV5X4M0B.png",je="/greate-catch/assets/ruffe-fScqSHhO.png",qe="/greate-catch/assets/tench-Lh1TSKlX.png",Je="/greate-catch/assets/chest_wood-TKiiUoce.png",Ze="/greate-catch/assets/crayfish-CIoxF4s4.png",Qe="/greate-catch/assets/frog-BP53DFA7.png",ts="/greate-catch/assets/grass_snake-DQvsjav4.png",es="/greate-catch/assets/loot_coins_small-A0xfsKYc.png",ss="/greate-catch/assets/rusty_can-CJ2nOoN5.png",is="/greate-catch/assets/stick-B38GSOBP.png";function fe(a){return(Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[]).map(e=>e==null?void 0:e.id).filter(Boolean)}const os=new Set(fe(re)),as=new Set(fe(he)),ns=Object.assign({"./fish/bleak.png":Le,"./fish/bream.png":Ge,"./fish/carp.png":Ne,"./fish/crucian.png":Xe,"./fish/ide.png":$e,"./fish/perch.png":Ve,"./fish/pike.png":Ue,"./fish/roach.png":Ye,"./fish/ruffe.png":je,"./fish/tench.png":qe}),rs=Object.assign({"./pick/chest_wood.png":Je,"./pick/crayfish.png":Ze,"./pick/frog.png":Qe,"./pick/grass_snake.png":ts,"./pick/loot_coins_small.png":es,"./pick/rusty_can.png":ss,"./pick/stick.png":is});function pe(a){const t=new Map;for(const[e,s]of Object.entries(a)){const i=e.lastIndexOf("/")+1,o=e.slice(i,-4);t.set(o,s)}return t}const hs=pe(ns),ls=pe(rs),cs={fish:{},pick:{}},ut=new Set,Lt=new Set;function bt(a,t){return`${a}_${t}`}function It(a,t){var i;const e=((i=cs[a])==null?void 0:i[t])??t,s=a==="fish"?hs.get(e):a==="pick"?ls.get(e):null;return s||(console.warn("[photo MISSING in bundle]",a,e),null)}function Wt(a){const t=(At==null?void 0:At[a])||{},e=Object.keys(t);return{fish:e.filter(s=>os.has(s)),pick:e.filter(s=>as.has(s))}}function ds(a){return Wt(a).fish}function fs(a){return Wt(a).pick}function ue(a){a._photoBankLogsAttached||(a._photoBankLogsAttached=!0,a.load.on("filecomplete",(t,e)=>{if(e==="image"&&(t.startsWith("fish_")||t.startsWith("pick_"))){ut.delete(t),Lt.add(t);const s=t.startsWith("fish_")?"fish":"pick";console.log(`[${s} photo OK]`,t)}}),a.load.on("loaderror",t=>{const e=(t==null?void 0:t.key)??"";(t==null?void 0:t.type)==="image"&&(e.startsWith("fish_")||e.startsWith("pick_"))&&(ut.add(e),console.warn("[photo LOAD ERROR]",e,t==null?void 0:t.src))}))}function ps(a,t,e={fish:!0,pick:!0}){const s=Wt(t),i=e.fish!==!1,o=e.pick!==!1,n=a.load.path;a.load.setPath("");let r=0,h=0;if(i)for(const l of s.fish){const c=bt("fish",l);if(a.textures.exists(c)||Lt.has(c)||ut.has(c))continue;const d=It("fish",l);if(!d){ut.add(c);continue}a.load.image(c,d),r++}if(o)for(const l of s.pick){const c=bt("pick",l);if(a.textures.exists(c)||Lt.has(c)||ut.has(c))continue;const d=It("pick",l);if(!d){ut.add(c);continue}a.load.image(c,d),h++}return a.load.setPath(n),ue(a),{fish:r,pick:h}}function us(a,t,e){const s=bt(t,e);if(a.textures.exists(s))return Promise.resolve(s);if(ut.has(s))return Promise.resolve(null);const i=It(t,e);return i?new Promise(o=>{ue(a);const n=(r,h)=>{r===s&&h==="image"&&(a.load.off("filecomplete",n),o(s))};a.load.on("filecomplete",n),a.load.image(s,i),a.load.start()}):(ut.add(s),Promise.resolve(null))}const Mt={key:bt,file:It,keyFor:bt,fileFor:It,keyForFish:a=>bt("fish",a),keyForPick:a=>bt("pick",a),idsForLocation:Wt,fishIdsForLocation:ds,pickIdsForLocation:fs,queueForScene:ps,ensureOne:us};function gs(a){return(a??0).toFixed(3)+" –∫–≥"}function ms(a){return(a??0).toFixed(0)+" –≥"}function ys(a,t,e,s){var h,l;if(t&&typeof t=="object"){const{key:c,frame:d}=t;if(c&&((h=a.textures)!=null&&h.exists(c))){const f=a.add.image(e.x,e.y,c,d??void 0).setDepth(s),u=Math.min((e.w-24)/f.width,(e.h-24)/f.height);return f.setScale(u),f}}const i=typeof t=="string"?t:null;if(i&&((l=a.textures)!=null&&l.exists(i))){const c=a.add.image(e.x,e.y,i).setDepth(s),d=Math.min((e.w-24)/c.width,(e.h-24)/c.height);return c.setScale(d),c}const o=a.add.graphics().setDepth(s);o.lineStyle(2,7066111,.9).strokeRect(e.x-e.w/2+8,e.y-e.h/2+8,e.w-16,e.h-16);const n=e.x-e.w/2+16,r=e.y-6;o.beginPath();for(let c=0;c<6;c++){const d=n+c*((e.w-32)/5),f=r+(c%2?-16:16);c===0?o.moveTo(d,f):o.lineTo(d,f)}return o.strokePath(),o}function _s(a,t,e,s,i,o){const n=a.add.text(t,e,s,{fontFamily:"Arial, sans-serif",fontSize:"15px",color:"#c9d3e7"}).setOrigin(0,0).setDepth(o),r=a.add.text(t,e+18,i,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(0,0).setDepth(o);return[n,r]}function bs(a,t,e,s,i,o){const n=Math.max(60,Math.round(s.length*10+22)),h=a.add.rectangle(t,e,n,24,i,1).setOrigin(0,.5).setStrokeStyle(2,16777215,.16).setDepth(o),l=a.add.text(t+10,e,s,{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#ffffff"}).setOrigin(0,.5).setDepth(o+1);return[h,l]}function Jt(a,t,e,s,i,o){const n=o??40,r=a.add.rectangle(t,e,n,n,988189,1).setStrokeStyle(2,16777215,.12).setDepth(i).setInteractive({useHandCursor:!0}),h=a.add.graphics().setDepth(i+1);h.lineStyle(2,16777215,1);const l=Math.round(n*.22);return h.beginPath(),s==="left"?(h.moveTo(t+6,e-l),h.lineTo(t-6,e),h.lineTo(t+6,e+l)):(h.moveTo(t-6,e-l),h.lineTo(t+6,e),h.lineTo(t-6,e+l)),h.strokePath(),r.on("pointerover",()=>r.setFillStyle(1515571,1)),r.on("pointerout",()=>r.setFillStyle(988189,1)),[r,h]}function Ht(a,t,e,s,i,o,n,r,h=!1,l={}){const c=l.h??40,d=l.fontSize??16,f=a.add.rectangle(t,e,s,c,o,1).setOrigin(.5).setStrokeStyle(2,16777215,.18).setDepth(n),u=a.add.text(t,e,i,{fontFamily:"Arial, sans-serif",fontSize:String(d)+"px",color:"#ffffff"}).setOrigin(.5).setDepth(n+1);return h?(f.setFillStyle(4937064,1).disableInteractive(),u.setColor("#c7c7c7")):f.setInteractive({useHandCursor:!0}).on("pointerover",()=>{const p=Phaser.Display.Color.IntegerToColor(o).darken(10).color;f.setFillStyle(p,1)}).on("pointerout",()=>f.setFillStyle(o,1)).on("pointerdown",r),[f,u]}function Xt(a,t,e,s,i){var mt,vt,Pt;const o=a.scale.width,n=a.scale.height,r=18,h=4300,l=o/2|0,c=n/2|0,d=.66,f=Math.min(Math.round(860*d),o-80),u=Math.min(Math.round(520*d),n-80),p={btnW:Math.max(120,Math.round(180*d)),btnH:Math.max(30,Math.round(40*d)),btnFont:Math.max(13,Math.round(16*d)),arrow:Math.max(28,Math.round(40*d)),pageFont:Math.max(14,Math.round(20*d))},g=s.closeDelayMs??0;let m=g<=0;m||a.time.delayedCall(g,()=>{m=!0});const _=()=>{m&&(s.onEsc?s.onEsc():e.close())},b=a.add.rectangle(0,0,o,n,0,0).setOrigin(0,0).setDepth(h).setScrollFactor(0).setInteractive();b.on("pointerdown",()=>{m&&_()});const y=a.add.rectangle(l+2,c+3,f,u,0,.22).setDepth(h+1),k=a.add.rectangle(l,c,f,u,2040883,1).setStrokeStyle(2,16777215,.22).setDepth(h+1).setInteractive();k.on("pointerdown",(V,q,it,tt)=>tt==null?void 0:tt.stopPropagation());const P={left:Math.round(l-f/2),right:Math.round(l+f/2),top:Math.round(c-u/2),bottom:Math.round(c+u/2)},M=(V,q)=>V>=P.left&&V<=P.right&&q>=P.top&&q<=P.bottom,I=V=>{m&&(M(V.worldX,V.worldY)||_())};a.input.on("pointerdown",I);const x=()=>{a.input.off("pointerdown",I)},A=s.onEsc;s.onEsc=()=>{try{x()}catch{}A?A():e.close()},e.onEsc(()=>{try{x()}catch{}_()});const F=a.add.text(l,c-u/2+16,s.title||"",{fontFamily:"Arial, sans-serif",fontSize:"26px",color:"#ffffff"}).setOrigin(.5,0).setDepth(h+2),C=a.add.text(l+f/2-14,c-u/2+6,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(1,0).setDepth(h+3).setInteractive({useHandCursor:!0}).on("pointerdown",(V,q,it,tt)=>{tt==null||tt.stopPropagation(),_()});t.add([b,y,k,F,C]);const T=F.y+44,B=u-(T-(c-u/2))-64,K=16,D=Math.floor((f-r*2-K)*.42),S=f-r*2-K-D,w=l-f/2+r+D/2,W=w+D/2+K+S/2,z={x:w,y:Math.round(T+B/2)-8,w:D,h:B-12},R=a.add.rectangle(z.x,z.y,z.w,z.h,988189,1).setStrokeStyle(2,16777215,.12).setDepth(h+2),E=ys(a,s.imageKey,z,h+3);if(t.add([R,E]),i&&i.total>1){const[V,q]=Jt(a,z.x-z.w/2+22,z.y+z.h/2+34,"left",h+3,p.arrow),[it,tt]=Jt(a,z.x+z.w/2-22,z.y+z.h/2+34,"right",h+3,p.arrow),U=a.add.text(z.x,z.y+z.h/2+34,`${i.index+1}/${i.total}`,{fontFamily:"Arial, sans-serif",fontSize:String(p.pageFont)+"px",color:"#ffffff"}).setOrigin(.5).setDepth(h+3);t.add([V,q,it,tt,U]),V.on("pointerdown",()=>i.onPrev&&i.onPrev()),it.on("pointerdown",()=>i.onNext&&i.onNext())}const X=a.add.rectangle(W,z.y,S,z.h,988189,1).setStrokeStyle(2,16777215,.12).setDepth(h+2);t.add(X);const H=Math.round(W-S/2)+16;let G=Math.round(z.y-z.h/2)+10;const L=a.add.text(H,G,s.name||"",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(0,0).setDepth(h+3);if(t.add(L),G+=L.height+6,(s.badges||[]).forEach((V,q)=>t.add(bs(a,H+q*130,G+12,V.text,V.color,h+3))),(s.badges||[]).length&&(G+=38),(s.stats||[]).forEach(V=>{t.add(_s(a,H,G,V.label,V.value,h+3)),G+=36}),s.info){const V=typeof s.info=="string"?s.info:((mt=s.info)==null?void 0:mt.bio)||((vt=s.info)==null?void 0:vt.text)||JSON.stringify(s.info),q=a.add.text(H-2,G+10,"–û–ø–∏—Å–∞–Ω–∏–µ",{fontFamily:"Arial, sans-serif",fontSize:"15px",color:"#c9d3e7"}).setOrigin(0,0).setDepth(h+3);t.add(q);const it=-2,tt=S-32+Math.min(0,it),U=a.add.text(H+it,q.y+q.height+4,V,{fontFamily:"Arial, sans-serif",fontSize:"15px",color:"#ffffff",lineSpacing:2,wordWrap:{width:tt,useAdvanced:!0}}).setOrigin(0,0).setDepth(h+3);U.setWordWrapWidth(tt,!0),t.add(U),G=U.y+U.height+8}const Y=Math.round(c+u/2-Math.max(22,Math.round(p.btnH/2)+6)),j=12,nt=l+f/2-r,Q=s.actions||[];if(Q.length===1){const V=Q[0],q=nt-p.btnW/2;t.add(Ht(a,q,Y,p.btnW,V.label,V.color??3884642,h+3,()=>s.onAction&&s.onAction(V.id),!!V.disabled,{h:p.btnH,fontSize:p.btnFont}))}else if(Q.length>=2){const V=Q[0],q=Q[1],it=nt-p.btnW/2,tt=it-(p.btnW+j);t.add(Ht(a,tt,Y,p.btnW,V.label,V.color??2792847,h+3,()=>s.onAction&&s.onAction(V.id),!!V.disabled,{h:p.btnH,fontSize:p.btnFont})),t.add(Ht(a,it,Y,p.btnW,q.label,q.color??3555931,h+3,()=>s.onAction&&s.onAction(q.id),!!q.disabled,{h:p.btnH,fontSize:p.btnFont}))}const et=(Pt=a.input.keyboard)==null?void 0:Pt.addKey("ESC");et==null||et.once("down",_),e.onEsc(_)}function ge(a){var t,e;return(a==null?void 0:a.info)??((t=a==null?void 0:a.meta)==null?void 0:t.info)??((e=a==null?void 0:a.spec)==null?void 0:e.info)??null}function me(a,t="catch",{keepnetFull:e=!1}={}){const s=[];a.isPersonalRecord&&s.push({text:"–õ–∏—á–Ω—ã–π —Ä–µ–∫–æ—Ä–¥",color:2779967}),a.isWorldRecord&&s.push({text:"–ú–∏—Ä–æ–≤–æ–π —Ä–µ–∫–æ—Ä–¥",color:7553449});const i=[];i.push({label:"–í–µ—Å",value:a.weightKg!=null?gs(a.weightKg):ms(a.weightG)}),a.estimatedPrice!=null&&i.push({label:"–û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è",value:`${a.estimatedPrice} –º–æ–Ω.`}),a.baitName&&i.push({label:"–ù–∞–∂–∏–≤–∫–∞",value:a.baitName}),a.locationName&&i.push({label:"–ì–¥–µ –ø–æ–π–º–∞–Ω–∞",value:a.locationName}),a.statusText&&i.push({label:"–°—Ç–∞—Ç—É—Å",value:a.statusText});const o=a.imageKey||(a.kind&&a.kind!=="fish"?Mt.key("pick",a.id):Mt.key("fish",a.id)),n=ge(a);return t==="catch"?{title:"–ü–æ–π–º–∞–Ω–∞ —Ä—ã–±–∞!",name:a.name||"",imageKey:o,badges:s,stats:i,info:n,actions:[{id:"keep",label:"–û—Å—Ç–∞–≤–∏—Ç—å (XP)",color:2792847,disabled:e},{id:"release",label:"–û—Ç–ø—É—Å—Ç–∏—Ç—å (√ó2 XP)",color:3555931}],escAction:"keep",closeDelayMs:600}:{title:a.name||"–°–∞–¥–æ–∫",name:a.name||"",imageKey:o,badges:s,stats:i,info:n,actions:[{id:"share",label:"–•–≤–∞—Å—Ç–∞—Ç—å—Å—è",color:3884642},{id:"release",label:"–û—Ç–ø—É—Å—Ç–∏—Ç—å —Ä—ã–±—É",color:2792847}],escAction:"close",closeDelayMs:0}}function xs(a,{coins:t=0}={}){const e=[];t>0&&e.push({label:"–ù–∞–≥—Ä–∞–¥–∞",value:`+${t} –º–æ–Ω–µ—Ç`});const s=(a==null?void 0:a.tex)||(a==null?void 0:a.icon)||(a==null?void 0:a.spriteKey)||(a!=null&&a.id?Mt.key("pick",a.id):null),i=ge(a);return{title:"–£–ª–æ–≤",name:(a==null?void 0:a.name)??"–ù–∞–≥—Ä–∞–¥–∞",imageKey:s,badges:[],stats:e,info:i,actions:[{id:"take",label:t>0?"–ó–∞–±—Ä–∞—Ç—å":"–û–∫",color:3884642},{id:"drop",label:"–í—ã–±—Ä–æ—Å–∏—Ç—å",color:2792847}],escAction:"take",closeDelayMs:300}}function ws(a,t,e={}){return new Promise(s=>{var h;const i=Array.isArray(e.keepnet)?e.keepnet:Array.isArray(a.keepnet)?a.keepnet:[],o=i.slice();o.push(t);let n=o.length-1;const r=!!e.keepnetFull||(((h=a.keepnet)==null?void 0:h.length)??0)>=(a.keepnetCap??0);a.modals.open((l,c)=>{let d=!1;const f=p=>{var g;if(!d){d=!0;try{(g=l.iterate)==null||g.call(l,m=>{var _;return(_=m.disableInteractive)==null?void 0:_.call(m)})}catch{}try{s(p)}catch{}a.time.delayedCall(0,()=>c.close())}},u=()=>{var _;(_=l.removeAll)==null||_.call(l,!0);const p=o[n],g=n===o.length-1,m=me(p,g?"catch":"keepnet",{keepnetFull:r});m.onAction=b=>{var y,k;if(g)b==="keep"?f("keep"):b==="release"&&f("release");else if(b==="share")(y=a.showToast)==null||y.call(a,"–°–∫–æ—Ä–æ: –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—Ä–æ—Ñ–µ–µ–º");else if(b==="release"){const P=i.splice(n,1);if(P.length){const M=o.indexOf(P[0]);M>=0&&o.splice(M,1)}n>=o.length&&(n=Math.max(0,o.length-1)),a.keepnet=i,(k=a.keepnetBadge)==null||k.set(i.length,a.keepnetCap??25),u()}},m.onEsc=()=>f(g?"keep":"close"),Xt(a,l,c,m,{index:n,total:o.length,onPrev:()=>{n=(n-1+o.length)%o.length,u()},onNext:()=>{n=(n+1)%o.length,u()}})};u()})})}function ks(a,t,e=0){const s=Array.isArray(t)?t:[];let i=Math.max(0,Math.min(e|0,Math.max(0,s.length-1)));return new Promise(o=>{a.modals.open((n,r)=>{let h=!1;const l=d=>{var f;if(!h){h=!0;try{(f=n.iterate)==null||f.call(n,u=>{var p;return(p=u.disableInteractive)==null?void 0:p.call(u)})}catch{}o(d),a.time.delayedCall(0,()=>r.close())}},c=()=>{var u;(u=n.removeAll)==null||u.call(n,!0);const d=s[i]||{},f=me(d,"keepnet");f.onAction=p=>{var g,m;if(p==="release"){const _=s.splice(i,1);if(_.length){const b=a.keepnet||t,y=b.indexOf(_[0]);y>=0&&b.splice(y,1)}if(!s.length){l({action:"release",index:i});return}i>=s.length&&(i=s.length-1),(g=a.keepnetBadge)==null||g.set(s.length,a.keepnetCap??25),c()}else p==="share"&&((m=a.showToast)==null||m.call(a,"–°–∫–æ—Ä–æ: –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—Ä–æ—Ñ–µ–µ–º"))},f.onEsc=()=>l({action:"close",index:i}),Xt(a,n,r,f,{index:i,total:s.length,onPrev:()=>{i=(i-1+s.length)%s.length,c()},onNext:()=>{i=(i+1)%s.length,c()}})};c()})})}function Ss(a,t,{coins:e=0}={}){return new Promise(s=>{a.modals.open((i,o)=>{var l;let n=!1;const r=c=>{var d;if(!n){n=!0;try{(d=i.iterate)==null||d.call(i,f=>{var u;return(u=f.disableInteractive)==null?void 0:u.call(f)})}catch{}try{s(c)}catch{}a.time.delayedCall(0,()=>{var f;return(f=o.close)==null?void 0:f.call(o)})}},h=xs(t,{coins:e});h.onAction=c=>{(c==="take"||c==="drop")&&r(c)},h.onEsc=()=>r(h.escAction||"take"),(l=i.removeAll)==null||l.call(i,!0),Xt(a,i,o,h,null)})})}class Ms{constructor(t,e=25,s=null){this.scene=t,this.capacity=e,this.count=0,this.onClick=s;const i=t.scale.width,o=12;this.w=108,this.h=64,this.x=i-o-this.w,this.y=o,this.bg=t.add.graphics().setDepth(950),this.bg.fillStyle(1119522,.88),this.bg.fillRoundedRect(this.x,this.y,this.w,this.h,14),this.bg.lineStyle(2,16777215,.18),this.bg.strokeRoundedRect(this.x,this.y,this.w,this.h,14),this.icon=t.add.text(this.x+18,this.y+this.h/2,"üß∫",{fontFamily:"Arial, sans-serif",fontSize:"24px",color:"#ffffff"}).setOrigin(0,.5).setDepth(951),this.label=t.add.text(this.x+this.w-14,this.y+this.h/2,"0/25",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#e8f1ff"}).setOrigin(1,.5).setDepth(951),this.zone=t.add.zone(this.x,this.y,this.w,this.h).setOrigin(0,0).setDepth(952).setInteractive(),s&&this.zone.on("pointerdown",s)}setPosition(t,e){this.x=t|0,this.y=e|0,this.bg.clear(),this.bg.fillStyle(1119522,.88),this.bg.fillRoundedRect(this.x,this.y,this.w,this.h,14),this.bg.lineStyle(2,16777215,.18),this.bg.strokeRoundedRect(this.x,this.y,this.w,this.h,14),this.icon.setPosition(this.x+18,this.y+this.h/2),this.label.setPosition(this.x+this.w-14,this.y+this.h/2),this.zone.setPosition(this.x,this.y)}set(t,e=this.capacity){this.count=t,this.capacity=e,this.label.setText(`${t}/${e}`)}setVisible(t){[this.bg,this.icon,this.label,this.zone].forEach(e=>e.setVisible(t)),this.zone.setInteractive(t)}setOnClick(t){this.zone.removeAllListeners(),this.onClick=t,t&&this.zone.on("pointerdown",t)}}class vs{constructor(t,e,s={}){this.s=t,this.tc=e,this.depth=s.depth??955,this.ringR=s.ringR??14,this.ringTh=s.ringTh??4,this.padX=12,this.padY=8,this.colors={dawn:{panel:2502984,stroke:16777215,strokeA:.18,ring:16762731,time:"#ffffff",sub:"#ffe6b3",icon:"üåÖ",label:"–†–ê–°–°–í–ï–¢"},day:{panel:2765124,stroke:16777215,strokeA:.18,ring:16765286,time:"#ffffff",sub:"#a7ffeb",icon:"‚òÄ",label:"–î–ï–ù–¨"},dusk:{panel:2304317,stroke:16777215,strokeA:.18,ring:16751974,time:"#ffffff",sub:"#ffc9a1",icon:"üåÜ",label:"–ó–ê–ö–ê–¢"},night:{panel:1711921,stroke:16777215,strokeA:.18,ring:8890111,time:"#ffffff",sub:"#cfd8dc",icon:"üåô",label:"–ù–û–ß–¨"}},this.root=this.s.add.container(0,0).setDepth(this.depth),this.gPanel=this.s.add.graphics().setDepth(this.depth),this.root.add(this.gPanel),this.gRing=this.s.add.graphics().setDepth(this.depth+1),this.root.add(this.gRing),this.icon=this.s.add.text(0,0,"‚òÄ",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(0,.5).setDepth(this.depth+2),this.timeTxt=this.s.add.text(0,0,"00:00",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ffffff"}).setOrigin(0,.5).setDepth(this.depth+2),this.subTxt=this.s.add.text(0,0,"–î–ï–ù–¨",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#a7ffeb"}).setOrigin(0,.5).setDepth(this.depth+2),this.root.add([this.icon,this.timeTxt,this.subTxt]),this.lastClock="",this.lastPhase=null,this.w=180,this.h=40,this._applyStyle("day"),this._layout(),this.update(!0),t.scale.on("resize",()=>this._redrawPanel())}destroy(){var t,e,s,i,o,n;(t=this.gPanel)==null||t.destroy(),(e=this.gRing)==null||e.destroy(),(s=this.icon)==null||s.destroy(),(i=this.timeTxt)==null||i.destroy(),(o=this.subTxt)==null||o.destroy(),(n=this.root)==null||n.destroy()}setPosition(t,e){this.root.setPosition(Math.round(t),Math.round(e))}getBounds(){return new Phaser.Geom.Rectangle(this.root.x-this.w/2,this.root.y-this.h/2,this.w,this.h)}_applyStyle(t){const e=this.colors[t]||this.colors.day;this.curStyle=e,this.icon.setText(e.icon),this.timeTxt.setColor(e.time),this.subTxt.setColor(e.sub),this.subTxt.setText(e.label),this._redrawPanel()}_redrawPanel(){const t=this.curStyle||this.colors.day,e=this.gPanel;e.clear(),e.fillStyle(t.panel,1),e.lineStyle(2,t.stroke,t.strokeA),e.fillRoundedRect(-this.w/2,-this.h/2,this.w,this.h,14),e.strokeRoundedRect(-this.w/2,-this.h/2,this.w,this.h,14)}_layout(){const t=(this.ringR+this.ringTh)*2;let e=-this.w/2+this.padX;this.ringX=e+this.ringR+this.ringTh,this.ringY=0,e+=t+8,this.icon.setPosition(e,0),e+=Math.max(18,this.icon.width)+8,this.timeTxt.setPosition(e,0),e+=this.timeTxt.width+10,this.subTxt.setPosition(e,0);const i=this.subTxt.x+this.subTxt.width+this.padX- -this.w/2;this.w=Math.max(170,Math.ceil(i)),this.h=40,this._redrawPanel()}_drawRing(t){const e=this.curStyle||this.colors.day,s=this.gRing;s.clear(),s.lineStyle(this.ringTh,16777215,.15),s.beginPath(),s.arc(this.ringX,this.ringY,this.ringR,-Math.PI/2,-Math.PI/2+Math.PI*2,!1),s.strokePath();const i=-Math.PI/2+Math.PI*2*Phaser.Math.Clamp(t,0,1);s.lineStyle(this.ringTh,e.ring,1),s.beginPath(),s.arc(this.ringX,this.ringY,this.ringR,-Math.PI/2,i,!1),s.strokePath()}update(t=!1){var s;if(!((s=this.tc)!=null&&s.getInfo))return;const e=this.tc.getInfo();(t||e.clock!==this.lastClock)&&(this.lastClock=e.clock,this.timeTxt.setText(e.clock),this._layout()),(t||e.phase!==this.lastPhase)&&(this.lastPhase=e.phase,this._applyStyle(e.phase)),this._drawRing(e.pct24)}}class Ps{constructor(t,e){this.scene=t,this.progress=e;const s=12;this.x=s,this.y=s,this.w=170,this.h=56,this.bg=t.add.graphics().setDepth(940),this.bg.fillStyle(1119522,.9).fillRoundedRect(this.x,this.y,this.w,this.h,14),this.bg.lineStyle(2,16777215,.18).strokeRoundedRect(this.x,this.y,this.w,this.h,14),this.title=t.add.text(this.x+12,this.y+10,"",{fontFamily:"Arial, sans-serif",fontSize:"15px",color:"#e8f1ff"}).setDepth(941).setOrigin(0,0),this.bar=t.add.graphics().setDepth(941),this.update()}setProgress(t){const e={level:1,xp:0,xpNeeded:s=>100};return this.progress=t&&typeof t.xpNeeded=="function"?t:e,this}setPosition(t,e){this.x=t|0,this.y=e|0,this.bg.clear(),this.bg.fillStyle(1119522,.9).fillRoundedRect(this.x,this.y,this.w,this.h,14),this.bg.lineStyle(2,16777215,.18).strokeRoundedRect(this.x,this.y,this.w,this.h,14),this.title.setPosition(this.x+12,this.y+10),this.update()}update(){var d,f;const t=((d=this.progress)==null?void 0:d.level)??1,e=((f=this.progress)==null?void 0:f.xp)??0,s=this.progress&&typeof this.progress.xpNeeded=="function"?this.progress.xpNeeded(t):100,i=Math.max(0,Number(e)||0),o=Math.max(1,Number(s)||1);this.title.setText(`–£—Ä. ${t}  ‚Ä¢  ${i}/${o} XP`);const n=this.x+12,r=this.y+34,h=this.w-24,l=14;this.bar.clear(),this.bar.fillStyle(0,.35).fillRoundedRect(n,r,h,l,8),this.bar.lineStyle(1,16777215,.22).strokeRoundedRect(n,r,h,l,8);const c=Math.max(0,Math.min(h,Math.floor(i/o*h)));this.bar.fillStyle(6210170,1).fillRoundedRect(n,r,c,l,8)}pulse(){this.scene.tweens.add({targets:[this.bg,this.bar,this.title],alpha:{from:1,to:.6},duration:200,yoyo:!0,repeat:2,ease:"Sine.inOut"})}getBounds(){return new Phaser.Geom.Rectangle(this.x,this.y,this.w,this.h)}destroy(){this.bg.destroy(),this.bar.destroy(),this.title.destroy()}}class Cs{constructor(t,{x:e=150,y:s=118,w:i=220,h:o=140}={}){this.s=t,this.size={w:i,h:o},this.pos={x:e,y:s},this._fixedY=null,this.samples=null,this.maxDepth=0,this.dotFollowX=!1,this.dotXFrac=.82,this._dotXFixed=.82,this.isCollapsed=!1,this._tabW=22,this._computeSlidePositions(),this.c=t.add.container(this.shownX,s).setDepth(965),this.c.setScrollFactor(0),this.c.input&&(this.c.input.alwaysEnabled=!0);const{w:n,h:r}=this.size,h=t.add.rectangle(0,0,n,r,1054239,1).setStrokeStyle(2,0,.8).setOrigin(.5),l=t.add.rectangle(0,0,n-20,r-20,1585218,1).setOrigin(.5);this.gProfile=t.add.graphics().setDepth(966),this.gDot=t.add.graphics().setDepth(967),this.lblMax=t.add.text(-n/2+18,r/2-24,"",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff",fontStyle:"bold"}).setOrigin(0,.5).setDepth(968);const c=-n/2-8+this._tabW/2;this.tab=t.add.rectangle(c,0,this._tabW,46,2372936,1).setStrokeStyle(1,16777215,.18).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.toggle()),this.arrow=t.add.text(c,0,"‚óÑ",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5),this.c.add([h,l,this.gProfile,this.gDot,this.lblMax,this.tab,this.arrow]),this._buildRightOpener(),this._onResize=()=>{this.samples?this._drawProfile():this._drawIdle(),this._computeSlidePositions(),this.c.setPosition(this.isCollapsed?this.hiddenX:this.shownX,this.pos.y),this._placeRightOpener(),this._layoutAttached(),this._refreshRightOpenerVisibility()},t.scale.on("resize",this._onResize),this._drawIdle(),this._fightOn=!1,this._fishDepth=null,this._fightNoise=Math.random()*Math.PI*2}destroy(){var t,e;this.s.scale.off("resize",this._onResize),this.c.destroy(),(t=this.openBtnR)==null||t.destroy(),(e=this.openIconR)==null||e.destroy()}setPosition(t,e){this.pos={x:t,y:e},this._computeSlidePositions(),this.c.setPosition(this.isCollapsed?this.hiddenX:this.shownX,e),this._placeRightOpener(),this._layoutAttached()}setDotFollowX(t=!0){this.dotFollowX=!!t}attachDepthCtrl(t,e=14){var s,i;t!=null&&t.c&&(this._attached={ctrl:t,gap:e},this.c.add(t.c),t.c.setDepth(968),(i=(s=t.c).setScrollFactor)==null||i.call(s,0),this._layoutAttached())}show(t,e){var o;const s=this.s.locationMgr.getDepthProfileForColumn(this.s.locationMgr.getColumnIndexForX(t),64);if(this.samples=s.depths,this.maxDepth=s.max,e==null){const{top:n,shore:r}=this.s.locationMgr._waterBounds();e=Phaser.Math.Clamp(((o=this.s.input.activePointer)==null?void 0:o.worldY)??r,n,r)}this._fixedY=e;const i=this._yToU(e);this._dotXFixed=i,this.dotXFrac=i,this._drawProfile()}hide(){this.samples=null,this.maxDepth=0,this._drawIdle()}updateDot(t,e={}){if(!this.samples)return;const s=this.dotFollowX?this._yToU(t):this._yToU(this._fixedY??t);this.dotXFrac=s;const i=Math.max(1,this.samples.length-1),o=1-s,n=Phaser.Math.Clamp(o*i,0,i),r=Math.floor(n),h=Math.min(r+1,i),l=n-r,c=this.samples[r]*(1-l)+this.samples[h]*l,d=Math.max(0,this.s.rigDepthM??0),f=Math.min(d,c);let u=f;if(this._fightOn){const x=Phaser.Math.Clamp(e.tension??0,0,1),A=!!e.reeling;this._fightNoise+=.035+.02*x;const F=(.08+.12*x)*c,C=Math.sin(this._fightNoise)*F,B=(A?.25:.8)*x*c,K=Phaser.Math.Clamp(f+B+C,0,c);this._fishDepth==null&&(this._fishDepth=f),this._fishDepth=Phaser.Math.Linear(this._fishDepth,K,.08),u=this._fishDepth}const{w:p,h:g}=this.size,m=18,_=-p/2+m,b=-g/2+m,y=p-m*2,k=g-m*2,P=Math.max(.1,this.maxDepth*1.1),M=Math.round(_+s*y)+.5,I=Math.round(b+u/P*k)+.5;if(this.gDot.clear(),this.gDot.lineStyle(1,16777215,.18).beginPath(),this.gDot.moveTo(_,I),this.gDot.lineTo(_+y,I),this.gDot.strokePath(),this.gDot.fillStyle(16726843,1).fillCircle(M,I,3),this._fightOn&&!this.dotFollowX&&(e.allowXDrift??!1)){const x=(.003+.01*(e.tension??0))*Math.sin(this._fightNoise*.5);this._dotXFixed=Phaser.Math.Clamp(this._dotXFixed+x,0,1)}}setFight(t=!0){this._fightOn=!!t,this._fishDepth=null,this._fightNoise=Math.random()*Math.PI*2}isFightOn(){return this._fightOn}_yToU(t){const e=this.s.locationMgr;if(e!=null&&e.getCastDistanceRatio)return e.getCastDistanceRatio(t);if(e!=null&&e.getShoreDistanceRatio)return e.getShoreDistanceRatio(t);const s=this.s.scale.height;return 1-Phaser.Math.Clamp(t/Math.max(1,s),0,1)}_computeSlidePositions(){const e=this.size.w-this._tabW+8;this.shownX=this.pos.x,this.hiddenX=this.pos.x-e}toggle(){this._tween&&this._tween.stop(),this.isCollapsed=!this.isCollapsed,this._tween=this.s.tweens.add({targets:this.c,x:this.isCollapsed?this.hiddenX:this.shownX,duration:220,ease:"Sine.inOut",onUpdate:()=>{this._placeRightOpener(),this._refreshRightOpenerVisibility()},onComplete:()=>this._refreshRightOpenerVisibility()}),this.arrow.setText(this.isCollapsed?"‚ñ∫":"‚óÑ"),this._refreshRightOpenerVisibility()}_drawIdle(){this.gProfile.clear(),this.gDot.clear();const{w:t,h:e}=this.size,s=10,i=t-20,o=e-20;this.gProfile.fillStyle(1718604,1),this.gProfile.fillRect(-i/2+s,-o/2+s,i-s*2,o-s*2),this.lblMax.setText("")}_drawProfile(){if(!this.samples){this._drawIdle();return}const{w:t,h:e}=this.size,s=18,i=-t/2+s,o=-e/2+s,n=t-s*2,r=e-s*2,h=Math.max(.1,this.maxDepth*1.1);this.gProfile.clear(),this.gProfile.fillStyle(993851,1),this.gProfile.fillRect(i,o,n,r);const l=u=>{const g=1-u/(this.samples.length-1),m=this.samples[u],_=Math.round(i+g*n)+.5,b=Math.round(o+m/h*r)+.5;return{x:_,y:b}};this.gProfile.fillStyle(2178644,1).beginPath();let c=l(0);this.gProfile.moveTo(c.x,c.y);for(let u=1;u<this.samples.length;u++)c=l(u),this.gProfile.lineTo(c.x,c.y);const d=i+n,f=o+r;this.gProfile.lineTo(i,f),this.gProfile.lineTo(d,f),this.gProfile.closePath(),this.gProfile.fillPath(),this.lblMax.setText(`${this.maxDepth.toFixed(2)}m`),this.gDot.clear()}_buildRightOpener(){this.openBtnR=this.s.add.rectangle(0,0,this._tabW,46,2372936,1).setStrokeStyle(1,16777215,.18).setDepth(969).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.isCollapsed&&this.toggle()}),this.openIconR=this.s.add.text(0,0,"‚ñ∫",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5).setDepth(970).setScrollFactor(0),this._placeRightOpener(),this._refreshRightOpenerVisibility()}_placeRightOpener(){var s,i;const t=this.c.x+this.size.w/2+8-this._tabW/2,e=this.pos.y;(s=this.openBtnR)==null||s.setPosition(t,e),(i=this.openIconR)==null||i.setPosition(t,e)}_refreshRightOpenerVisibility(){var e,s;const t=!!this.isCollapsed;(e=this.openBtnR)==null||e.setVisible(t).setInteractive(t),(s=this.openIconR)==null||s.setVisible(t)}_layoutAttached(){if(!this._attached)return;const{ctrl:t,gap:e}=this._attached;t.c.setPosition(0,this.size.h/2+e)}}class As{constructor(t,e=1.2,s={x:64,y:64},i=()=>{},o={}){this.s=t,this._prec=100,this.minM=o.min??.2,this.maxM=o.max??8,this.stepM=o.step??.01,this.minCm=Math.round(this.minM*this._prec),this.maxCm=Math.round(this.maxM*this._prec),this.stepCm=Math.max(1,Math.round(this.stepM*this._prec)),this._valueCm=Phaser.Math.Clamp(Math.round(e*this._prec),this.minCm,this.maxCm),this.value=this._valueCm/this._prec,this.onChange=i,this.modalOpen=!1,this._modal=null,this._hostRef=null,this._applyRequested=!1,this.useHost=!!o.useHost,this.c=t.add.container(s.x,s.y).setDepth(980);const n=132,r=28;this.btn=t.add.rectangle(0,0,n,r,2831178,1).setStrokeStyle(2,16777215,.18).setInteractive({useHandCursor:!0}),this.btnLbl=t.add.text(0,0,this._label(),{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#ffffff"}).setOrigin(.5),this.c.add([this.btn,this.btnLbl]),this.btn.on("pointerover",()=>this.btn.setFillStyle(3292248,1)),this.btn.on("pointerout",()=>this.btn.setFillStyle(2831178,1)),this.btn.on("pointerdown",()=>this._openModal())}_label(){return`–ì–ª—É–±–∏–Ω–∞: ${this.value.toFixed(2)}–º`}_applyCm(t,e=!1){var i,o,n;const s=Phaser.Math.Clamp(Math.round(t),this.minCm,this.maxCm);if(this._valueCm=s,this.value=s/this._prec,(i=this.btnLbl)==null||i.setText(this._label()),e||(o=this.onChange)==null||o.call(this,this.value),this._handle&&this._prog&&this._toX){const r=this._toX(this.value);this._handle.x=r,this._prog.width=Math.max(2,r-this._x0),(n=this._num)==null||n.setText(this._label())}}_bump(t,e=!1){this._applyCm(this._valueCm+t,e)}setPosition(t,e){var s;(s=this.c)==null||s.setPosition(t,e)}setValue(t,e=!1){const s=Math.round(Phaser.Math.Clamp(t,this.minM,this.maxM)*this._prec),i=Math.round(s/this.stepCm)*this.stepCm;this._applyCm(i,e)}destroy(){var t;this._closeModal(!1,!0),(t=this.c)==null||t.destroy()}_buildUI(t,{W:e,H:s,cx:i,cy:o,PW:n,PH:r,withOverlay:h}){if(h){const C=this.s.add.rectangle(0,0,e,s,0,.5).setOrigin(0,0).setScrollFactor(0).setInteractive();t.add(C)}const l=this.s.add.rectangle(i+2,o+3,n,r,0,.22),c=this.s.add.rectangle(i,o,n,r,2040883,1).setStrokeStyle(2,16777215,.22);t.add([l,c]);const d=this.s.add.text(i,o-r/2+16,"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª—É–±–∏–Ω—ã –æ—Å–Ω–∞—Å—Ç–∫–∏",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ffffff"}).setOrigin(.5,0),f=this.s.add.text(i+n/2-22,o-r/2+6,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ffffff"}).setOrigin(.5,0).setInteractive({useHandCursor:!0});t.add([d,f]),this._num=this.s.add.text(i,d.y+36,this._label(),{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#cfd8ff"}).setOrigin(.5,0),t.add(this._num);const u=Math.min(360,n-80),p=o+16,g=i-u/2,m=i+u/2;this._x0=g,this._x1=m;const _=this.s.add.rectangle(i,p,u,6,3819360,1).setStrokeStyle(1,16777215,.15).setInteractive();t.add(_);const b=C=>g+(C-this.minM)/(this.maxM-this.minM)*u;this._toX=b,this._prog=this.s.add.rectangle(g,p,Math.max(2,b(this.value)-g),6,5940991,1).setOrigin(0,.5),t.add(this._prog);const y=this.s.add.graphics();y.lineStyle(1,16777215,.18);const k=.5;for(let C=this.minM;C<=this.maxM+1e-6;C+=k){const T=b(C);if(y.beginPath(),y.moveTo(T,p-5),y.lineTo(T,p+5),y.strokePath(),Math.abs(C-Math.round(C))<1e-6){const B=this.s.add.text(T,p+12,`${Math.round(C)}–º`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#9fb1db"}).setOrigin(.5,0);t.add(B)}}t.add(y),this._handle=this.s.add.circle(b(this.value),p,10,15395562,1).setStrokeStyle(2,987414,.6).setInteractive({draggable:!0,useHandCursor:!0}),t.add(this._handle);const P=C=>{const T=Phaser.Math.Clamp(C,g,m);this._handle.x=T;const B=(T-g)/u,K=this.minM+B*(this.maxM-this.minM),D=Math.round(K*this._prec),S=Math.round(D/this.stepCm)*this.stepCm;this._applyCm(S,!1),this._prog.width=Math.max(2,T-g)};this.s.input.setDraggable(this._handle,!0),this._handle.on("drag",(C,T)=>P(T)),_.on("pointerdown",C=>P(C.worldX));const M=(C,T,B)=>{const K=this.s.add.rectangle(C,p+40,40,28,3884642,1).setStrokeStyle(2,16777215,.18).setInteractive({useHandCursor:!0}),D=this.s.add.text(C,p+40,T,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5);return K.on("pointerover",()=>K.setFillStyle(4411508,1)),K.on("pointerout",()=>K.setFillStyle(3884642,1)),K.on("pointerdown",S=>{const w=S==null?void 0:S.event,W=w!=null&&w.ctrlKey||w!=null&&w.metaKey?10:w!=null&&w.shiftKey?5:1;this._bump(B*W)}),t.add([K,D]),K};M(i-80,"‚àí",-1),M(i+80,"+",1);const I=this.s.add.rectangle(i-60,o+r/2-24,120,34,3046706,1).setStrokeStyle(2,16777215,.18).setInteractive({useHandCursor:!0}),x=this.s.add.text(I.x,I.y,"–ì–æ—Ç–æ–≤–æ",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(.5),A=this.s.add.rectangle(i+60,o+r/2-24,120,34,3555931,1).setStrokeStyle(2,16777215,.18).setInteractive({useHandCursor:!0}),F=this.s.add.text(A.x,A.y,"–û—Ç–º–µ–Ω–∞",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(.5);return t.add([I,x,A,F]),f.on("pointerdown",()=>this._closeModal(!0)),I.on("pointerdown",()=>this._closeModal(!0)),A.on("pointerdown",()=>{this._applyCm(this._beforeCm,!0),this._closeModal(!1)}),{ok:I,cancel:A,closeX:f}}_openModal(){var r,h;if(this.modalOpen)return;this.modalOpen=!0,this._applyRequested=!1,this._beforeCm=this._valueCm,this._hadUiLock="uiLock"in this.s?this.s.uiLock:void 0,"uiLock"in this.s&&(this.s.uiLock=!0);const t=this.s.scale.width,e=this.s.scale.height,s=Math.round(t/2),i=Math.round(e/2),o=Math.min(520,t-80),n=210;if(this.useHost&&this.s.modals){const l=this.s.add.container(0,0);this._hostRef=l,l.once("destroy",()=>{this._applyRequested||this._applyCm(this._beforeCm,!0),this._finalizeClose()}),this.s.modals.root&&this.s.modals.root.add(l),typeof this.s.modals.open=="function"&&this.s.modals.open(()=>{},1),this._buildUI(l,{W:t,H:e,cx:s,cy:i,PW:o,PH:n,withOverlay:!1}),(r=this.s.input.keyboard)==null||r.once("keydown-ESC",()=>{this.modalOpen&&(this._applyCm(this._beforeCm,!0),l&&!l.destroyed&&l.destroy(!0))});return}this._modal=this.s.add.container(0,0).setDepth(1400),this._buildUI(this._modal,{W:t,H:e,cx:s,cy:i,PW:o,PH:n,withOverlay:!0}),(h=this.s.input.keyboard)==null||h.once("keydown-ESC",()=>{this.modalOpen&&(this._applyCm(this._beforeCm,!0),this._closeModal(!1))})}_finalizeClose(){var t,e;this.modalOpen=!1,this._hadUiLock!==void 0&&(this.s.uiLock=this._hadUiLock),(t=this.btnLbl)==null||t.setText(this._label()),this._applyRequested&&((e=this.onChange)==null||e.call(this,this.value)),this._modal=null,this._hostRef=null,this._handle=null,this._prog=null,this._num=null,this._toX=null}_closeModal(t=!1,e=!1){if(!(!this.modalOpen&&!e)){if(this._applyRequested=!!t,this._hostRef){this._hostRef.destroyed||this._hostRef.destroy(!0);return}this._modal&&!this._modal.destroyed&&this._modal.destroy(!0),this._finalizeClose()}}}function Ts(a,t){var f;if(!!((f=a.modalHost)!=null&&f.open))return a.modalHost.open((u,p)=>Zt(a,t,{container:u,onClose:p.close}));const{width:s,height:i}=a.scale,o=a.add.rectangle(0,0,s,i,0,.6).setOrigin(0,0).setInteractive().setDepth(O.z.map),n=()=>{o.destroy(),r==null||r.destroy(),h==null||h.destroy(),l==null||l.destroy(),c==null||c.destroy()};let r,h,l,c;({panel:r,title:h,maskG:l,list:c}=Zt(a,t,{onClose:n,depthBase:O.z.map+1})),a.scale.on("resize",d),o.once("destroy",()=>a.scale.off("resize",d)),o.once("pointerdown",n);function d(){const u=a.scale.width,p=a.scale.height;o.setSize(u,p)}}function Zt(a,t,{container:e=null,onClose:s=()=>{},depthBase:i=O.z.modal}={}){var K;const{width:o,height:n}=a.scale,r=Math.min(680,o-80),h=Math.min(480,n-80),l=D=>(e&&e.add(D),D),c=l(a.add.rectangle(o/2,n/2,r,h,2040883,1).setStrokeStyle(2,16777215,.25).setDepth(i)),d=l(a.add.text(o/2,c.y-h/2+18,"–≠–∫—Å–ø–µ–¥–∏—Ü–∏—è ‚Äî –≤—ã–±–µ—Ä–∏ –ª–æ–∫–∞—Ü–∏—é",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(.5,0).setDepth(i+1)),f=18,u=h-86,p=d.y+40,g=l(a.add.container(c.x-r/2+f,p).setDepth(i+1)),m=l(a.add.graphics().setVisible(!1).setDepth(i+1));m.fillRect(c.x-r/2+f,p,r-f*2,u);const _=m.createGeometryMask();g.setMask(_);const b=r>=520,y=b?(r-f*2-10)/2:r-f*2,k=44,P=10;St.forEach((D,S)=>{const w=b?S%2:0,W=b?Math.floor(S/2):S,z=w*(y+10),R=W*(k+P),E=l(a.add.rectangle(z+y/2,R+k/2,y,k,3555931,1).setStrokeStyle(2,16777215,.15).setInteractive().setDepth(i+1)),X=l(a.add.text(E.x,E.y,D.title,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5).setDepth(i+1));E.on("pointerover",()=>E.setFillStyle(3951206,1)),E.on("pointerout",()=>E.setFillStyle(3555931,1)),E.on("pointerdown",()=>{s(),t==null||t(D.id)}),g.add([E,X])});let M=0;const I=Math.min(0,u-g.getBounds().height-8),x=D=>Phaser.Math.Clamp(D,I,0);a.input.on("wheel",C,this),a.input.on("pointermove",T,this),a.input.on("pointerup",B,this);let A=!1,F=0;function C(D,S,w){M=x(M-w*.8),g.y=p+M}function T(D){A&&(M=x(M+(D.y-F)),F=D.y,g.y=p+M)}function B(){A=!1}return a.input.on("pointerdown",D=>{const S=new Phaser.Geom.Rectangle(c.x-r/2+f,p,r-f*2,u);Phaser.Geom.Rectangle.Contains(S,D.x,D.y)&&(A=!0,F=D.y)}),(K=a.input.keyboard)==null||K.once("keydown-ESC",s),{panel:c,title:d,maskG:m,list:g}}class Is{constructor(t,{onBase:e,onLocationPick:s,wallet:i,showPerks:o=!0}={}){this.s=t,this.onBase=e,this.onLocationPick=s,this.showPerks=o,this.padX=O.rem(t,12),this.padY=O.rem(t,6),this.gap=O.rem(t,10),this.radius=Math.max(10,Math.round(O.rem(t,10))),this.bgColor=2765124,this.bgAlpha=.95,this.strokeColor=16777215,this.strokeAlpha=.18,this.container=t.add.container(0,0).setDepth(O.z.keepnet+2),this.bg=t.add.graphics(),this.container.add(this.bg),this.btnBase=this._makeTextBtn("üè†  –ë–∞–∑–∞",()=>{var r;return(r=this.onBase)==null?void 0:r.call(this)}),this.btnExp=this._makeTextBtn("üó∫Ô∏è  –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è",()=>{Ts(this.s,r=>{var h;return(h=this.onLocationPick)==null?void 0:h.call(this,r)})});const n=i||{coins:0,gold:0,perks:0};this.chipCoins=this._makeChip(this._icCoin.bind(this)),this.chipGold=this._makeChip(this._icGold.bind(this)),this.container.add([this.btnBase,this.btnExp,this.chipCoins,this.chipGold]),this.showPerks&&(this.chipPerks=this._makeChip(this._icPerk.bind(this)),this.container.add(this.chipPerks)),this.divA=t.add.rectangle(0,0,2,22,16777215,.16),this.divB=t.add.rectangle(0,0,2,22,16777215,.16),this.container.add([this.divA,this.divB]),this.setWallet(n.coins|0,n.gold|0,n.perks|0),this.layoutInternal()}setPosition(t,e){this.container.setPosition(t,e)}setDepth(t){this.container.setDepth(t)}getBounds(){return new Phaser.Geom.Rectangle(this.container.x-this.w/2,this.container.y-this.h/2,this.w,this.h)}setWallet(t,e,s=0){this._setChipValue(this.chipCoins,t),this._setChipValue(this.chipGold,e),this.chipPerks&&this._setChipValue(this.chipPerks,s),this.layoutInternal()}layoutInternal(){const t=Math.max(this.btnBase.hit.height,this.btnExp.hit.height),s=Math.max(t,28),i=this.btnBase.hit.width,o=this.btnExp.hit.width,n=u=>u.bg.width,r=n(this.chipCoins),h=n(this.chipGold),l=this.chipPerks?n(this.chipPerks):0,c=r+this.gap+h+(this.chipPerks?this.gap+l:0);this.w=this.padX+i+this.gap+2+this.gap+o+this.gap+2+this.gap+c+this.padX,this.h=this.padY*2+s,this.bg.clear(),this.bg.fillStyle(this.bgColor,this.bgAlpha),this.bg.lineStyle(2,this.strokeColor,this.strokeAlpha),this.bg.fillRoundedRect(-this.w/2,-this.h/2,this.w,this.h,this.radius),this.bg.strokeRoundedRect(-this.w/2,-this.h/2,this.w,this.h,this.radius);let d=-this.w/2+this.padX;this.btnBase.setPosition(d+i/2,0),d+=i+this.gap,this.divA.setPosition(d+1,0),d+=2+this.gap,this.btnExp.setPosition(d+o/2,0),d+=o+this.gap,this.divB.setPosition(d+1,0),d+=2+this.gap;const f=0;this._placeChip(this.chipCoins,d,f),d+=r+this.gap,this._placeChip(this.chipGold,d,f),d+=h+(this.chipPerks?this.gap:0),this.chipPerks&&this._placeChip(this.chipPerks,d,f)}_makeTextBtn(t,e){const s=this.s.add.container(0,0),i=this.s.add.text(0,0,t,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5),o=i.width+O.rem(this.s,24),n=Math.max(36,i.height+O.rem(this.s,8)),r=this.s.add.rectangle(0,0,o,n,0,0).setInteractive({useHandCursor:!0});return r.on("pointerover",()=>i.setAlpha(.9)),r.on("pointerout",()=>i.setAlpha(1)),r.on("pointerdown",()=>e==null?void 0:e()),s.t=i,s.hit=r,s.add([i,r]),s}_makeChip(t){const e=this.s.add.container(0,0),s=76,o=this.s.add.rectangle(0,0,s,28,1975862,1).setOrigin(.5).setStrokeStyle(2,16777215,.12),n=this.s.add.graphics({x:-s/2+10,y:0});t(n,0,0);const r=this.s.add.text(n.x+16,0,"0",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#eaf2ff"}).setOrigin(0,.5);return e.bg=o,e.val=r,e.add([o,n,r]),e}_placeChip(t,e,s){t.setPosition(e+t.bg.width/2,s)}_setChipValue(t,e){const s=String(e|0);t.val.setText(s);const o=Math.max(64,t.val.width+28);t.bg.width=o,t.bg.setSize(o,t.bg.height)}_icCoin(t,e,s){t.fillStyle(16176227,1).fillCircle(e,s,7),t.fillStyle(16777215,.6).fillCircle(e-2.5,s-2.5,2),t.lineStyle(2,16777215,.18).strokeCircle(e,s,7)}_icGold(t,e,s){const n=[];for(let r=0;r<10;r++){const h=-Math.PI/2+r*Math.PI/5,l=r%2?3.2:7;n.push({x:e+Math.cos(h)*l,y:s+Math.sin(h)*l})}t.fillStyle(16770170,1).fillPoints(n,!0),t.lineStyle(2,16777215,.18).strokePoints(n,!0)}_icPerk(t,e,s){t.lineStyle(2,12179455,1),t.strokeCircle(e,s,7),t.beginPath(),t.moveTo(e-5,s),t.lineTo(e+5,s),t.moveTo(e,s-5),t.lineTo(e,s+5),t.strokePath()}}class Ds{constructor(t,e){if(this.s=t,this.opts=e||{},this.x=e.x|0,this.y=e.y|0,this.cols=Math.max(1,e.cols|0),this.rows=Math.max(1,e.rows|0),this.cellW=Math.max(8,e.cellW|0),this.cellH=Math.max(8,e.cellH|0),this.gap=(e.gap??16)|0,this.pageSize=this.cols*this.rows,this.items=[],this.pageIndex=0,this._pages=[],this._dots=[],this._wheelOn=!0,this.vw=this.cols*this.cellW+this.gap*(this.cols-1),this.vh=this.rows*this.cellH+this.gap*(this.rows-1),this.textStyle=Object.assign({fontFamily:"Inter, Arial, sans-serif",fontSize:"18px",color:"#c8cfdd"},e.textStyle||{}),this.bgColor=e.bgColor??1185570,this.strokeColor=e.strokeColor??2831172,this.root=t.add.container(this.x,this.y).setSize(this.vw,this.vh+28),e.showFrame!==!1){const s=t.add.graphics();s.fillStyle(this.bgColor,1).fillRoundedRect(0,0,this.vw,this.vh,14),s.lineStyle(2,this.strokeColor,1).strokeRoundedRect(0,0,this.vw,this.vh,14),this.root.add(s)}this.wrap=t.add.container(0,0).setSize(this.vw,this.vh),this.root.add(this.wrap),this.leftArrow=t.add.text(-12,this.vh/2,"‚Äπ",this.textStyle).setOrigin(1,.5).setInteractive({useHandCursor:!0}).on("pointerup",()=>this.prev()),this.rightArrow=t.add.text(this.vw+12,this.vh/2,"‚Ä∫",this.textStyle).setOrigin(0,.5).setInteractive({useHandCursor:!0}).on("pointerup",()=>this.next()),this.root.add(this.leftArrow),this.root.add(this.rightArrow),this.wrap.setInteractive(new Phaser.Geom.Rectangle(0,0,this.vw,this.vh),Phaser.Geom.Rectangle.Contains),this.wrap.on("wheel",(s,i,o)=>{this._wheelOn&&(o>0?this.next():this.prev())}),this._dotsY=this.vh+6,this._fadeIn=s=>this.s.tweens.add({targets:s,alpha:1,duration:160,ease:"Cubic.Out"}),this._fadeOut=(s,i)=>this.s.tweens.add({targets:s,alpha:0,duration:140,ease:"Cubic.Out",onComplete:i})}setItems(t){return this.items=Array.isArray(t)?t:[],this.pageIndex=0,this._buildPages(),this._updateArrows(),this._renderDots(),this}goTo(t,e=!1){const s=this._pages.length||1,i=Bs(t|0,0,s-1);if(i===this.pageIndex)return this;const o=this._pages[this.pageIndex],n=this._pages[i];return n.setVisible(!0),e?(o&&o.setVisible(!1).setAlpha(0),n.setAlpha(1)):(o&&this._fadeOut(o,()=>o.setVisible(!1)),this._fadeIn(n)),this.pageIndex=i,this._updateArrows(),this._highlightDots(),this}next(){return this.goTo(this.pageIndex+1)}prev(){return this.goTo(this.pageIndex-1)}setPosition(t,e){var s;return this.x=t|0,this.y=e|0,(s=this.root)==null||s.setPosition(this.x,this.y),this}setDepth(t){var e;return(e=this.root)==null||e.setDepth(t),this}enableWheel(t=!0){return this._wheelOn=!!t,this}destroy(){var t,e;(t=this.wrap)==null||t.removeAll(!0),(e=this.root)==null||e.removeAll(!0),this._pages.length=0,this._dots.length=0,this.wrap=null,this.root=null}_buildPages(){this.wrap.removeAll(!0),this._pages.length=0;const t=Math.max(1,Math.ceil(this.items.length/this.pageSize)),e=this.opts.makeCell,s=this.opts.makeStub||((o,n)=>{const r=this.s.add.graphics();r.fillStyle(922139,1).fillRoundedRect(0,0,this.cellW,this.cellH,12),r.lineStyle(2,this.strokeColor,1).strokeRoundedRect(0,0,this.cellW,this.cellH,12);const h=this.s.add.text(this.cellW/2,this.cellH/2,"‚Äî",Object.assign({},this.textStyle,{color:"#677089"})).setOrigin(.5);return this.s.add.container(0,0,[r,h]).setSize(this.cellW,this.cellH)});for(let o=0;o<t;o++){const n=this.s.add.container(0,0).setAlpha(0).setVisible(!1);this.wrap.add(n),this._pages.push(n);for(let r=0;r<this.pageSize;r++){const h=o*this.pageSize+r,l=r%this.cols,c=r/this.cols|0,d=l*(this.cellW+this.gap),f=c*(this.cellH+this.gap),u=this.items[h],p=u!==void 0?e(u,this.cellW,this.cellH,h):s(this.cellW,this.cellH);p.setPosition(d,f),n.add(p)}}const i=this._pages[this.pageIndex]||this._pages[0];i==null||i.setVisible(!0).setAlpha(1)}_renderDots(){this._dots.forEach(r=>r.destroy()),this._dots.length=0;const t=this._pages.length||1,e=this.vw/2|0,s=12,i=[];if(t<=7)for(let r=0;r<t;r++)i.push(r);else{i.push(0),this.pageIndex>2&&i.push("‚Ä¶");for(let r=this.pageIndex-1;r<=this.pageIndex+1;r++)r>0&&r<t-1&&i.push(r);this.pageIndex<t-3&&i.push("‚Ä¶"),i.push(t-1)}const o=i.length,n=e-(o-1)*s/2;i.forEach((r,h)=>{const l=n+h*s,c=r==="‚Ä¶"?"‚Ä¶":"‚Ä¢",d=r==="‚Ä¶"?"#677089":r===this.pageIndex?"#ffffff":"#677089",f=this.s.add.text(l,this._dotsY,c,Object.assign({},this.textStyle,{color:d})).setOrigin(.5);r!=="‚Ä¶"&&f.setInteractive({useHandCursor:!0}).on("pointerup",()=>this.goTo(r)),this.root.add(f),this._dots.push(f)})}_highlightDots(){this._pages.length,this._renderDots(),this._updateArrows()}_updateArrows(){var i,o,n,r;const t=this._pages.length||1,e=this.pageIndex<=0,s=this.pageIndex>=t-1;(i=this.leftArrow)==null||i.setAlpha(e?.35:1),(o=this.rightArrow)==null||o.setAlpha(s?.35:1),(n=this.leftArrow)==null||n.setInteractive({useHandCursor:!e}),(r=this.rightArrow)==null||r.setInteractive({useHandCursor:!s})}}function Bs(a,t,e){return Math.max(t,Math.min(e,a))}const Rs=[{id:"uncle_zhora",name:"–î—è–¥—å–∫–æ –ñ–æ—Ä–∞",portraitKey:"npc_uncle_zhora",category:"starter",stages:[{id:"s1",name:"–ü–µ—Ä—à—ñ –∫—Ä–æ–∫–∏ —Ä–∏–±–∞–ª–∫–∏",tasks:[{id:"t1",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 1 —Ä–∏–±—É",params:{},countGoal:1},{id:"t2",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 5 —Ä–∏–±",params:{},countGoal:5}],reward:{wallet:{coins:100}}},{id:"s2",name:"–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è",tasks:[{id:"t1",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 10 —Ä–∏–±",params:{},countGoal:10}],reward:{wallet:{coins:250}}},{id:"s3",name:"–°–ø—Ä–∞–≤–∂–Ω—ñ–π —Ä–∏–±–∞–ª–∫–∞",tasks:[{id:"t1",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 25 —Ä–∏–±",params:{},countGoal:25}],reward:{wallet:{coins:500,gold:1}}},{id:"s4",name:"–ú–∞–π—Å—Ç–µ—Ä –≤–æ–¥–æ–π–º–∏",tasks:[{id:"t1",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 50 —Ä–∏–±",params:{},countGoal:50}],reward:{wallet:{coins:1e3},items:[{id:"bait_worm",count:20}]}}]},{id:"weighmaster_pavlo",name:"–ü–∞–≤–ª–æ-–≤–∞–≥–∞—Ä",portraitKey:"npc_pavlo",category:"precision",stages:[{id:"s1",name:"–ú—ñ–ª—ñ–≥—Ä–∞–º–∏ –º–∞—é—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è",tasks:[{id:"t_exact_111",kind:"catch_weight_exact_g",name:"–ó–ª–æ–≤–∏ —Ä–∏–±—É —Ä—ñ–≤–Ω–æ 0.111 –∫–≥ (¬±2 –≥)",params:{valuesKg:[.111],toleranceG:2,ignoreZero:!0},countGoal:1},{id:"t_exact_222",kind:"catch_weight_exact_g",name:"–ó–ª–æ–≤–∏ —Ä–∏–±—É —Ä—ñ–≤–Ω–æ 0.222 –∫–≥ (¬±2 –≥)",params:{valuesKg:[.222],toleranceG:2,ignoreZero:!0},countGoal:1}],reward:{wallet:{coins:300}}},{id:"s2",name:"–¢–æ—á–Ω—ñ—Å—Ç—å –º–Ω–æ–∂–∏—Ç—å—Å—è",tasks:[{id:"t_exact_set",kind:"catch_weight_exact_g",name:"0.333, 0.444 –∞–±–æ 0.555 –∫–≥ (–±—É–¥—å-—è–∫–∞, ¬±2 –≥) ‚Äî –¥–≤—ñ—á—ñ",params:{valuesKg:[.333,.444,.555],toleranceG:2,ignoreZero:!0},countGoal:2},{id:"t_bait_ctrl",kind:"catch_bait_is",name:"–î–æ–≤–µ–¥–∏ –º–∞–π—Å—Ç–µ—Ä–Ω—ñ—Å—Ç—å ‚Äî –∑–ª–æ–≤–∏ 2 —Ä–∏–±–∏ –Ω–∞ —Ö–ª—ñ–±",params:{bait:"bread"},countGoal:2}],reward:{wallet:{coins:700},items:[{id:"bait_worm",count:8}]}},{id:"s3",name:"–¢–æ—á–Ω—ñ—Å—Ç—å —É –≤–µ—á—ñ—Ä–Ω—ñ–π —Ç–∏—à—ñ",tasks:[{id:"t_even",kind:"catch_time_of_day",name:"–õ–æ–≤–∏ –≤–≤–µ—á–µ—Ä—ñ (3 —Ä–∏–±–∏)",params:{time:"evening"},countGoal:3},{id:"t_exact_444",kind:"catch_weight_exact_g",name:"0.444 –∫–≥ (¬±2 –≥)",params:{valuesKg:[.444],toleranceG:2},countGoal:1}],reward:{wallet:{coins:1200},items:[{id:"bait_worm",count:12}]}}]},{id:"banker_olena",name:"–û–ª–µ–Ω–∞-–±–∞–Ω–∫—ñ—Ä",portraitKey:"npc_banker_olena",category:"economy",stages:[{id:"s1",name:"–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞",tasks:[{id:"t_coins_500",kind:"wallet_coins_at_least",name:"–ù–∞–∫–æ–ø–∏—á 500 —Å—Ä—ñ–±–ª–∞",params:{coins:500}},{id:"t_loot_once",kind:"loot_any",name:"–ó–Ω–∞–π–¥–∏ –±—É–¥—å-—è–∫–∏–π –ª—É—Ç",params:{},countGoal:1}],reward:{wallet:{coins:250}}},{id:"s2",name:"–ó–æ–ª–æ—Ç–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç",tasks:[{id:"t_gold2",kind:"wallet_gold_at_least",name:"–ú–∞–π 2 –∑–æ–ª–æ—Ç–∞",params:{gold:2}},{id:"t_coins_2000",kind:"wallet_coins_at_least",name:"–ù–∞–∫–æ–ø–∏—á 2000 —Å—Ä—ñ–±–ª–∞",params:{coins:2e3}}],reward:{wallet:{coins:800,gold:1}}},{id:"s3",name:"–§–æ–Ω–¥ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ",tasks:[{id:"t_coins_5000",kind:"wallet_coins_at_least",name:"–ë–∞–ª–∞–Ω—Å 5000 —Å—Ä—ñ–±–ª–∞",params:{coins:5e3}}],reward:{wallet:{coins:1500},items:[{id:"bait_worm",count:15}]}}]},{id:"rodsmith_oleg",name:"–û–ª–µ–≥-–∫–æ–≤–∞–ª—å –≤—É–¥–æ—á–æ–∫",portraitKey:"npc_rodsmith_oleg",category:"gear",stages:[{id:"s1",name:"–ü–µ—Ä—à—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏",tasks:[{id:"t_buy_rod_basic",kind:"buy_item_id",name:"–ö—É–ø–∏ –≤—É–¥–∫—É ¬´rod_basic¬ª",params:{itemId:"rod_basic"}},{id:"t_have_rod2",kind:"own_item_kind_count_at_least",name:"–ú–∞–π 2 –≤—É–¥–∫–∏ —É —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—ñ",params:{kind:"rod",count:2}}],reward:{wallet:{coins:300}}},{id:"s2",name:"–†–∏–±–∞–ª—å—Å—å–∫–∞ –º–∞–π—Å—Ç–µ—Ä–Ω—è",tasks:[{id:"t_buy_reel_basic",kind:"buy_item_id",name:"–ö—É–ø–∏ –∫–æ—Ç—É—à–∫—É ¬´reel_basic¬ª",params:{itemId:"reel_basic"}},{id:"t_have_line",kind:"own_item_kind_count_at_least",name:"–ú–∞–π 1 –ª—ñ—Å–∫—É",params:{kind:"line",count:1}}],reward:{wallet:{coins:600}}}]},{id:"mentor_ivan",name:"–Ü–≤–∞–Ω-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫",portraitKey:"npc_mentor_ivan",category:"progression",stages:[{id:"s1",name:"–°—Ç–∞–Ω—å –∫—Ä–∞—â–∏–º",tasks:[{id:"t_lvl2",kind:"reach_level_at_least",name:"–î–æ—Å—è–≥–Ω–∏ —Ä—ñ–≤–Ω—è 2",params:{level:2}}],reward:{wallet:{coins:200}}},{id:"s2",name:"–ó—Ä–æ—Å—Ç–∞–Ω–Ω—è",tasks:[{id:"t_lvl3",kind:"reach_level_at_least",name:"–î–æ—Å—è–≥–Ω–∏ —Ä—ñ–≤–Ω—è 3",params:{level:3}}],reward:{wallet:{coins:400}}},{id:"s3",name:"–°–ø—Ä–∞–≤–∂–Ω—ñ–π —à–ª—è—Ö",tasks:[{id:"t_lvl5",kind:"reach_level_at_least",name:"–î–æ—Å—è–≥–Ω–∏ —Ä—ñ–≤–Ω—è 5",params:{level:5}}],reward:{wallet:{coins:900,gold:1}}}]},{id:"fisher_katya",name:"–ö–∞—Ç—è-—Ä–∏–±–∞—á–∫–∞",portraitKey:"npc_katya",category:"technique",stages:[{id:"s1",name:"–õ–µ–≥–∫–∞ —Ä–æ–∑–º–∏–Ω–∫–∞",tasks:[{id:"t_count3",kind:"catch_count",name:"–ó–ª–æ–≤–∏ 3 —Ä–∏–±–∏",params:{},countGoal:3},{id:"t_worm2",kind:"catch_bait_is",name:"–ó–ª–æ–≤–∏ 2 —Ä–∏–±–∏ –Ω–∞ —á–µ—Ä–≤ º—è–∫–∞",params:{bait:"worm"},countGoal:2}],reward:{wallet:{coins:180}}},{id:"s2",name:"–¢–æ—á–Ω–∏–π –≤–∞–≥–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å",tasks:[{id:"t_w100_200",kind:"catch_weight_range_g",name:"–ó–ª–æ–≤–∏ 3 —Ä–∏–±–∏ –≤–∞–≥–æ—é 100‚Äì200 –≥",params:{weightG:[100,200]},countGoal:3},{id:"t_lake3",kind:"catch_in_location",name:"–ó–ª–æ–≤–∏ 3 —Ä–∏–±–∏ –Ω–∞ –æ–∑–µ—Ä—ñ",params:{locations:["lake"]},countGoal:3}],reward:{wallet:{coins:420}}},{id:"s3",name:"–ì–ª–∏–±–∏–Ω–∞ —ñ —á–∞—Å",tasks:[{id:"t_depth_shallow",kind:"catch_depth_range_m",name:"–ó–ª–æ–≤–∏ 4 —Ä–∏–±–∏ –Ω–∞ –≥–ª–∏–±–∏–Ω—ñ 0.5‚Äì1.5 –º",params:{depthM:[.5,1.5]},countGoal:4},{id:"t_evening3",kind:"catch_time_of_day",name:"–ó–ª–æ–≤–∏ 3 —Ä–∏–±–∏ –≤–≤–µ—á–µ—Ä—ñ",params:{time:"evening"},countGoal:3}],reward:{wallet:{coins:650},items:[{id:"bait_worm",count:12}]}},{id:"s4",name:"–ú–∞–π—Å—Ç—Ä–∏–Ω—è —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç—Ç—è",tasks:[{id:"t_species_mix",kind:"catch_species",name:"–ó–ª–æ–≤–∏ 2 –∫–∞—Ä–ø–∞ –∞–±–æ –ø–ª–æ—Ç–≤–∏",params:{species:["carp","roach"]},countGoal:2},{id:"t_loot_any",kind:"loot_any",name:"–î–æ–±—É–¥—å –±—É–¥—å-—è–∫–∏–π –ª—É—Ç",params:{},countGoal:1}],reward:{wallet:{coins:1e3,gold:1}}}]}];function lt(){return Rs}let Kt=!1;function $t(a={}){if(Kt)return;Kt=!0;const t=()=>{Kt=!1;try{window.dispatchEvent(new CustomEvent("quest-progress",{detail:a}))}catch{}};typeof requestAnimationFrame=="function"?requestAnimationFrame(t):setTimeout(t,0)}const ye="rf_quest_state_v1";let gt=Os()||{npcs:{},trackedNpcId:null};function Os(){try{return JSON.parse(localStorage.getItem(ye))}catch{return null}}function kt(){try{localStorage.setItem(ye,JSON.stringify(gt))}catch{}}function ht(a){return gt.npcs[a]||(gt.npcs[a]={stageIndex:0,tasks:{}}),gt.npcs[a]}function dt(a,t={}){$t({type:a,...t})}const $={getNPC(a){return ht(a)},getTrackedNpcId(){return gt.trackedNpcId??null},setTrackedNpcId(a){gt.trackedNpcId=a||null,kt(),dt("tracked-change",{npcId:gt.trackedNpcId})},getActiveStage(a){var s;const t=lt().find(i=>i.id===a);if(!t)return null;const e=ht(a).stageIndex|0;return((s=t.stages)==null?void 0:s[e])??null},isTaskDone(a,t){const e=ht(a).tasks[t.id]||{};return t.countGoal!=null?(e.count|0)>=(t.countGoal|0):!!e.done},addTaskCount(a,t,e=1){const s=ht(a),i=s.tasks[t]||(s.tasks[t]={count:0});return i.count=Math.max(0,(i.count|0)+(e|0)),kt(),dt("task-count",{npcId:a,taskId:t,count:i.count}),i.count},markTaskDone(a,t,e=!0){const s=ht(a);s.tasks[t]={...s.tasks[t]||{},done:!!e},kt(),dt("task-done",{npcId:a,taskId:t})},tryAdvanceStage(a){var n;const t=lt().find(r=>r.id===a);if(!t)return!1;const e=ht(a),s=(n=t.stages)==null?void 0:n[e.stageIndex|0];if(!s)return!1;if((Array.isArray(s.tasks)?s.tasks:[]).every(r=>this.isTaskDone(a,r))){const r=e.stageIndex|0;return e.stageIndex=r+1,kt(),dt("stage-complete",{npcId:a,stageIndex:r}),dt("stage-changed",{npcId:a,stageIndex:e.stageIndex}),!0}return!1},isStageComplete(a){var o;const t=lt().find(n=>n.id===a);if(!t)return!1;const e=ht(a).stageIndex|0,s=(o=t.stages)==null?void 0:o[e];return s?(Array.isArray(s.tasks)?s.tasks:[]).every(n=>this.isTaskDone(a,n)):!1},getHeaderProgress(a){var h;const t=lt().find(l=>l.id===a);if(!t)return{cur:0,goal:0,task:null};const e=ht(a).stageIndex|0,s=(h=t.stages)==null?void 0:h[e];if(!s)return{cur:0,goal:0,task:null};const i=(s.tasks||[]).find(l=>!this.isTaskDone(a,l)&&l.countGoal!=null)||(s.tasks||[]).find(l=>l.countGoal!=null)||null;if(!i)return{cur:0,goal:0,task:null};const o=ht(a).tasks[i.id]||{count:0},n=Math.min(o.count|0,i.countGoal|0),r=i.countGoal|0;return{cur:n,goal:r,task:i}},claimStageReward(a){var h;const t=lt().find(l=>l.id===a);if(!t)return null;const e=ht(a),s=e.stageIndex|0,i=(h=t.stages)==null?void 0:h[s];if(!i||!(Array.isArray(i.tasks)?i.tasks:[]).every(l=>this.isTaskDone(a,l)))return null;const r=i.reward||null;return e.stageIndex=s+1,e.tasks={},kt(),dt("stage-claimed",{npcId:a,stageIndex:s}),dt("stage-changed",{npcId:a,stageIndex:e.stageIndex}),r},resetAll(){gt={npcs:{},trackedNpcId:null},kt(),dt("reset")}};let Gt=null;function Fs(a){Gt=typeof a=="function"?a:null}function Ws(a){if(!(!Gt||!a))try{Gt(a)}catch{}}function Rt(a){const t=_e(a);new zs(a,t).open()}function _e(a){var t;if(!a.__modalHost){const e=(t=O.z)==null?void 0:t.modal;a.__modalHost=new de(a,e)}return a.__modalHost}class zs{constructor(t,e){this.s=t,this.host=e,this.cols=3,this.rows=2,this.gap=16,this.headerH=48,this.pad=18,this.cardTargetW=180,this.cardTargetH=208,this.cardW=0,this.cardH=0,this.vw=0,this.vh=0,this.winW=0,this.winH=0,this.x0=0,this.y0=0,this.root=null,this.grid=null,this._resizeHandler=null,this._keyLeft=null,this._keyRight=null}open(){const t=this.host.open((s,i)=>{var o,n,r,h,l;this.root=s,this._measure(),this._buildWindow(),this._buildGrid(),this.grid.setItems(lt()),(n=(o=this.s.input)==null?void 0:o.setTopOnly)==null||n.call(o,!0),this._onLeft=()=>this.grid.prev(),this._onRight=()=>this.grid.next(),(r=this.s.input.keyboard)==null||r.on("keydown-LEFT",this._onLeft),(h=this.s.input.keyboard)==null||h.on("keydown-RIGHT",this._onRight),(l=i.onEsc)==null||l.call(i,()=>t.close()),this._resizeHandler=()=>this._rebuild(),this.s.scale.on("resize",this._resizeHandler)}),e=t.close;t.close=()=>{this._cleanup(),e()}}_measure(){const t=this.s.scale.width,e=this.s.scale.height,s=Math.floor(t*.9),i=Math.floor(e*.86),o=this.cardTargetW*this.cols+this.gap*(this.cols-1),n=this.cardTargetH*this.rows+this.gap*(this.rows-1),r=28,h=Math.min(1,(s-this.pad*2)/o,(i-(this.headerH+r+this.pad))/n);this.cardW=Math.max(120,Math.floor(this.cardTargetW*h)),this.cardH=Math.max(140,Math.floor(this.cardTargetH*h)),this.vw=this.cardW*this.cols+this.gap*(this.cols-1),this.vh=this.cardH*this.rows+this.gap*(this.rows-1),this.winW=Math.min(this.vw+this.pad*2,s),this.winH=Math.min(this.headerH+this.vh+r+this.pad,i),this.x0=Math.round((t-this.winW)/2),this.y0=Math.round((e-this.winH)/2)}_buildWindow(){var h,l,c,d,f,u,p;const t=this.s,e=t.scale.width,s=t.scale.height;(h=this._screenBlock)==null||h.destroy(),this._screenBlock=(c=(l=t.add.zone(0,0,e,s).setOrigin(0,0)).setScrollFactor)==null?void 0:c.call(l,0).setInteractive({useHandCursor:!1});const i=g=>{var m;return(m=g==null?void 0:g.stopPropagation)==null?void 0:m.call(g)};this._screenBlock.on("pointerdown",(g,m,_,b)=>i(b)),this._screenBlock.on("pointerup",(g,m,_,b)=>i(b)),this._screenBlock.on("wheel",(g,m,_,b)=>i(b)),this.root.add(this._screenBlock),(d=this._panelHit)==null||d.destroy(),this._panelHit=t.add.zone(this.x0,this.y0,this.winW,this.winH).setOrigin(0,0).setInteractive({useHandCursor:!1}),this._panelHit.on("pointerdown",(g,m,_,b)=>i(b)),this._panelHit.on("pointerup",(g,m,_,b)=>i(b)),this._panelHit.on("wheel",(g,m,_,b)=>i(b)),this.root.add(this._panelHit);const o=t.add.graphics();o.fillStyle(((f=O.colors)==null?void 0:f.modalBg)??987674,1).fillRoundedRect(this.x0,this.y0,this.winW,this.winH,18),o.lineStyle(2,2831172,1).strokeRoundedRect(this.x0,this.y0,this.winW,this.winH,18),this.root.add(o);const n=t.add.text(this.x0+this.pad,this.y0+this.pad,"–ö–≤–µ—Å—Ç–∏",{fontFamily:((u=O.fonts)==null?void 0:u.ui)||"Inter, Arial, sans-serif",fontSize:"20px",color:"#fff"}).setOrigin(0,0);this.root.add(n);const r=t.add.text(this.x0+this.winW-this.pad,this.y0+this.pad,"‚úï",{fontFamily:((p=O.fonts)==null?void 0:p.ui)||"Inter, Arial, sans-serif",fontSize:"20px",color:"#a8b0be"}).setOrigin(1,0).setInteractive({useHandCursor:!0});r.on("pointerup",()=>this.host.close(this.root)),this.root.add(r)}_buildGrid(){var e;const t=this.s;this.grid=new Ds(t,{x:0,y:0,cols:this.cols,rows:this.rows,cellW:this.cardW,cellH:this.cardH,gap:this.gap,showFrame:!0,makeCell:(s,i,o)=>this._makeNpcCard(s,i,o),makeStub:(s,i)=>this._makeStub(s,i)}),this.root.add(this.grid.root),this.grid.setPosition(this.x0+this.pad,this.y0+this.headerH),this.grid.setDepth(((e=O.z)==null?void 0:e.modal)+1)}_rebuild(){var e,s,i;const t=((e=this.grid)==null?void 0:e.pageIndex)||0;(s=this.grid)==null||s.destroy(),(i=this.root)==null||i.removeAll(!0),this._measure(),this._buildWindow(),this._buildGrid(),this.grid.setItems(lt()).goTo(t,!0)}_cleanup(){var t,e,s,i,o;this.s.scale.off("resize",this._resizeHandler),(t=this.s.input.keyboard)==null||t.off("keydown-LEFT",this._onLeft),(e=this.s.input.keyboard)==null||e.off("keydown-RIGHT",this._onRight),this._onLeft=this._onRight=null,(s=this._screenBlock)==null||s.destroy(),this._screenBlock=null,(i=this._panelHit)==null||i.destroy(),this._panelHit=null,(o=this.grid)==null||o.destroy(),this.grid=null,this.root=null}_makeNpcCard(t,e,s){var u,p,g,m;const i=this.s,o=i.add.graphics();o.fillStyle(1448482,1).fillRoundedRect(0,0,e,s,12),o.lineStyle(2,2831172,1).strokeRoundedRect(0,0,e,s,12);const n=i.add.graphics().setAlpha(0);n.lineStyle(2,((u=O.colors)==null?void 0:u.accent)??8050687,1).strokeRoundedRect(1,1,e-2,s-2,11);let r;if(t.portraitKey&&i.textures.exists(t.portraitKey)){r=i.add.image(e/2,56,t.portraitKey).setOrigin(.5);const _=62;r.setScale(Math.min(_/(r.width||_),_/(r.height||_)))}else r=i.add.text(e/2,56,"üßë‚Äçü¶±",{fontSize:"38px"}).setOrigin(.5);const h=i.add.text(e/2,108,t.name,{fontFamily:((p=O.fonts)==null?void 0:p.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:"#fff",wordWrap:{width:e-20},align:"center"}).setOrigin(.5),l=i.add.text(e/2,136,this._stageLabel(t.id),{fontFamily:((g=O.fonts)==null?void 0:g.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#a8b0be"}).setOrigin(.5),c=i.add.container(0,0,[o,n,r,h,l]).setSize(e,s);if(((m=$.getTrackedNpcId)==null?void 0:m.call($))===t.id){const _=i.add.text(e-10,8,"‚òÖ",{fontSize:"16px",color:"#7ad7ff"}).setOrigin(1,0);c.add(_)}const f=i.add.zone(0,0,e,s).setOrigin(0,0).setInteractive({useHandCursor:!0});return c.add(f),f.on("pointerover",()=>{n.setAlpha(1),c.setScale(1.02),c.y-=2}),f.on("pointerout",()=>{n.setAlpha(0),c.setScale(1),c.y+=2}),f.on("pointerup",()=>Vt(this.s,t)),c}_makeStub(t,e){var o;const s=this.s.add.graphics();s.fillStyle(856346,.6).fillRoundedRect(0,0,t,e,12),s.lineStyle(2,2831172,1).strokeRoundedRect(0,0,t,e,12);const i=this.s.add.text(t/2,e/2,"‚Äî",{fontFamily:((o=O.fonts)==null?void 0:o.ui)||"Inter, Arial, sans-serif",fontSize:"18px",color:"#495065"}).setOrigin(.5);return this.s.add.container(0,0,[s,i]).setSize(t,e)}_stageLabel(t){const e=$.getActiveStage(t);return e?e.name:"–ó–∞–≤–µ—Ä—à–µ–Ω–æ"}}function Vt(a,t){const e=_e(a),s=a;e.open((i,o)=>{var G,L,Y,j,nt,Q,et,mt,vt,Pt,V,q,it,tt;const n=s.scale.width,r=s.scale.height,h=Math.min(720,Math.floor(n*.78)),l=Math.min(560,Math.floor(r*.78)),c=Math.round((n-h)/2),d=Math.round((r-l)/2),f=18;(L=(G=s.input)==null?void 0:G.setTopOnly)==null||L.call(G,!0);const u=s.add.zone(c,d,h,l).setOrigin(0,0).setInteractive({useHandCursor:!1});u.on("pointerdown",(U,ot,rt,N)=>{var Z;return(Z=N==null?void 0:N.stopPropagation)==null?void 0:Z.call(N)}),u.on("pointerup",(U,ot,rt,N)=>{var Z;return(Z=N==null?void 0:N.stopPropagation)==null?void 0:Z.call(N)}),u.on("wheel",(U,ot,rt,N)=>{var Z;return(Z=N==null?void 0:N.stopPropagation)==null?void 0:Z.call(N)}),i.add(u);const p=s.add.graphics();p.fillStyle(((Y=O.colors)==null?void 0:Y.modalBg)??987674,1).fillRoundedRect(c,d,h,l,16),p.lineStyle(2,2831172,1).strokeRoundedRect(c,d,h,l,16),i.add(p);const g=s.add.text(c+f,d+f,"–î–µ—Ç–∞–ª—ñ –∫–≤–µ—Å—Ç—ñ–≤",{fontFamily:((j=O.fonts)==null?void 0:j.ui)||"Inter, Arial, sans-serif",fontSize:"18px",color:"#fff"}).setOrigin(0,0);i.add(g);const m=s.add.text(c+h-f,d+f,"‚úï",{fontFamily:((nt=O.fonts)==null?void 0:nt.ui)||"Inter, Arial, sans-serif",fontSize:"18px",color:"#a8b0be"}).setOrigin(1,0).setInteractive({useHandCursor:!0});m.on("pointerdown",(U,ot,rt,N)=>{var Z;return(Z=N==null?void 0:N.stopPropagation)==null?void 0:Z.call(N)}),m.on("pointerup",(U,ot,rt,N)=>{var Z;(Z=N==null?void 0:N.stopPropagation)==null||Z.call(N),o.close()}),i.add(m);const _=$.getTrackedNpcId()===t.id,b=s.add.text(c+h-f-140,d+f,_?"–ê–∫—Ç–∏–≤–Ω–∏–π":"–ó—Ä–æ–±–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–º",{fontFamily:((Q=O.fonts)==null?void 0:Q.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:_?"#7ad7ff":"#ffffff"}).setOrigin(0,0).setInteractive({useHandCursor:!0});b.on("pointerup",()=>{var U;$.setTrackedNpcId(t.id),b.setText("–ê–∫—Ç–∏–≤–Ω–∏–π").setColor("#7ad7ff"),(U=s.showToast)==null||U.call(s,"–ö–≤–µ—Å—Ç –∑—Ä–æ–±–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω–∏–º")}),i.add(b);const y=s.add.container(c+f,d+54);i.add(y);const k=s.add.graphics();k.fillStyle(1448482,1).fillRoundedRect(0,0,h-f*2,96,12),k.lineStyle(2,2831172,1).strokeRoundedRect(0,0,h-f*2,96,12),y.add(k);let P;if(t.portraitKey&&s.textures.exists(t.portraitKey)){P=s.add.image(46,48,t.portraitKey).setOrigin(.5);const U=64;P.setScale(Math.min(U/(P.width||U),U/(P.height||U)))}else P=s.add.text(46,48,"üßë‚Äçü¶±",{fontSize:"42px"}).setOrigin(.5);y.add(P);const M=$.getActiveStage(t.id),I=M?M.name:"–£—Å—ñ —Å—Ç–∞–¥—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω—ñ",x=s.add.text(90,18,t.name,{fontFamily:((et=O.fonts)==null?void 0:et.ui)||"Inter, Arial, sans-serif",fontSize:"18px",color:"#fff"}).setOrigin(0,0);y.add(x);const A=s.add.text(90,46,I,{fontFamily:((mt=O.fonts)==null?void 0:mt.ui)||"Inter, Arial, sans-serif",fontSize:"13px",color:"#a8b0be"}).setOrigin(0,0);y.add(A);const F=$.getHeaderProgress(t.id);if((F.goal|0)>0){const rt=h-f*2-90-16,N=10,Z=6,xt=s.add.graphics();xt.fillStyle(922658,1).fillRoundedRect(90,72,rt,N,Z);const be=Phaser.Math.Clamp((F.cur||0)/(F.goal||1),0,1);xt.fillStyle(3843071,1).fillRoundedRect(90,72,Math.max(2,Math.round(rt*be)),N,Z),y.add(xt);const xe=s.add.text(90+rt,72+N+2,`${F.cur}/${F.goal}`,{fontFamily:((vt=O.fonts)==null?void 0:vt.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#a8b0be"}).setOrigin(1,0);y.add(xe)}const C=110,T=l-54-C-f,B=s.add.graphics();B.fillStyle(16777215,1).fillRoundedRect(0,C,h-f*2,T,12);const K=B.createGeometryMask();B.setVisible(!1),i.add(B);const D=s.add.container(c+f,d+54).setMask(K).setSize(h-f*2,T),S=s.add.container(0,C);D.add(S),i.add(D);let w=0;const W=s.add.text(0,w,"–ó–∞–≤–¥–∞–Ω–Ω—è",{fontFamily:((Pt=O.fonts)==null?void 0:Pt.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:"#e0e6f1"}).setOrigin(0,0);if(S.add(W),w+=24,(V=M==null?void 0:M.tasks)!=null&&V.length)for(const U of M.tasks){const ot=Hs(s,t.id,U,h-f*2);ot.y=w,S.add(ot),w+=44}else{const U=s.add.text(0,w,"–ó–∞–≤–¥–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ",{fontFamily:((q=O.fonts)==null?void 0:q.ui)||"Inter, Arial, sans-serif",fontSize:"13px",color:"#a8b0be"}).setOrigin(0,0);S.add(U),w+=22}w+=8;const z=s.add.text(0,w,"–ù–∞–≥–æ—Ä–æ–¥–∞",{fontFamily:((it=O.fonts)==null?void 0:it.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:"#e0e6f1"}).setOrigin(0,0);S.add(z),w+=28;const R=Ks(s,M==null?void 0:M.reward,h-f*2);R.y=w,S.add(R),w+=(R.height||30)+8;const E=$.isStageComplete(t.id),X=Es(s,0,w+8,h-f*2,E,()=>{var ot;const U=$.claimStageReward(t.id);U&&(Ws(U),(ot=s.showToast)==null||ot.call(s,"–ù–∞–≥–æ—Ä–æ–¥—É –æ—Ç—Ä–∏–º–∞–Ω–æ"),o.close(),Vt(s,t))});S.add(X),w+=X.height+16,S.setSize(h-f*2,w),D.setInteractive(new Phaser.Geom.Rectangle(0,0,h-f*2,l-54-f),Phaser.Geom.Rectangle.Contains);let H=0;D.on("wheel",(U,ot,rt,N)=>{var xt;(xt=N==null?void 0:N.stopPropagation)==null||xt.call(N);const Z=Math.max(0,(S.height||0)-T);H=Phaser.Math.Clamp(H+(rt>0?30:-30),0,Z),S.y=C-H}),(tt=o.onEsc)==null||tt.call(o,()=>o.close())})}function Hs(a,t,e,s){var u,p;const i=$.isTaskDone(t,e),o=a.add.graphics();o.fillStyle(1712176,1).fillRoundedRect(0,0,s,36,10),o.lineStyle(1,2634054,1).strokeRoundedRect(0,0,s,36,10);const n=a.add.text(10,18,i?"‚úî":"‚óã",{fontSize:"16px",color:i?"#7fff9f":"#9aa3b6"}).setOrigin(0,.5),r=a.add.text(32,18,e.name||e.id,{fontFamily:((u=O.fonts)==null?void 0:u.ui)||"Inter, Arial, sans-serif",fontSize:"13px",color:"#fff"}).setOrigin(0,.5);let h=null,l="";if(e.countGoal!=null){const g=$.getNPC(t).tasks[e.id]||{count:0},m=Math.min(g.count|0,e.countGoal|0),_=e.countGoal?m/e.countGoal:0;l=`${m}/${e.countGoal}`,h=a.add.graphics();const b=s-112,y=12,k=92,P=12,M=6;h.fillStyle(922658,1).fillRoundedRect(b,y,k,P,M),h.fillStyle(3843071,1).fillRoundedRect(b,y,Math.max(2,Math.round(k*_)),P,M)}const c=a.add.text(s-10,18,l,{fontFamily:((p=O.fonts)==null?void 0:p.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#a8b0be"}).setOrigin(1,.5),d=[o,n,r,c];h&&d.push(h);const f=a.add.container(0,0,d).setSize(s,36);return f.setInteractive(new Phaser.Geom.Rectangle(0,0,s,36),Phaser.Geom.Rectangle.Contains),f.on("pointerover",()=>o.setAlpha(.95)),f.on("pointerout",()=>o.setAlpha(1)),f}function Ks(a,t,e){var l,c,d,f;const s=a.add.container(0,0);let i=0,o=0,n=8;const r=[],h=u=>{var k;const m=a.add.text(0,12,u,{fontFamily:((k=O.fonts)==null?void 0:k.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#dfe7f5"}).setOrigin(0,.5),_=a.add.graphics(),b=Math.round(m.width+10*2);_.fillStyle(1778484,1).fillRoundedRect(0,0,b,24,12),_.lineStyle(1,2766930,1).strokeRoundedRect(0,0,b,24,12);const y=a.add.container(0,0,[_,m]).setSize(b,24);r.push(y)};if((l=t==null?void 0:t.wallet)!=null&&l.coins&&h(`ü™ô –ú–æ–Ω–µ—Ç–∏ +${t.wallet.coins}`),(c=t==null?void 0:t.wallet)!=null&&c.gold&&h(`‚≠ê –ó–æ–ª–æ—Ç–æ +${t.wallet.gold}`),(d=t==null?void 0:t.perks)!=null&&d.skillPoints&&h(`üí° –û—á–∫–∏ –Ω–∞–≤–∏—á–æ–∫ +${t.perks.skillPoints}`),(f=t==null?void 0:t.perks)!=null&&f.perkId&&h(`üéØ –ü–µ—Ä–∫: ${t.perks.perkId}`),Array.isArray(t==null?void 0:t.items))for(const u of t.items)h(`üéÅ ${u.id} √ó${u.count}`);r.length||h("‚Äî");for(const u of r)i+u.width>e&&(i=0,o+=30),u.setPosition(i,o+12),s.add(u),i+=u.width+n;return s.setSize(e,o+28),s}function Es(a,t,e,s,i,o){var b;const c=a.add.text(0,0,"üéÅ –ó–∞–±—Ä–∞—Ç–∏ –Ω–∞–≥–æ—Ä–æ–¥—É",{fontFamily:((b=O.fonts)==null?void 0:b.ui)||"Inter, Arial, sans-serif",fontSize:"13px",color:"#ffffff"}).setOrigin(.5),d=Math.max(188,Math.min(s,Math.ceil(c.width+14*2))),f=a.add.graphics(),u=i?2849343:3359311,p=i?7459978:2766930;f.fillStyle(u,1).fillRoundedRect(-d/2,-36/2,d,36,10),f.lineStyle(1,p,1).strokeRoundedRect(-d/2,-36/2,d,36,10);const g=a.add.container(t+d/2,e+36/2,[f,c]).setSize(d,36);g.height=36;const m=a.add.zone(0,0,d,36).setOrigin(.5).setInteractive({useHandCursor:i}),_=(y,k,P,M)=>{var I;return(I=M==null?void 0:M.stopPropagation)==null?void 0:I.call(M)};return m.on("pointerdown",_),m.on("pointerupoutside",_),m.on("pointermove",_),m.on("wheel",_),i?(m.on("pointerover",()=>f.setAlpha(.92)),m.on("pointerout",()=>f.setAlpha(1)),m.on("pointerup",(y,k,P,M)=>{_(y,k,P,M),o==null||o()})):m.on("pointerup",(y,k,P,M)=>{var I;_(y,k,P,M),(I=a.showToast)==null||I.call(a,"–ó–∞–≤–µ—Ä—à—ñ—Ç—å —É—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è")}),g.add(m),g}class Ls{constructor(t,e={}){var i,o,n,r,h,l,c;this.s=t,this.onOpen=typeof e.onOpen=="function"?e.onOpen:null,this.w=Math.max(220,e.width|0||280),this.h=64,this._col={panel:((i=O.colors)==null?void 0:i.panelSubBg)??((o=O.color)==null?void 0:o.panel)??1185570,stroke:2831172,barBg:922658,barFg:3843071,barFgReady:3785325,text:"#ffffff",sub:"#a8b0be",ok:"#93f5b9",ddRow:1185830,ddRowHover:1712947,footerBg:988449},this._tune={barBottom:18,ddTextTop:8,rootHitPad:10},this.isOpen=!1,this._toggleLock=0,this._ignoreNextUp=!1,this._lastKey="",this._nextPollT=0,this._lastProgress={cur:0,goal:0,ready:!1};const s=(n=O.z)==null?void 0:n.wallet;this.root=t.add.container(e.x|0||0,e.y|0||0).setSize(this.w,this.h),this.root.setDepth(s+1),this.bg=t.add.graphics(),this._paintPanel(),this.avatar=t.add.text(18,this.h/2,"üßë‚Äçü¶±",{fontSize:"26px"}).setOrigin(.5),this.title=t.add.text(44,8,"‚Äî",{fontFamily:((r=O.fonts)==null?void 0:r.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:this._col.text}).setOrigin(0,0),this.sub=t.add.text(44,24,"‚Äî",{fontFamily:((h=O.fonts)==null?void 0:h.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:this._col.sub}).setOrigin(0,0),this.chev=t.add.text(this.w-28,6,"‚ñæ",{fontFamily:((l=O.fonts)==null?void 0:l.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:"#a8b0be"}).setOrigin(0,0).setInteractive({useHandCursor:!0}),this.pbar=t.add.graphics(),this.ptext=t.add.text(this.w-10,this.h-10,"",{fontFamily:((c=O.fonts)==null?void 0:c.ui)||"Inter, Arial, sans-serif",fontSize:"11px",color:this._col.sub}).setOrigin(1,1),this.root.add([this.bg,this.avatar,this.title,this.sub,this.pbar,this.ptext,this.chev]),this.ddWrap=t.add.container(0,this.h-2).setVisible(!1).setAlpha(0),this.root.add(this.ddWrap),this.ddBg=t.add.graphics(),this.ddWrap.add(this.ddBg),this._ddRows=[],this._ddShadow=null,this._updateHitArea(),this.root.on("pointerup",()=>{if(this._ignoreNextUp){this._ignoreNextUp=!1;return}this.s.time.now<this._toggleLock||(this._toggleLock=this.s.time.now+150,this._toggleDropdown())}),this.chev.on("pointerup",(d,f,u,p)=>{var g;(g=p==null?void 0:p.stopPropagation)==null||g.call(p),this._ignoreNextUp=!0,this._toggleDropdown()}),this.refresh(!0),this._onQuestEvt=()=>{this.refresh(!0),this.ddWrap.visible&&this._buildDropdown()},window.addEventListener("quest-progress",this._onQuestEvt)}setPosition(t,e){var s;return(s=this.root)==null||s.setPosition(t,e),this}setVisible(t){var e;return(e=this.root)==null||e.setVisible(!!t),this}setWidth(t){var s,i;const e=Math.max(220,t|0);return e===this.w?this:(this.w=e,(s=this.root)==null||s.setSize(this.w,this.h),this._updateHitArea(),this._paintPanel(),this.ptext.setX(this.w-10),this.chev.setX(this.w-28),(i=this.openBtn)==null||i.setPosition(this.w-12,10),this._drawProgress(this._lastProgress.cur,this._lastProgress.goal,this._lastProgress.ready),this.ddWrap.visible&&this._buildDropdown(),this)}update(){const t=this.s.time.now|0;t<this._nextPollT||(this._nextPollT=t+500,this.refresh(!1))}refresh(t=!1){var i,o;const e=Qt(),s=e?`${e.npc.id}|${e.stage.id}|${((i=e.task)==null?void 0:i.id)||"none"}|${e.cur}/${e.goal}|${e.ready?"1":"0"}`:"none";if(!(!t&&s===this._lastKey)){if(this._lastKey=s,!e){this._ensureAvatarText(),this.avatar.setText("üß©"),this.title.setText("–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–≤–µ—Å—Ç—ñ–≤"),this.sub.setText("–í—ñ–¥–∫—Ä–∏–π ¬´–ö–≤–µ—Å—Ç–∏¬ª, —â–æ–± –ø–æ—á–∞—Ç–∏"),this._drawProgress(0,0,!1),this.ddWrap.visible&&this._buildDropdown();return}if(e.npc.portraitKey&&this.s.textures.exists(e.npc.portraitKey)){((o=this.avatar)==null?void 0:o.type)==="Text"?(this.avatar.destroy(),this.avatar=this.s.add.image(18,this.h/2,e.npc.portraitKey).setOrigin(.5),this.root.addAt(this.avatar,1)):this.avatar.setTexture(e.npc.portraitKey);const n=28,r=Math.min(n/(this.avatar.width||n),n/(this.avatar.height||n));this.avatar.setScale(r)}else this._ensureAvatarText(),this.avatar.setText("üßë‚Äçü¶±");this.title.setText(e.npc.name),this.sub.setText(e.task?e.task.name:e.stage.name),this._drawProgress(e.cur,e.goal,e.ready),this.ddWrap.visible&&this._buildDropdown()}}_updateHitArea(){const t=this._tune.rootHitPad,e=new Phaser.Geom.Rectangle(-t,-t,this.w+t*2,this.h+t*2);this.root.setSize(this.w,this.h),this.root.input&&this.root.removeInteractive(),this.root.setInteractive(e,Phaser.Geom.Rectangle.Contains)}_paintPanel(){this.bg.clear(),this.bg.fillStyle(this._col.panel,1).fillRoundedRect(0,0,this.w,this.h,12),this.bg.lineStyle(2,this._col.stroke,1).strokeRoundedRect(0,0,this.w,this.h,12)}_drawProgress(t,e,s=!1){this._lastProgress={cur:t|0,goal:e|0,ready:!!s};const i=44,o=this.w-i-96,n=8,r=4,h=this.h-this._tune.barBottom,l=e?Phaser.Math.Clamp(t/e,0,1):0;this.pbar.clear(),this.pbar.fillStyle(this._col.barBg,1).fillRoundedRect(i,h,o,n,r),this.pbar.fillStyle(s?this._col.barFgReady:this._col.barFg,1).fillRoundedRect(i,h,Math.max(2,Math.round(o*l)),n,r),this.ptext.setPosition(this.w-12-88,h+n).setOrigin(1,1),s?this.ptext.setText("‚úì –ì–æ—Ç–æ–≤–æ").setColor(this._col.ok):this.ptext.setText(e?`${t}/${e}`:"").setColor(this._col.sub)}_toggleDropdown(){this.isOpen?this._closeDropdown():this._openDropdown()}_openDropdown(){var t,e;this.isOpen||(this._buildDropdown(),this.ddWrap.setVisible(!0).setAlpha(0),this.s.tweens.add({targets:this.ddWrap,alpha:1,duration:120,ease:"Cubic.Out"}),this.isOpen=!0,(e=(t=this.chev)==null?void 0:t.setText)==null||e.call(t,"‚ñ¥"))}_closeDropdown(t=!1){var s,i;if(!this.isOpen)return;const e=()=>{this.ddWrap.setVisible(!1).setAlpha(0)};t?e():this.s.tweens.add({targets:this.ddWrap,alpha:0,duration:120,ease:"Cubic.Out",onComplete:e}),this.isOpen=!1,(i=(s=this.chev)==null?void 0:s.setText)==null||i.call(s,"‚ñæ")}_buildDropdown(){var u,p,g;const t=Qt();if(this._ddRows.forEach(m=>m.destroy()),this._ddRows.length=0,this.ddBg.clear(),(u=this._ddShadow)==null||u.destroy(),this._ddShadow=null,!t||!t.stage){this.ddWrap.setVisible(!1).setAlpha(0);return}const e=((p=t.task)==null?void 0:p.id)||null,i=(Array.isArray(t.stage.tasks)?t.stage.tasks:[]).filter(m=>((m==null?void 0:m.id)||"none")!==e).map(m=>{const{cur:_,goal:b,done:y}=Gs(t.npc.id,m);return{title:m.name||m.id,cur:_,goal:b,done:y,npc:t.npc,isClaim:!1}});(g=$.isStageComplete)!=null&&g.call($,t.npc.id)&&i.unshift({title:"–°—Ç–∞–¥—ñ—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚Äî –∑–∞–±–µ—Ä—ñ—Ç—å –Ω–∞–≥–æ—Ä–æ–¥—É",cur:0,goal:0,done:!0,npc:t.npc,isClaim:!0});const o=this.w,n=40,r=10,h=(i.length+1)*n+r*2;this._ddShadow=this.s.add.graphics();const l={tl:0,tr:0,bl:14,br:14};this._ddShadow.fillStyle(0,.22).fillRoundedRect(2,6,o,h,l),this.ddWrap.add(this._ddShadow);const c={tl:0,tr:0,bl:12,br:12};this.ddBg.fillStyle(this._col.panel,1).fillRoundedRect(0,0,o,h,c),this.ddBg.lineStyle(2,this._col.stroke,1).strokeRoundedRect(0,0,o,h,c);let d=r;for(const m of i){const _=this._makeDDRow(m,o,n);_.setPosition(0,d),this.ddWrap.add(_),this._ddRows.push(_),d+=n}const f=this._makeOpenAllRow(o,n);f.setPosition(0,d),this.ddWrap.add(f),this._ddRows.push(f),d+=n,this.ddWrap.setSize(o,h),this.ddWrap.input&&this.ddWrap.removeInteractive(),this.ddWrap.setInteractive(new Phaser.Geom.Rectangle(0,0,o,h),Phaser.Geom.Rectangle.Contains)}_makeDDRow(t,e,s){var g,m;const i=this.s,o=i.add.graphics(),n=t.isClaim?1911585:this._col.ddRow,r=t.isClaim?2574890:this._col.ddRowHover;o.fillStyle(n,1).fillRoundedRect(4,2,e-8,s-4,10);const h=this._tune.ddTextTop,l=h+6,c=i.add.text(10,l,t.isClaim?"üéÅ":t.done?"‚úî":"‚Ä¢",{fontSize:"14px",color:t.isClaim?this._col.ok:t.done?this._col.ok:"#8aa1c2"}).setOrigin(0,.5),d=i.add.text(24,h,t.title,{fontFamily:((g=O.fonts)==null?void 0:g.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#ffffff",wordWrap:{width:e-24-60}}).setOrigin(0,0),f=i.add.graphics();if(!t.isClaim){const b=e-24-54,y=s-10,k=t.goal?Phaser.Math.Clamp(t.cur/t.goal,0,1):0;f.fillStyle(this._col.barBg,1).fillRoundedRect(24,y,b,6,3),f.fillStyle(t.goal&&t.cur>=t.goal?this._col.barFgReady:this._col.barFg,1).fillRoundedRect(24,y,Math.max(2,Math.round(b*k)),6,3)}const u=i.add.text(e-10,l,t.isClaim?"‚úì":t.goal?`${t.cur}/${t.goal}`:"",{fontFamily:((m=O.fonts)==null?void 0:m.ui)||"Inter, Arial, sans-serif",fontSize:"11px",color:t.isClaim?this._col.ok:this._col.sub}).setOrigin(1,.5),p=i.add.container(0,0,[o,c,d,f,u]).setSize(e,s);return p.setInteractive(new Phaser.Geom.Rectangle(0,0,e,s),Phaser.Geom.Rectangle.Contains).on("pointerover",()=>o.fillStyle(r,1).fillRoundedRect(4,2,e-8,s-4,10)).on("pointerout",()=>o.fillStyle(n,1).fillRoundedRect(4,2,e-8,s-4,10)),p.on("pointerup",(_,b,y,k)=>{var P,M;(P=k==null?void 0:k.stopPropagation)==null||P.call(k),this._ignoreNextUp=!0,this._hideDropdown(!0),(M=$.setTrackedNpcId)==null||M.call($,t.npc.id),Vt(this.s,t.npc)}),p}_makeOpenAllRow(t,e){var c,d;const s=this.s,i=s.add.graphics(),o=this._col.ddRow,n=this._col.ddRowHover;i.fillStyle(o,1).fillRoundedRect(4,2,t-8,e-4,10);const r=s.add.text(14,e/2,"–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤—Å—ñ –∫–≤–µ—Å—Ç–∏‚Ä¶",{fontFamily:((c=O.fonts)==null?void 0:c.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#ffffff"}).setOrigin(0,.5),h=s.add.text(t-12,e/2,"‚Ä∫",{fontFamily:((d=O.fonts)==null?void 0:d.ui)||"Inter, Arial, sans-serif",fontSize:"14px",color:this._col.sub}).setOrigin(1,.5),l=s.add.container(0,0,[i,r,h]).setSize(t,e);return l.setInteractive(new Phaser.Geom.Rectangle(0,0,t,e),Phaser.Geom.Rectangle.Contains),l.input.cursor="pointer",l.on("pointerover",()=>i.clear().fillStyle(n,1).fillRoundedRect(4,2,t-8,e-4,10)),l.on("pointerout",()=>i.clear().fillStyle(o,1).fillRoundedRect(4,2,t-8,e-4,10)),l.on("pointerup",(f,u,p,g)=>{var m;(m=g==null?void 0:g.stopPropagation)==null||m.call(g),this._ignoreNextUp=!0,this._hideDropdown(!0),Rt(this.s)}),l}_makeOpenAllFooter(t,e){var h,l;const s=this.s,i=s.add.graphics();i.fillStyle(this._col.footerBg,1).fillRoundedRect(4,2,t-8,e-4,{tl:8,tr:8,bl:10,br:10}),i.lineStyle(1,1844274,1).strokeRoundedRect(4,2,t-8,e-4,{tl:8,tr:8,bl:10,br:10});const o=s.add.text(14,e/2,"–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤—Å—ñ –∫–≤–µ—Å—Ç–∏‚Ä¶",{fontFamily:((h=O.fonts)==null?void 0:h.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#c9d3e6"}).setOrigin(0,.5),n=s.add.text(t-16,e/2,"‚Ä∫",{fontFamily:((l=O.fonts)==null?void 0:l.ui)||"Inter, Arial, sans-serif",fontSize:"16px",color:"#c9d3e6"}).setOrigin(1,.5),r=s.add.container(0,0,[i,o,n]).setSize(t,e);return r.setInteractive(new Phaser.Geom.Rectangle(0,0,t,e),Phaser.Geom.Rectangle.Contains).on("pointerover",()=>i.setAlpha(.92)).on("pointerout",()=>i.setAlpha(1)).on("pointerup",(c,d,f,u)=>{var p;(p=u==null?void 0:u.stopPropagation)==null||p.call(u),this._ignoreNextUp=!0,Rt(this.s)}),r}_hideDropdown(t=!1){if(this.ddWrap.visible){if(t){this.ddWrap.setVisible(!1).setAlpha(0);return}this.s.tweens.add({targets:this.ddWrap,alpha:0,duration:120,ease:"Cubic.Out",onComplete:()=>this.ddWrap.setVisible(!1)})}}_makeOpenAllBtn(){var c,d;const t=this.s,e=88,s=26,i=12,o=t.add.container(this.w-12,10),n=t.add.graphics(),r=((c=O.colors)==null?void 0:c.accent)??3843071;n.fillStyle(r,1).fillRoundedRect(-e,0,e,s,i),n.lineStyle(1,16777215,.15).strokeRoundedRect(-e,0,e,s,i);const h=t.add.text(-e/2,s/2,"–ö–≤–µ—Å—Ç–∏",{fontFamily:((d=O.fonts)==null?void 0:d.ui)||"Inter, Arial, sans-serif",fontSize:"12px",color:"#ffffff"}).setOrigin(.5),l=t.add.zone(-e,0,e,s).setOrigin(0,0).setInteractive({useHandCursor:!0});return l.on("pointerover",()=>n.setAlpha(.92)),l.on("pointerout",()=>n.setAlpha(1)),l.on("pointerup",()=>{this._ignoreNextUp=!0,this.onOpen?this.onOpen():Rt(this.s)}),o.add([n,h,l]),o.setSize(e,s),o}_ensureAvatarText(){this.avatar&&this.avatar.type!=="Text"&&(this.avatar.destroy(),this.avatar=this.s.add.text(18,this.h/2,"üßë‚Äçü¶±",{fontSize:"26px"}).setOrigin(.5),this.root.addAt(this.avatar,1))}destroy(){var t,e;try{window.removeEventListener("quest-progress",this._onQuestEvt)}catch{}(t=this.root)==null||t.removeAll(!0),(e=this.root)==null||e.destroy(),this.root=null}}function Gs(a,t){const e=$.isTaskDone(a,t);if(t.countGoal==null)return{cur:0,goal:0,done:e};const s=$.getNPC(a).tasks[t.id]||{count:0},i=Math.min(s.count|0,t.countGoal|0),o=t.countGoal|0;return{cur:i,goal:o,done:e}}function Qt(){var s,i;const a=lt(),t=(s=$.getTrackedNpcId)==null?void 0:s.call($),e=t?a.filter(o=>o.id===t):a;for(const o of e){const n=$.getActiveStage(o.id);if(!n)continue;let r=null,h=0,l=0;if(Array.isArray(n.tasks)&&n.tasks.length&&(r=n.tasks.find(d=>!$.isTaskDone(o.id,d))||n.tasks[0],(r==null?void 0:r.countGoal)!=null)){const d=$.getNPC(o.id).tasks[r.id]||{count:0};h=Math.min(d.count|0,r.countGoal|0),l=r.countGoal|0}const c=((i=$.isStageComplete)==null?void 0:i.call($,o.id))||l>0&&h>=l;return{npc:o,stage:n,task:r,cur:h,goal:l,ready:c}}return null}class Ns{constructor(t,e={}){this.s=t,this.opts=e,this.levelOffsetY=e.levelOffsetY??0,this.getSlotsTop=e.getSlotsTop||null,this.onDepthChange=e.onDepthChange||null,this.sonarCorner=e.sonarCorner||"left",this.rigDepthM=typeof e.rigDepthM=="number"?e.rigDepthM:1.2,this.level=new Ps(t,e.progress),this.clock=new vs(t,e.timeCycle,{ringR:O.rem(t,12),ringTh:Math.max(2,Math.round(O.rem(t,4))),depth:O.z.wallet-1}),this.keepnet=new Ms(t,e.keepnetCapacity??25,e.onKeepnetClick),this.actionDock=new Is(t,{onBase:()=>{var s;return(s=e.onGoBase)==null?void 0:s.call(e)},onLocationPick:s=>{var i;return(i=e.onLocationPick)==null?void 0:i.call(e,s)},wallet:e.wallet,showPerks:!0}),this.activeQuest=new Ls(t,{width:230,onOpen:()=>Rt(t)}),this.sonar=new Cs(t,{x:O.layout.sonar.anchorX,y:0,w:O.layout.sonar.size.w,h:O.layout.sonar.size.h}),this.depthCtrl=new As(t,this.rigDepthM,{x:0,y:0},s=>{var i;this.rigDepthM=s,(i=this.onDepthChange)==null||i.call(this,s)}),this.sonar.attachDepthCtrl(this.depthCtrl,O.layout.sonar.depthAttachGap),this.layout=this.layout.bind(this),this.layout(),t.scale.on("resize",this.layout)}showSonarAt(t,e){var s;(s=this.sonar)==null||s.show(t,e)}hideSonar(){var t;(t=this.sonar)==null||t.hide()}setSonarFollowX(t){var e;(e=this.sonar)==null||e.setDotFollowX(!!t)}setSonarFight(t){var e;(e=this.sonar)==null||e.setFight(!!t)}updateSonarDot(t,e={}){var s;(s=this.sonar)==null||s.updateDot(t,e)}setWallet(t,e,s=0){var i;(i=this.actionDock)==null||i.setWallet(t,e,s)}setKeepnet(t,e){var s;(s=this.keepnet)==null||s.set(t|0,e|0)}update(){var t;this.clock.update(),(t=this.activeQuest)==null||t.update()}layout(){var A,F,C,T,B,K;const t=this.s.scale.width,e=O.rem(this.s,O.layout.top.gap),s=e;this.clock.update(!0);const i=((F=(A=this.clock).getBounds)==null?void 0:F.call(A))??new Phaser.Geom.Rectangle(0,0,180,40),o=this.actionDock.w??360,n=this.actionDock.h??40,r=s+Math.round(n/2),h=this.keepnet.w??160,l=this.keepnet.h??42,c=t-s-h,d=Math.round(r-l/2);(T=(C=this.keepnet).setPosition)==null||T.call(C,c,d);const f=c-e,u=s;let p=Math.round(t/2),g=p-o/2,m=p+o/2;if(m>f){const D=m-f;p-=D,g-=D,m-=D}g<u&&(p=u+Math.round(o/2),g=p-o/2,m=p+o/2),this.actionDock.setPosition(p,r);const _=160,b=360,y=m+e,k=c-e,P=Math.max(0,k-y);if(P>=_){const D=Math.min(b,P);this.activeQuest.setWidth(D);const S=Math.round(r-this.activeQuest.h/2);this.activeQuest.setPosition(y,S).setVisible(!0)}else{const D=Math.round(e*.75),S=Math.min(b,Math.max(_,h-e));this.activeQuest.setWidth(S);const w=c+Math.round((h-S)/2),W=r+Math.ceil(l/2)+D+Math.round(this.activeQuest.h/2);this.activeQuest.setPosition(w,W).setVisible(!0)}const M=Math.round(e*.75),I=r+Math.ceil(n/2)+M+Math.round(i.height/2);this.clock.setPosition(Math.round(t/2),I);const x=Math.max(2,s+this.levelOffsetY);(K=(B=this.level).setPosition)==null||K.call(B,s,x),this.placeSonar(s,t)}placeSonar(t,e){var c,d;if(!((c=this.sonar)!=null&&c.setPosition))return;const s=typeof this.getSlotsTop=="function"?this.getSlotsTop()??Math.round(this.s.scale.height*.72):Math.round(this.s.scale.height*.72),i=O.rem(this.s,O.layout.sonar.raiseRem),o=Math.round(s-i),n=(d=O.layout.sonar.size)==null?void 0:d.w,r=O.layout.sonar.anchorX|0,h=Math.max(t,e-n-t),l=this.sonarCorner==="right"?h:r;this.sonar.setPosition(l,o)}destroy(){var t;this.s.scale.off("resize",this.layout),(t=this.activeQuest)==null||t.destroy()}}const te={dayLengthMin:10,startClock:"06:01",schedule:{dawn:"06:00",day:"10:00",dusk:"18:00",night:"22:00"}},Xs=["dawn","day","dusk","night"];class $s{constructor(t,e={},s){var i,o,n,r;this.s=t,this.cfg={...te,...e},this.onPhaseChange=s,this._schedMin=this._buildSchedule(this.cfg.schedule),this.anchorMs=((i=v.get)==null?void 0:i.call(v,"clockAnchorMs"))??Date.now(),this.offsetMin=(o=v.get)==null?void 0:o.call(v,"clockOffsetMin"),typeof this.offsetMin!="number"&&(this.offsetMin=this._parseHHMM(this.cfg.startClock),(n=v.set)==null||n.call(v,"clockOffsetMin",this.offsetMin)),(r=v.set)==null||r.call(v,"clockAnchorMs",this.anchorMs),this.curPhase=null,this.timer=t.time.addEvent({delay:1e3,loop:!0,callback:()=>this._tick()}),this._tick(!0)}dispose(){var t;(t=this.timer)==null||t.remove()}_parseHHMM(t="00:00"){const[e,s]=String(t).split(":").map(i=>parseInt(i,10)||0);return(e%24*60+s%60)%1440}_buildSchedule(t){const e={...te.schedule,...t||{}};return Xs.map(i=>[i,this._parseHHMM(e[i])])}_totalMs(){return(this.cfg.dayLengthMin|0)*60*1e3}_progressMs(){const t=Date.now()-this.anchorMs,e=this._totalMs(),s=Math.floor((this.offsetMin|0)%1440/1440*e);let i=(t+s)%e;return i<0&&(i+=e),i}getInfo(){const t=this._progressMs()/this._totalMs()%1,e=Math.floor(t*1440),s=Math.floor(e/60)%24,i=e%60,o=`${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}`,{phase:n,next:r,t:h}=this._phaseAt(e);return{phase:n,next:r,t:h,h:s,m:i,clock:o,pct24:t}}_phaseAt(t){const e=this._schedMin,s=(i,o)=>(o-i+1440)%1440;for(let i=0;i<e.length;i++){const o=e[i][0],n=e[i][1],r=e[(i+1)%e.length][0],h=e[(i+1)%e.length][1],l=s(n,h)||1,c=s(n,t);if(n<=h?t>=n&&t<h:t>=n||t<h)return{phase:o,next:r,t:c/l}}return{phase:"night",next:"dawn",t:0}}_tick(t=!1){var s;const{phase:e}=this.getInfo();(t||e!==this.curPhase)&&(this.curPhase=e,(s=this.onPhaseChange)==null||s.call(this,e))}setClock(t){var e;this.offsetMin=this._parseHHMM(t),(e=v.set)==null||e.call(v,"clockOffsetMin",this.offsetMin),this._tick(!0)}}class ft{constructor(t,e="lake"){var s;this.s=t,this.locId=e,this._maskEdit=null,this._spEdit=null,this._hotkeysBound=!1,this._shutdownBound=!1,this._prevCursor="",this._shutdownBound||(this._shutdownBound=!0,(s=this.s.events)==null||s.once(Phaser.Scenes.Events.SHUTDOWN,()=>{var i;this.stopCastMaskEditor(),this.stopSpeciesAreasEditor(),this._hotkeysBound&&this._hotKeyHandler&&((i=this.s.input.keyboard)==null||i.off("keydown",this._hotKeyHandler),this._hotkeysBound=!1)}))}get loc(){return St.find(t=>t.id===this.locId)||(St[0]??null)}setLocation(t){this.locId=t}_waterBounds(){var n;const t=this.s.scale.height,e=((n=this.loc)==null?void 0:n.water)||{},s=r=>r<=1?Math.round(r*t):r|0,i=e.top!=null?s(e.top):0,o=e.bottom!=null?s(e.bottom):t;return{top:i,shore:o}}_toUV(t,e){const s=Math.max(1,this.s.scale.width),{top:i,shore:o}=this._waterBounds(),n=Phaser.Math.Clamp(t/s,0,1),r=Phaser.Math.Clamp((e-i)/Math.max(1,o-i),0,1);return{u:n,v:r}}_toXY([t,e]){const s=this.s.scale.width,{top:i,shore:o}=this._waterBounds(),n=Math.max(1,o-i);return{x:t*s,y:i+e*n}}static _distPtSeg({u:t,v:e},[s,i],[o,n]){const r=o-s,h=n-i,l=t-s,c=e-i,d=r*l+h*c;if(d<=0)return Math.hypot(t-s,e-i);const f=r*r+h*h;if(f<=d)return Math.hypot(t-o,e-n);const u=d/Math.max(1e-9,f),p=s+u*r,g=i+u*h;return Math.hypot(t-p,e-g)}static _insertPointIntoNearestEdge(t,e){if(!t.length){t.push([e.u,e.v]);return}let s=0,i=1/0;for(let o=0;o<t.length;o++){const n=t[o],r=t[(o+1)%t.length],h=ft._distPtSeg(e,n,r);h<i&&(i=h,s=o)}t.splice(s+1,0,[e.u,e.v])}static _findNearestVertex(t,e,s=.03){let i=-1,o=1/0;for(let n=0;n<t.length;n++){const[r,h]=t[n],l=Math.hypot(e.u-r,e.v-h);l<o&&(o=l,i=n)}return o<=s?i:-1}isCastMaskEditing(){return!!this._maskEdit}isSpeciesEditing(){return!!this._spEdit}toggleCastMaskEditor(t){return t===!0?this.startCastMaskEditor():t===!1?this.stopCastMaskEditor():this._maskEdit?this.stopCastMaskEditor():this.startCastMaskEditor()}toggleSpeciesAreasEditor(t){return t===!0?this.startSpeciesAreasEditor():t===!1?this.stopSpeciesAreasEditor():this._spEdit?this.stopSpeciesAreasEditor():this.startSpeciesAreasEditor()}bindHotkeys(){if(this._hotkeysBound)return;const t=this.s.input.keyboard;t&&(this._hotKeyHandler=e=>{e.altKey&&e.code==="KeyM"&&(e.preventDefault(),this.toggleCastMaskEditor()),e.altKey&&e.code==="KeyP"&&(e.preventDefault(),this.toggleSpeciesAreasEditor())},t.on("keydown",this._hotKeyHandler),this._hotkeysBound=!0)}startCastMaskEditor(){var F,C,T,B,K,D;if(this._maskEdit)return;this.stopSpeciesAreasEditor();const t=this.loc,e=t.castMask||(t.castMask={});e.allowedPolys=e.allowedPolys||[],e.blockedPolys=e.blockedPolys||[];const s={layer:"allowedPolys",polyIdx:0};let i=this.s.scale.width,{top:o,shore:n}=this._waterBounds(),r=Math.max(1,n-o);const h=(S,w)=>({u:Phaser.Math.Clamp(S/Math.max(1,i),0,1),v:Phaser.Math.Clamp((w-o)/Math.max(1,r),0,1)}),l=([S,w])=>({x:S*i,y:o+w*r});this._prevCursor=((T=(C=(F=this.s.input.manager)==null?void 0:F.canvas)==null?void 0:C.style)==null?void 0:T.cursor)||"";try{this.s.input.manager.canvas.style.cursor="crosshair"}catch{}const c=this.s.add.rectangle(0,0,this.s.scale.width,this.s.scale.height,0,0).setOrigin(0,0).setDepth(5999).setScrollFactor(0).setInteractive(),d=this.s.add.graphics().setDepth(6e3),f=this.s.add.graphics().setDepth(6e3),u=this.s.add.container(0,0).setDepth(6001),p=S=>{const w=e[S];return w.length||w.push([]),s.polyIdx>=w.length&&(s.polyIdx=w.length-1),w[s.polyIdx]},g={allowed:{fill:65416,alpha:.18,stroke:65416,hFill:16777215},blocked:{fill:16724821,alpha:.25,stroke:16724821,hFill:16777215}},m=()=>{var S,w;return(w=(S=this.s.locationMgr)==null?void 0:S.setWaterMaskFromCastMask)==null?void 0:w.call(S,e)},_=()=>{const S=(w,W,z)=>{w.clear(),W.forEach(R=>{if(!Array.isArray(R)||R.length<3)return;w.fillStyle(z.fill,z.alpha).lineStyle(2,z.stroke,.9),w.beginPath();const E=l(R[0]);w.moveTo(E.x,E.y);for(let X=1;X<R.length;X++){const H=l(R[X]);w.lineTo(H.x,H.y)}w.closePath(),w.fillPath(),w.strokePath()})};S(d,e.allowedPolys,g.allowed),S(f,e.blockedPolys,g.blocked)},b=()=>{u.removeAll(!0);const S=p(s.layer),w=s.layer==="allowedPolys"?g.allowed:g.blocked;for(let W=0;W<S.length;W++){const{x:z,y:R}=l(S[W]),E=this.s.add.circle(z,R,7,w.hFill,1).setStrokeStyle(2,1779256,.8).setInteractive({draggable:!0});E.on("drag",(X,H,G)=>{const L=h(H,G);S[W][0]=L.u,S[W][1]=L.v,E.setPosition(H,G),_(),m()}),this.s.input.setDraggable(E,!0),u.add(E)}},y=()=>{_(),b(),m()},k=()=>{var z,R;const S=p(s.layer),w=this.s.input.activePointer,W=h(w.worldX??w.x,w.worldY??w.y);ft._insertPointIntoNearestEdge(S,W),y(),(R=(z=this.s).showToast)==null||R.call(z,s.layer==="blockedPolys"?"–î–æ–±–∞–≤–ª–µ–Ω–∞ –ö–†–ê–°–ù–ê–Ø —Ç–æ—á–∫–∞":"–î–æ–±–∞–≤–ª–µ–Ω–∞ –ó–ï–õ–Å–ù–ê–Ø —Ç–æ—á–∫–∞")},P=S=>{var z,R;const w=p(s.layer),W=h(S.worldX??S.x,S.worldY??S.y);if((z=S.event)!=null&&z.shiftKey){ft._insertPointIntoNearestEdge(w,W),y();return}if((R=S.event)!=null&&R.altKey){const E=ft._findNearestVertex(w,W);E>=0&&(w.splice(E,1),y());return}};c.on("pointerdown",P);const M=(S,w=3)=>Math.round(S*Math.pow(10,w))/Math.pow(10,w),I=(S,w=3)=>S.map(W=>W.map(([z,R])=>[M(z,w),M(R,w)])),x=S=>{var w,W,z,R,E,X,H,G,L;if(S.code==="KeyG"&&!S.ctrlKey&&(s.layer="allowedPolys",(W=(w=this.s).showToast)==null||W.call(w,"–°–ª–æ–π: –ó–ï–õ–Å–ù–´–ô (allowed)"),y()),S.code==="KeyR"&&!S.ctrlKey&&(s.layer="blockedPolys",(R=(z=this.s).showToast)==null||R.call(z,"–°–ª–æ–π: –ö–†–ê–°–ù–´–ô (blocked)"),y()),S.code==="KeyG"&&S.ctrlKey&&(k(),S.preventDefault()),S.code==="KeyR"&&S.ctrlKey&&(s.layer="blockedPolys",k(),S.preventDefault()),S.code==="KeyN"&&!S.ctrlKey&&(e[s.layer].push([]),s.polyIdx=e[s.layer].length-1,y(),(X=(E=this.s).showToast)==null||X.call(E,"–ù–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω –≤ —Ç–µ–∫—É—â–µ–º —Å–ª–æ–µ")),S.code==="KeyS"&&!S.ctrlKey){const Y=I(e.allowedPolys,3),j=I(e.blockedPolys,3);e.allowedPolys=Y,e.blockedPolys=j,y();const nt=`castMask: ${JSON.stringify({allowedPolys:Y,blockedPolys:j},null,2)}`;console.log(nt),(H=navigator.clipboard)!=null&&H.writeText?navigator.clipboard.writeText(nt).then(()=>{var Q,et;return(et=(Q=this.s).showToast)==null?void 0:et.call(Q,"castMask —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±—É—Ñ–µ—Ä")}).catch(()=>{var Q,et;return(et=(Q=this.s).showToast)==null?void 0:et.call(Q,"castMask –≤—ã–≤–µ–¥–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª—å")}):(L=(G=this.s).showToast)==null||L.call(G,"castMask –≤—ã–≤–µ–¥–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª—å")}S.code==="Escape"&&this.stopCastMaskEditor()};(B=this.s.input.keyboard)==null||B.on("keydown",x);const A=()=>{i=this.s.scale.width;const S=this._waterBounds();o=S.top,n=S.shore,r=Math.max(1,n-o),c.setSize(this.s.scale.width,this.s.scale.height),y()};this.s.scale.on("resize",A),this._maskEdit={overlay:c,gAllowed:d,gBlocked:f,handles:u,onKey:x,onResize:A},y(),(D=(K=this.s).showToast)==null||D.call(K,"–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞—Å–∫–∏: G/R ‚Äî —Å–ª–æ–π, Ctrl+G/R ‚Äî —Ç–æ—á–∫–∞, Shift=–¥–æ–±–∞–≤–∏—Ç—å, Alt=—É–¥–∞–ª–∏—Ç—å, N ‚Äî –Ω–æ–≤—ã–π, S ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, Esc ‚Äî –≤—ã—Ö–æ–¥")}stopCastMaskEditor(){var e,s,i,o,n;const t=this._maskEdit;if(t){try{this._prevCursor!=null&&(this.s.input.manager.canvas.style.cursor=this._prevCursor)}catch{}(e=this.s.input.keyboard)==null||e.off("keydown",t.onKey),this.s.scale.off("resize",t.onResize),(s=t.overlay)==null||s.destroy(),(i=t.gAllowed)==null||i.destroy(),(o=t.gBlocked)==null||o.destroy(),(n=t.handles)==null||n.destroy(),this._maskEdit=null}}startSpeciesAreasEditor(){var y,k,P,M,I,x,A,F;if(this._spEdit)return;this.stopCastMaskEditor();const t=(y=this.loc).speciesAreas||(y.speciesAreas=[]),e=Object.keys((this.s.SPAWN_TABLES||{})[this.locId]||{});let s=Math.max(0,e.indexOf(((k=t[0])==null?void 0:k.speciesId)||e[0]||"pike"));const i=()=>e[s]||"pike";let o=this.s.scale.width,{top:n,shore:r}=this._waterBounds(),h=Math.max(1,r-n);this._prevCursor=((I=(M=(P=this.s.input.manager)==null?void 0:P.canvas)==null?void 0:M.style)==null?void 0:I.cursor)||"";try{this.s.input.manager.canvas.style.cursor="crosshair"}catch{}const l=this.s.add.rectangle(0,0,o,this.s.scale.height,0,0).setOrigin(0).setDepth(7e3).setInteractive(),c=this.s.add.graphics().setDepth(7001),d=this.s.add.container(0,0).setDepth(7002),f=([C,T])=>({x:C*o,y:n+T*h}),u=(C,T)=>({u:Phaser.Math.Clamp(C/Math.max(1,o),0,1),v:Phaser.Math.Clamp((T-n)/Math.max(1,h),0,1)}),p=()=>{const C=i();let T=this.loc.speciesAreas.find(B=>B.speciesId===C);return T||(T={speciesId:C,mult:1.5,polys:[]},this.loc.speciesAreas.push(T)),T},g=()=>{c.clear(),d.removeAll(!0);for(const B of this.loc.speciesAreas){const K=B.speciesId===i(),D=K?16777062:6737151,S=K?.25:.12;c.lineStyle(2,D,.9),c.fillStyle(D,S);for(const w of B.polys||[]){if(w.length<3)continue;const W=f(w[0]);c.beginPath(),c.moveTo(W.x,W.y);for(let z=1;z<w.length;z++){const R=f(w[z]);c.lineTo(R.x,R.y)}c.closePath(),c.fillPath(),c.strokePath()}}const C=p();for(const B of C.polys||[])B.forEach((K,D)=>{const{x:S,y:w}=f(K),W=this.s.add.circle(S,w,7,16777215,1).setStrokeStyle(2,1779256,.8).setInteractive({draggable:!0});this.s.input.setDraggable(W,!0),W.on("drag",(z,R,E)=>{const X=u(R,E);B[D][0]=X.u,B[D][1]=X.v,g()}),d.add(W)});const T=this.s.add.text(100,330,`–í–∏–¥: ${i()} (mult=${p().mult.toFixed(2)})  |  Shift+–∫–ª–∏–∫=—Ç–æ—á–∫–∞  Alt+–∫–ª–∏–∫=—É–¥–∞–ª–∏—Ç—å  N=–Ω–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω  [ ]=–º–Ω–æ–∂–∏—Ç–µ–ª—å  Q/E=–≤–∏–¥  S=–ª–æ–≥  Esc=–≤—ã—Ö–æ–¥`,{fontSize:"16px",color:"#ffffff"}).setDepth(7003).setScrollFactor(0).setOrigin(0,0);d.add(T)},m=C=>{var D,S;const T=p(),B={x:C.worldX??C.x,y:C.worldY??C.y},K=u(B.x,B.y);if((D=C.event)!=null&&D.shiftKey){T.polys.length||T.polys.push([]);const w=T.polys[T.polys.length-1];ft._insertPointIntoNearestEdge(w,K),g();return}if((S=C.event)!=null&&S.altKey){const w=T.polys[T.polys.length-1];if(w!=null&&w.length){const W=ft._findNearestVertex(w,K);W>=0&&(w.splice(W,1),g())}return}};l.on("pointerdown",m);const _=C=>{var B,K,D,S;const T=p();if(C.code==="KeyN"&&(T.polys.push([]),g()),C.code==="BracketLeft"&&(T.mult=Math.max(1,+(T.mult-.1).toFixed(2)),g()),C.code==="BracketRight"&&(T.mult=Math.min(8,+(T.mult+.1).toFixed(2)),g()),C.code==="KeyQ"&&(s=(s-1+e.length)%e.length,g()),C.code==="KeyE"&&(s=(s+1)%e.length,g()),C.code==="KeyS"&&!C.ctrlKey){const W=this.loc.speciesAreas.filter(R=>{var E;return(E=R.polys)==null?void 0:E.some(X=>X.length>=3)}).map(R=>({speciesId:R.speciesId,mult:+R.mult.toFixed(2),polys:R.polys.filter(E=>E.length>=3).map(E=>E.map(([X,H])=>[+X.toFixed(3),+H.toFixed(3)]))})),z=`speciesAreas: ${JSON.stringify(W,null,2)}`;console.log(z),(K=(B=this.s).showToast)==null||K.call(B,"SpeciesAreas (–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ) ‚Üí –≤ –∫–æ–Ω—Å–æ–ª—å")}if(C.code==="KeyS"&&C.ctrlKey){C.preventDefault();const w=(T.polys||[]).filter(R=>R.length>=3),W=[{speciesId:T.speciesId,mult:+T.mult.toFixed(2),polys:w.map(R=>R.map(([E,X])=>[+E.toFixed(3),+X.toFixed(3)]))}],z=`speciesAreas: ${JSON.stringify(W,null,2)}`;console.log(z),(S=(D=this.s).showToast)==null||S.call(D,`–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–π –≤–∏–¥: ${T.speciesId} ‚Üí –≤ –∫–æ–Ω—Å–æ–ª—å`)}C.code==="Escape"&&this.stopSpeciesAreasEditor()};(x=this.s.input.keyboard)==null||x.on("keydown",_);const b=()=>{o=this.s.scale.width;const C=this._waterBounds();n=C.top,r=C.shore,h=Math.max(1,r-n),l.setSize(this.s.scale.width,this.s.scale.height),g()};this.s.scale.on("resize",b),this._spEdit={overlay:l,g:c,handles:d,onKey:_,onResize:b},g(),(F=(A=this.s).showToast)==null||F.call(A,"–†–µ–¥–∞–∫—Ç–æ—Ä –∑–æ–Ω –≤–∏–¥–æ–≤ –∑–∞–ø—É—â–µ–Ω (—Å–º. –ø–∞–Ω–µ–ª—å —Å–≤–µ—Ä—Ö—É)")}stopSpeciesAreasEditor(){var e,s,i,o;const t=this._spEdit;if(t){try{this._prevCursor!=null&&(this.s.input.manager.canvas.style.cursor=this._prevCursor)}catch{}(e=this.s.input.keyboard)==null||e.off("keydown",t.onKey),this.s.scale.off("resize",t.onResize),(s=t.overlay)==null||s.destroy(),(i=t.g)==null||i.destroy(),(o=t.handles)==null||o.destroy(),this._spEdit=null}}}function ee(a,[t,e]){const s=Number(a),i=t??-1/0,o=e??1/0;return Number.isFinite(s)&&s>=i&&s<=o}function Nt(a){return String(a||"").trim().toLowerCase()}function st(a,...t){const e=(a==null?void 0:a.ev)??"catch";return t.includes(e)}function se(a){return a?typeof a.weightG=="number"?a.weightG|0:typeof a.weightKg=="number"?Math.round(a.weightKg*1e3):null:null}function Vs(a){return(a==null?void 0:a.speciesId)??(a==null?void 0:a.species)??(a==null?void 0:a.id)??null}function ie(a){const t=Nt(a);return t?["dawn","—Ä–∞—Å—Å–≤–µ—Ç","—Å–≤—ñ—Ç–∞–Ω–æ–∫"].includes(t)?"morning":["dusk","–∑–∞–∫–∞—Ç","—Å—É—Ç—ñ–Ω–∫–∏"].includes(t)?"evening":["morning","—É—Ç—Ä–æ","—Ä–∞–Ω–æ–∫"].includes(t)?"morning":["day","–¥–µ–Ω—å"].includes(t)?"day":["evening","–≤–µ—á–µ—Ä","–≤–µ—ái—Ä","–≤–µ—á—ñ—Ä"].includes(t)?"evening":["night","–Ω–æ—á—å","–Ω—ñ—á"].includes(t)?"night":t:null}function Us(a){return a?Array.isArray(a.valuesG)?a.valuesG.map(t=>Number(t)||0):typeof a.valueG=="number"?[a.valueG]:Array.isArray(a.valuesKg)?a.valuesKg.map(t=>Math.round(Number(t)*1e3)):typeof a.valueKg=="number"?[Math.round(Number(a.valueKg)*1e3)]:null:null}function oe(a,t){return Array.isArray(a)?a.some(e=>typeof e=="string"?e===t:(e==null?void 0:e.id)===t):!1}const Ys=Object.freeze({catch_count(a,t,e){return st(e,"catch")?(t==null?void 0:t.kind)==="fish":!1},catch_weight_range_g(a,t,e){var o,n,r;if(!st(e,"catch")||(t==null?void 0:t.kind)!=="fish")return!1;const s=se(t),i=((o=a==null?void 0:a.params)==null?void 0:o.weightG)??((n=a==null?void 0:a.params)==null?void 0:n.rangeG)??((r=a==null?void 0:a.params)==null?void 0:r.g);return!Array.isArray(i)||i.length!==2?!1:ee(s,i)},catch_weight_exact_g(a,t,e){if(!st(e,"catch")||(t==null?void 0:t.kind)!=="fish")return!1;const s=se(t);if(s==null)return!1;const{toleranceG:i=2,ignoreZero:o=!0}=(a==null?void 0:a.params)||{};if(o&&s<=0)return!1;const n=Us(a==null?void 0:a.params);return!n||!n.length?!1:n.some(r=>Math.abs(s-(r|0))<=(i|0))},catch_species(a,t,e){var o;if(!st(e,"catch")||(t==null?void 0:t.kind)!=="fish")return!1;const s=(o=a==null?void 0:a.params)==null?void 0:o.species;if(!s)return!1;const i=Vs(t);return Array.isArray(s)?s.includes(i):i===s},catch_depth_range_m(a,t,e){var o,n;if(!st(e,"catch"))return!1;const s=Number(e==null?void 0:e.depthM),i=((o=a==null?void 0:a.params)==null?void 0:o.depthM)??((n=a==null?void 0:a.params)==null?void 0:n.m);return!Array.isArray(i)||i.length!==2?!1:ee(s,i)},catch_bait_is(a,t,e){var o,n;if(!st(e,"catch"))return!1;const s=Nt(((o=a==null?void 0:a.params)==null?void 0:o.bait)??((n=a==null?void 0:a.params)==null?void 0:n.id)),i=Nt(e==null?void 0:e.bait);return!!s&&!!i&&s===i},catch_in_location(a,t,e){var o,n;if(!st(e,"catch"))return!1;const s=e==null?void 0:e.locationId,i=((o=a==null?void 0:a.params)==null?void 0:o.locations)??((n=a==null?void 0:a.params)==null?void 0:n.location);return Array.isArray(i)?i.includes(s):i?s===i:!1},catch_time_of_day(a,t,e){var n,r;if(!st(e,"catch"))return!1;const s=((n=a==null?void 0:a.params)==null?void 0:n.time)??((r=a==null?void 0:a.params)==null?void 0:r.times),i=ie(e==null?void 0:e.timeOfDay);return!i||!s?!1:(Array.isArray(s)?s:[s]).map(ie).includes(i)},loot_any(a,t,e){return st(e,"catch")?t&&t.kind&&t.kind!=="fish":!1},wallet_coins_at_least(a,t,e){var i;if(!st(e,"wallet"))return!1;const s=Number(((i=a==null?void 0:a.params)==null?void 0:i.coins)??0);return Number((t==null?void 0:t.coins)??0)>=s},wallet_gold_at_least(a,t,e){var i;if(!st(e,"wallet"))return!1;const s=Number(((i=a==null?void 0:a.params)==null?void 0:i.gold)??0);return Number((t==null?void 0:t.gold)??0)>=s},reach_level_at_least(a,t,e){var o;if(!st(e,"level"))return!1;const s=Number(((o=a==null?void 0:a.params)==null?void 0:o.level)??0);return Number((t==null?void 0:t.level)??1)>=s},buy_item_id(a,t,e){var i;if(!st(e,"shop"))return!1;const s=(i=a==null?void 0:a.params)==null?void 0:i.itemId;return!!s&&(t==null?void 0:t.itemId)===s},own_item_kind_count_at_least(a,t,e){var n,r;if(!st(e,"inventory"))return!1;const s=(n=a==null?void 0:a.params)==null?void 0:n.kind,i=Number(((r=a==null?void 0:a.params)==null?void 0:r.count)??1);return s?(Array.isArray(t==null?void 0:t[s+"s"])?t[s+"s"]:[]).length>=i:!1},own_item_id(a,t,e){var n;if(!st(e,"inventory"))return!1;const s=(n=a==null?void 0:a.params)==null?void 0:n.itemId;if(!s)return!1;const i=["rods","reels","lines","hooks","items"];for(const r of i)if(oe(t==null?void 0:t[r],s))return!0;const o=(t==null?void 0:t.baits)||(t==null?void 0:t.bait);if(Array.isArray(o)){if(oe(o,s))return!0}else if(o&&typeof o=="object"&&Object.prototype.hasOwnProperty.call(o,s)&&(o[s]|0)>0)return!0;return!1}});function js(a,t,e){const s=Ys[a==null?void 0:a.kind];if(!s)return!1;try{return!!s(a,t,e)}catch{return!1}}function Bt(a,t,e={}){const s=$.getTrackedNpcId(),i=s?lt().filter(n=>n.id===s):lt(),o={...e,ev:a};for(const n of i){const r=$.getActiveStage(n.id);if(!r||!Array.isArray(r.tasks)||!r.tasks.length)continue;let h=!1;for(const l of r.tasks)$.isTaskDone(n.id,l)||js(l,t,o)&&(l.countGoal!=null?$.addTaskCount(n.id,l.id,1):$.markTaskDone(n.id,l.id,!0),h=!0);if(h&&$t({type:a}),s)break}}function qs(a,t={}){Bt("catch",a,t)}function Dt(a){Bt("wallet",a,{})}function Js(a){Bt("level",a,{})}function ae(a){Bt("shop",a,{})}function Zs(a){Bt("inventory",a,{})}function Qs(a,t,e={}){var o,n;function s(r){const h=String(r||"").toLowerCase();return h==="dawn"?"morning":h==="dusk"?"evening":h}const i={locationId:e.locationId??a.currentLocationId??a.locationId,depthM:e.depthM??a.rigDepthM,bait:e.bait??a.currentBaitId,timeOfDay:s(e.timeOfDay??a.timeOfDay??a.dayPhase??a.currentTimeOfDay)};try{qs(t,i),$t({type:"onCatch"}),console.debug("[quests] onCatch",t,i)}catch(r){console.error("[quests] onCatch error",r)}if(t.kind==="fish")return ws(a,t,{keepnet:a.keepnet,keepnetFull:(((o=a.keepnet)==null?void 0:o.length)??0)>=(a.keepnetCap??0),locationId:i.locationId,depthM:i.depthM,bait:i.bait});{const r=((n=t.reward)==null?void 0:n.coins)|0;return Ss(a,t,{coins:r})}}class ti{constructor(t,e){this.enabled=!!(t&&e),this.enabled&&(this.socket=t(e,{transports:["websocket"],path:"/socket.io"}))}join(){this.enabled}leave(){this.enabled}on(){this.enabled}announceCatch(){this.enabled}}class ei{constructor(t,e,s){this.s=t,this.chat=e,this.roomId=s,this.depth=3e3;const i=t.scale.width,o=t.scale.height,n=Math.min(380,Math.floor(i*.42)),r=Math.min(240,Math.floor(o*.38)),h=12,l=o-r-12;this.root=t.add.container(h,l).setDepth(this.depth);const c=t.add.rectangle(0,0,n,r,724760,.78).setOrigin(0,0).setStrokeStyle(2,16777215,.15).setInteractive();this.root.add(c),this.list=t.add.text(8,8,"",{fontFamily:"Arial",fontSize:"12px",color:"#cfe",wordWrap:{width:n-16}}).setOrigin(0,0),this.root.add(this.list);const d=t.add.dom(8,r-8).createFromHTML(`
      <input id="chatInput" type="text" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
        style="width:${n-16}px; padding:6px 8px; border-radius:8px; border:1px solid #456; background:#0c1323; color:#fff; font-size:14px;">
    `).setOrigin(0,1);this.root.add(d),this.history=[],this.chat.on("chat:new",f=>this.pushMsg(f))}async loadHistory(t,e=50){try{(await t.chatHistory(this.roomId,e)).forEach(i=>this.pushMsg(i,!1)),this.render()}catch{}}pushMsg(t,e=!0){var s,i;if(t.type==="chat")this.history.push(`[${t.username}] ${t.text}`);else if(t.type==="catch"){const o=t.payload||{},n=o.name||o.fishId||"—É–ª–æ–≤",r=o.weightKg!=null?`, ${((i=(s=o.weightKg).toFixed)==null?void 0:i.call(s,2))||o.weightKg} –∫–≥`:"";this.history.push(`üé£ ${t.username} —Å–ø—ñ–π–º–∞–≤ ${n}${r}`)}this.history.length>100&&this.history.splice(0,this.history.length-100),e&&this.render()}render(){this.list.setText(this.history.slice(-12).join(`
`))}focusInput(){var e,s;const t=(s=(e=this.root.getAt(2).node)==null?void 0:e.querySelector)==null?void 0:s.call(e,"#chatInput");t&&t.focus()}destroy(){var t;(t=this.root)==null||t.destroy()}}class si extends J.Scene{constructor(){super("Start"),this.locId="lake"}init(t){t!=null&&t.locId&&(this.locId=t.locId)}preload(){var t;this.locId=((t=v.get)==null?void 0:t.call(v,"locationId",this.locId))??this.locId,Tt.loadAssets(this),Mt.queueForScene(this,this.locId)}async create(){var r,h,l,c,d,f,u,p,g,m,_,b,y,k,P,M,I;if(await pt.ensure(),!pt.isAuthed){this.scene.start("Auth");return}const t=v.defaults();this.state="idle",this.inventory=v.get("inventory")??t.inventory,this.activeBaitId=v.get("activeBaitId","worm"),this.gear=v.get("gear")??Oe(),(r=this.gear).inv||(r.inv={}),this.gear.inv.bait=((l=(h=this.inventory)==null?void 0:h.bait)==null?void 0:l[this.activeBaitId])|0,this.keepnet=v.get("keepnet",t.keepnet),this.wallet=v.get("wallet")??t.wallet,this.rigDepthM=v.get("rigDepthM",t.rigDepthM),this.keepnetCap=v.get("keepnetCap",t.keepnetCap??25),this.locId=((c=v.get)==null?void 0:c.call(v,"locationId",this.locId))??this.locId;const e=v.get("progress"),s=v.get("level",1);this.progress=new Ft(this),(e==null?void 0:e.xp)!=null&&(this.progress.xp=e.xp|0),(e==null?void 0:e.level)!=null?this.progress.level=e.level|0:this.progress.level=s|0;let i=null;try{i=window.API_BASE?await Ct.loadState():null}catch(x){console.warn("loadState failed",x)}i&&(this.wallet=i.wallet??this.wallet,this.keepnet=i.keepnet??this.keepnet,this.keepnetCap=i.keepnetCap??this.keepnetCap,this.gear=i.gear??this.gear,this.rigDepthM=i.rigDepthM??this.rigDepthM,this.locId=i.locationId||this.locId,this.inventory=i.inventory??this.inventory,this.activeBaitId=i.activeBaitId??this.activeBaitId,(d=this.gear).inv||(d.inv={}),this.gear.inv.bait=((u=(f=this.inventory)==null?void 0:f.bait)==null?void 0:u[this.activeBaitId])|0,((p=i.progress)==null?void 0:p.xp)!=null&&(this.progress.xp=i.progress.xp|0),((g=i.progress)==null?void 0:g.level)!=null&&(this.progress.level=i.progress.level|0));let o=null;this.commitState=()=>{var A,F,C,T,B;const x={wallet:this.wallet,keepnet:this.keepnet,keepnetCap:this.keepnetCap,gear:this.gear,rigDepthM:this.rigDepthM,locationId:((F=(A=this.locationMgr)==null?void 0:A.getCurrentId)==null?void 0:F.call(A))||this.locId,level:(C=this.progress)==null?void 0:C.level,progress:{xp:(T=this.progress)==null?void 0:T.xp,level:(B=this.progress)==null?void 0:B.level},inventory:this.inventory,activeBaitId:this.activeBaitId};v.setMany?v.setMany(x):(v.set("wallet",x.wallet),v.set("keepnet",x.keepnet),v.set("keepnetCap",x.keepnetCap),v.set("gear",x.gear),v.set("rigDepthM",x.rigDepthM),v.set("locationId",x.locationId),v.set("inventory",x.inventory),v.set("activeBaitId",x.activeBaitId)),console.log("[SAVE]",x),clearTimeout(o),o=setTimeout(()=>{window.API_BASE&&Ct.saveState(x).catch(()=>{})},400)},window.addEventListener("beforeunload",()=>{var x;return(x=this.commitState)==null?void 0:x.call(this)}),this.events.once("shutdown",()=>{var x;return(x=this.commitState)==null?void 0:x.call(this)}),this.locationMgr=new Tt(this,this.locId),this.locationMgr.applyBackground();const n=x=>{var C,T,B,K;const A=(T=(C=this.timeCycle)==null?void 0:C.getInfo)==null?void 0:T.call(C),F=(A==null?void 0:A.t)??0;(K=(B=this.locationMgr)==null?void 0:B.setPhaseBlend)==null||K.call(B,x,F),this.timeOfDay=x};this.cameras.main.roundPixels=!0,this.timeCycle=new $s(this,{},n);{const x=this.timeCycle.getInfo();(_=(m=this.locationMgr)==null?void 0:m.setPhaseBlend)==null||_.call(m,x.phase,x.t),this.timeOfDay=x.phase}this.bobber=null,this.biteTimer=null,this.toast=null,this.fish=null,this.params=null,this.jerkTO=null,this.fishTargetX=null,this.fishSideSpeed=0,this.sideTimer=null,this.kickTweening=!1,this.holdAcc=0,this.HOLD_NEED=.1,this.SAFE_THR=90,this.baseSlipChance=.12,this.slipTO=null,this.baitCharged=!1,this.uiLock=!1,this.initInventory(),this.createHUD(),this.createSlots(),this.positionPullButtonAtSlotsLevel(),this.scale.on("resize",()=>this.computeCastZone()),this.createBarsDock(),this.rodBar.setThreshold(this.SAFE_THR),this.lineBar.setThreshold(this.SAFE_THR),this.barsDock.setMode("idle"),this.modals=new de(this,O.z.modal),this.progress=new Ft(this),(i==null?void 0:i.level)!=null&&(this.progress.level=i.level),this.locationMgr.enableWaterFX({amp:2,waveLen:56,speed:22}),this.locEditor=new ft(this,this.locId||"lake"),this.locEditor.bindHotkeys(),this.rigDepthM=this.rigDepthM??1.2,this.hud=new Ns(this,{wallet:this.wallet,progress:this.progress,keepnetCapacity:this.keepnetCap??25,timeCycle:this.timeCycle,onKeepnetClick:async()=>{var A,F,C;if(!((A=this.keepnet)!=null&&A.length)){(F=this.showToast)==null||F.call(this,"–°–∞–¥–æ–∫ –ø—É—Å—Ç");return}const x=await ks(this,this.keepnet,0);(x==null?void 0:x.action)==="release"&&(this.hud.setKeepnet(this.keepnet.length,this.keepnetCap),(C=this.commitState)==null||C.call(this),Dt(this.wallet))},onLocationPick:x=>{var A,F;if(this.state==="fight"){this.showToast("–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –ª–æ–∫–∞—Ü–∏—é –≤–æ –≤—Ä–µ–º—è –≤—ã–≤–∞–∂–∏–≤–∞–Ω–∏—è");return}this.abortFishingDueToLocationChange(),(A=v.snapshotFromStart)==null||A.call(v,this),this.commitState(),this.currentRoomId&&((F=this.ioClient)==null||F.leave(this.currentRoomId)),this.scene.start("LoadLoc",{locId:x})},onGoBase:()=>{var x;if(this.state==="fight"){this.showToast("–ù–µ–ª—å–∑—è –Ω–∞ –±–∞–∑—É –≤–æ –≤—Ä–µ–º—è –≤—ã–≤–∞–∂–∏–≤–∞–Ω–∏—è");return}this.abortFishingDueToLocationChange(),(x=v.snapshotFromStart)==null||x.call(v,this),this.commitState(),this.scene.start("Base")},getSlotsTop:()=>{var x;return(x=this.slots)==null?void 0:x.yTop},rigDepthM:this.rigDepthM,onDepthChange:x=>{this.rigDepthM=x,this._applyRigToBobber()},sonarCorner:"left",sonarAtTop:!0}),this.hud.setWallet(this.wallet.coins|0,this.wallet.gold|0),this.hud.setKeepnet(this.keepnet.length|0,this.keepnetCap|0),this.computeCastZone(),this.positionPullButtonAtSlotsLevel(),window.API_BASE&&window.io&&(this.ioClient=new ti(window.io,window.API_BASE),this.currentRoomId=((y=(b=this.locationMgr).getCurrentId)==null?void 0:y.call(b))||this.locId||"lake",(P=(k=this.ioClient).join)==null||P.call(k,this.currentRoomId),this.chatUI=new ei(this,this.ioClient,this.currentRoomId),(I=(M=this.chatUI)==null?void 0:M.loadHistory)==null||I.call(M,Ct,40)),this.marketCfg={kgPrice:1,valuableThreshold:.75,recordThreshold:.95,pieceMult:3},this.input.on("pointerdown",x=>{this.uiLock||this.state==="fight"||this.state==="result"||this.castLine(x.worldX,x.worldY)}),Fs(x=>{var C,T,B,K,D,S,w,W,z;if(!x)return;const A=this.wallet||(this.wallet={coins:0,gold:0,perks:0});(C=x.wallet)!=null&&C.coins&&(A.coins=(A.coins|0)+(x.wallet.coins|0)),(T=x.wallet)!=null&&T.gold&&(A.gold=(A.gold|0)+(x.wallet.gold|0)),(B=x.perks)!=null&&B.skillPoints&&(A.perks=(A.perks|0)+(x.perks.skillPoints|0)),(K=this.updateWalletHUD)==null||K.call(this),(D=this.commitState)==null||D.call(this);const F=[];(S=x.wallet)!=null&&S.coins&&F.push(`ü™ô +${x.wallet.coins}`),(w=x.wallet)!=null&&w.gold&&F.push(`‚≠ê +${x.wallet.gold}`),(W=x.perks)!=null&&W.skillPoints&&F.push(`üí° +${x.perks.skillPoints}`),F.length&&((z=this.showToast)==null||z.call(this,`–ù–∞–≥–æ—Ä–æ–¥–∞: ${F.join(" ")}`))}),this.setPullUI("idle")}_spawnTimeFromPhase(t){switch(t){case"night":return"night";case"dusk":return"evening";case"dawn":return"dawn";case"day":default:return"day"}}_shouldLieByRig(t){var i;const e=((i=this.bobber)==null?void 0:i.minStandingDepth)??.45;return t<e?!0:this.rigDepthM>t+.1}_applyRigToBobber(){if(!this.bobber)return;const t=this.locationMgr.getDepthAtXY(this.bobber.x,this.bobber.y),e=this._shouldLieByRig(t);this.bobber.setShallow(e)}initInventory(){var e,s,i,o,n;const t=(e=v.get)==null?void 0:e.call(v,"inventory");t?this.inventory=JSON.parse(JSON.stringify(t)):this.inventory={rods:["rod_wood_1"],reels:["reel_rusty"],lines:["line_old_1"],hooks:["hook_rusty"],bait:{worm:((i=(s=this.gear)==null?void 0:s.inv)==null?void 0:i.bait)??25}},this.gear.inv=this.gear.inv||{},this.gear.inv.bait=((n=(o=this.inventory)==null?void 0:o.bait)==null?void 0:n.worm)|0}getDefById(t,e){return(ce[t+"s"]||[]).find(i=>i.id===e)||null}buildOwnedList(t){return(this.inventory[t+"s"]||[]).map(s=>this.getDefById(t,s)).filter(Boolean)}mergeGearKeepingRuntime(t,e){if(!e)return;const s=this.gear[t]||(this.gear[t]={});if(t==="rod"){s.id=e.id,s.name=e.name,s.capKg=e.capKg,s.durability==null&&(s.durability=100);return}if(t==="line"){s.id=e.id,s.name=e.name,s.capKg=e.capKg,s.durability==null&&(s.durability=100);return}if(t==="reel"){s.id=e.id,s.name=e.name,s.pullBoost=e.pullBoost;return}if(t==="hook"){const i=s.id;if(s.id=e.id,s.name=e.name,s.control=e.control,i!==e.id){const o=this.inventory.hookPacks||{};s.count=Math.max(0,o[e.id]|0)}else if(s.count==null||s.count<=0){const o=this.inventory.hookPacks||{};s.count=Math.max(0,o[e.id]|0)}return}}openGearModal(t){var n,r;if(this.state==="fight"){this.showToast("–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Å–Ω–∞—Å—Ç–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–≤–∞–∂–∏–≤–∞–Ω–∏—è");return}if(!["rod","reel","line","hook"].includes(t))return;const s=this.buildOwnedList(t),i=((r=(n=this.gear)==null?void 0:n[t])==null?void 0:r.id)??null,o=h=>{var l;this.mergeGearKeepingRuntime(t,h),(l=this.slots)==null||l.update(this.gear),this.computeCastZone(),this.showToast(`${h.name} —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–∞`)};this.uiLock=!0,this._gearModal=new Re(this,t,s,i,o,()=>{this.uiLock=!1,this._gearModal=null})}createHUD(){const t=this.scale.width,e=this.scale.height;this.pullBtnSize=128;const s=this.pullBtnSize,i=this.pullBtnSize,o=O.layout.pull.outerPad,n=t-o-s/2,r=e-o-i/2;this.pullPressed=!1,this.pullEnabled=!1,this.pullBtnBg=this.add.rectangle(n,r,s,i,3815994,1).setStrokeStyle(2,16777215,.5).setInteractive().setDepth(810),this.pullBtnLabel=this.add.text(n,r,"",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(.5).setDepth(811),this.pullBtnBg.on("pointerdown",()=>{if(this.pullEnabled){if(this.state==="bite"){this.attemptHook();return}this.state==="fight"&&(this.pullPressed=!0,this.pullBtnBg.setFillStyle(1405900,1))}}),this.pullBtnBg.on("pointerup",()=>{this.pullEnabled&&this.state==="fight"&&(this.pullPressed=!1,this.pullBtnBg.setFillStyle(2003199,1))}),this.pullBtnBg.on("pointerout",()=>{this.pullEnabled&&this.state==="fight"&&(this.pullPressed=!1,this.pullBtnBg.setFillStyle(2003199,1))})}setPullUI(t){this.tweens.killTweensOf(this.pullBtnBg),this.tweens.killTweensOf(this.pullBtnLabel),t==="idle"&&(this.pullEnabled=!1,this.pullPressed=!1,this.pullBtnBg.setFillStyle(3815994,1).setAlpha(.35),this.pullBtnLabel.setText("")),t==="bite"&&(this.pullEnabled=!0,this.pullPressed=!1,this.pullBtnBg.setFillStyle(16747520,1).setAlpha(1),this.pullBtnLabel.setText("–ü–æ–¥—Å–µ—á—å"),this.tweens.add({targets:[this.pullBtnBg,this.pullBtnLabel],alpha:{from:1,to:.65},duration:500,yoyo:!0,repeat:-1,ease:"Sine.inOut"})),t==="fight"&&(this.pullEnabled=!0,this.pullPressed=!1,this.pullBtnBg.setFillStyle(2003199,1).setAlpha(1),this.pullBtnLabel.setText("–¢—è–Ω—É—Ç—å"))}abortFishingDueToLocationChange(){var t;this.bobber&&((t=this.bobber)==null||t.stopAllTweens()),this.clearAttempt(),this.barsDock.setMode("idle"),this.setPullUI("idle"),this.state="idle"}createBarsDock(){const t={x:this.pullBtnBg.x,width:this.pullBtnSize,height:this.pullBtnSize};this.barsDock=new Be(this,this.slots,t),this.rodBar=this.barsDock.rodBar,this.lineBar=this.barsDock.lineBar,this.barsDock.setMode("idle")}positionPullButtonAtSlotsLevel(){const t=this.pullBtnSize,e=O.layout.pull.outerPad,s=this.scale.width-e-t/2,i=this.slots.yTop+this.slots.h/2;this.pullBtnBg.setPosition(s,i),this.pullBtnLabel.setPosition(s,i)}createSlots(){const t={rod:()=>this.openGearModal("rod"),reel:()=>this.openGearModal("reel"),line:()=>this.openGearModal("line"),hook:()=>this.openGearModal("hook"),bait:()=>this.openBaitModal()};this.slots=new we(this,this.gear,t)}setBarsVisible(t){this.rodBar.setVisible(t),this.lineBar.setVisible(t)}computeCastZone(){var o,n;const t=(n=(o=this.locationMgr)==null?void 0:o.getWaterArea)==null?void 0:n.call(o),e=this.scale.height,s=(t==null?void 0:t.top)??Math.max(120,Math.floor(e*.46)),i=(t==null?void 0:t.bottom)??e-2;this.castTopY=s,this.castBottomY=i,this.logicShoreY=i,this.visualBottomY=i}castLine(t,e){if(!this.locationMgr.canCastAt(t,e)){this.showToast("–°—é–¥–∞ –∑–∞–±—Ä–æ—Å–∏—Ç—å –Ω–µ–ª—å–∑—è");return}if((this.gear.inv.bait??0)<=0){this.showToast("–ù—É–∂–Ω–∞ –Ω–∞–∂–∏–≤–∫–∞ (—á–µ—Ä–≤—å)");return}this.clearAttempt(),this.bobber=new Fe(this,t,e),this.bobber.startIdleBobbing(),this.hud.showSonarAt(t,e),this.hud.setSonarFollowX(!1),this.hud.updateSonarDot(e);const s=this.locationMgr.getDepthAtXY(t,e),i=Math.min(this.rigDepthM??0,s);this._waterDepthAtCast=s,this._hookDepthAtCast=i,this._castDepthM=i,this._applyRigToBobber(),this.state="waiting",this.barsDock.setMode("idle"),this.setPullUI("idle");const o=J.Math.Between(1e3,1e3);this.biteTimer=this.time.delayedCall(o,()=>this.onBite())}onBite(){var s,i,o,n,r,h,l;if(!this.bobber)return;this.state="bite";const t=((i=(s=this.timeCycle)==null?void 0:s.getInfo)==null?void 0:i.call(s))||{phase:"day"},e=Te({bait:((o=this._getActiveBaitId)==null?void 0:o.call(this))??this.activeBaitId??"worm",timeOfDay:((n=this._spawnTimeFromPhase)==null?void 0:n.call(this,t.phase))??t.phase??"day",locationId:((h=(r=this.locationMgr).getCurrentId)==null?void 0:h.call(r))||this.locationMgr.current||"lake",depthM:this._hookDepthAtCast??this._castDepthM??0,cast:{x:this.bobber.x,y:this.bobber.y},getAreaMods:(c,d)=>{var f,u,p,g;return((u=(f=this.locationMgr).getSpeciesAreaModsAt)==null?void 0:u.call(f,c,d))||((g=(p=this.locationMgr).getSpotModsAt)==null?void 0:g.call(p,c,d))||null}});if(!e){this.showToast("–ó–¥–µ—Å—å –Ω–∞ —ç—Ç—É –Ω–∞–∂–∏–≤–∫—É –∏ –≥–ª—É–±–∏–Ω—É –Ω–µ –∫–ª—é—ë—Ç. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥—É—é –≥–ª—É–±–∏–Ω—É/–Ω–∞–∂–∏–≤–∫—É."),this.state="waiting";const c=J.Math.Between(5e3,12e3);this.biteTimer=this.time.delayedCall(c,()=>this.onBite());return}this.fish=e,(l=this.bobber)==null||l.biteShake(),this.hookActive=!0,this.hookStartMs=this.time.now,this.hookMin=250,this.hookMax=1600,this.hookSweet=850,this.hookTO=this.time.delayedCall(this.hookMax,()=>{this.hookActive&&this.fishEscape("–ü–æ–∑–¥–Ω–æ –ø–æ–¥—Å–µ–∫–ª–∏ ‚Äî —É–ª–æ–≤ —É—à—ë–ª")}),this.setPullUI("bite"),this.showToast("–ö–ª—é—ë—Ç! –ü–æ–¥—Å–µ–∫–∏—Ç–µ!")}attemptHook(){var n,r,h,l,c;if(!this.hookActive)return;const t=this.time.now-this.hookStartMs;if(t<this.hookMin)return this.fishEscape("–°–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ –ø–æ–¥—Å–µ–∫–ª–∏ ‚Äî —Ä—ã–±–∞ —É—à–ª–∞");if(t>this.hookMax)return this.fishEscape("–ü–æ–∑–¥–Ω–æ –ø–æ–¥—Å–µ–∫–ª–∏ ‚Äî —Ä—ã–±–∞ —É—à–ª–∞");this.bobber&&this.tweens.killTweensOf(this.bobber);const e=(this.hookMax-this.hookMin)/2,i=1-Math.min(Math.abs(t-this.hookSweet),e)/e;if(this.hookQ=i,this.slipGraceUntil=this.time.now+2500,this.hookActive=!1,this.hookTO&&(this.hookTO.remove(),this.hookTO=null),(n=this.bobber)==null||n.stopAllTweens(),this.params=De(this.gear,this.fish,i),(r=this.fish)!=null&&r.kind&&this.fish.kind!=="fish"){const d={loot:.35,trash:.25,bycatch:.5}[this.fish.kind]??.35;this.params.rodUp=(this.params.rodUp??18)*d,this.params.lineUp=(this.params.lineUp??22)*d,this.params.down=(this.params.down??12)*.6,this.params.fishPullSpeed=(this.params.fishPullSpeed??70)*d,this.params.pullSpeed=(this.params.pullSpeed??120)*1,this.params.escapeLimit=Math.max(2,(this.params.escapeLimit??3.2)*1.6);const f=this.params.jerk||{add:4,chance:.4,minMs:900,maxMs:1600};f.add=(f.add??4)*(.35*d+.15),f.chance=Math.min(.15,(f.chance??.4)*.35),f.minMs=Math.max(900,(f.minMs??900)*1.5),f.maxMs=Math.max(f.minMs+200,(f.maxMs??1600)*1.6),this.params.jerk=f}if(this.fishSideSpeed=this.params.fishPullSpeed*.75,this.fishTargetX=this.bobber.x,this.sideTimer&&this.sideTimer.remove(),this.sideTimer=this.time.addEvent({delay:J.Math.Between(600,1200),loop:!0,callback:()=>{this.fishTargetX=J.Math.Between(30,this.scale.width-30)}}),this.state="fight",this.hud.setSonarFollowX(!0),(l=(h=this.hud).setSonarFight)==null||l.call(h,!0),this.tailPx=0,this.rodVal=0,this.lineVal=0,this.pullPressed=!1,this.noPullTime=0,this.holdAcc=0,this.baitCharged=!1,(c=this.hud)==null||c.update(),this.barsDock.setMode("fight"),this.setPullUI("fight"),this.logicShoreY-this.bobber.y<28){const f=Math.max(this.castTopY+16,this.bobber.y-12),u=J.Math.Clamp(this.bobber.x+J.Math.Between(-24,24),20,this.scale.width-20);this.kickTweening=!0,this.tweens.add({targets:this.bobber,y:f,x:u,duration:140,ease:"Sine.out",onComplete:()=>{this.kickTweening=!1}})}this.queueSlip(),this.scheduleNextJerk()}queueSlip(){this.slipTO&&this.slipTO.remove();const t=J.Math.Between(2e3,2800);this.slipTO=this.time.delayedCall(t,()=>this.trySlip())}trySlip(){var e;if(this.state!=="fight")return;let t=this.baseSlipChance/(((e=this.gear.hook)==null?void 0:e.control)??1);t*=this.pullPressed?.5:1.1,(this.rodVal>=90||this.lineVal>=90)&&(t*=1.25),Math.random()<t?this.fishEscape("–†—ã–±–∞ —Å–æ—à–ª–∞"):this.queueSlip()}scheduleNextJerk(){var i;if(!((i=this.params)!=null&&i.jerk))return;const{minMs:t,maxMs:e}=this.params.jerk,s=J.Math.Between(t,e);this.jerkTO=this.time.delayedCall(s,()=>{this.applyJerk(),this.scheduleNextJerk()})}applyJerk(){var o;if(this.state!=="fight"||!((o=this.params)!=null&&o.jerk))return;const{add:t,chance:e}=this.params.jerk;if(Math.random()>e)return;const s=this.pullPressed?1:1.15,i=t*(.85+Math.random()*.3)*s;this.rodVal=J.Math.Clamp(this.rodVal+i,0,100),this.lineVal=J.Math.Clamp(this.lineVal+i,0,100),this.rodBar.set(this.rodVal),this.lineBar.set(this.lineVal),this.bobber&&(this.bobber.y=Math.max(this.castTopY+8,this.bobber.y-4))}update(t,e){var f,u,p,g,m,_;const s=(u=(f=this.timeCycle)==null?void 0:f.getInfo)==null?void 0:u.call(f);if(s&&(this.timeOfDay=s.phase,(m=(g=(p=this.hud)==null?void 0:p.clock)==null?void 0:g.update)==null||m.call(g)),(_=this.hud)==null||_.update(),this.bobber&&(this.state==="idle"||this.state==="waiting")&&(this.hud.updateSonarDot(this.bobber.y),this._applyRigToBobber()),this.state==="fight"&&this.bobber){const b=Math.max(this.rodVal,this.lineVal)/100;this.hud.updateSonarDot(this.bobber.y,{tension:b,reeling:this.pullPressed,allowXDrift:!0})}if(this.state!=="fight"||!this.params){if(this.bobber){const b=this.castBottomY;this.bobber.y=J.Math.Clamp(this.bobber.y,this.castTopY+8,b)}return}const i=e/1e3,o=this.params;if(this.kickTweening){this.pullPressed?(this.rodVal+=o.rodUp*i,this.lineVal+=o.lineUp*i):(this.rodVal-=o.down*i,this.lineVal-=o.down*i),this.rodVal=J.Math.Clamp(this.rodVal,0,100),this.lineVal=J.Math.Clamp(this.lineVal,0,100),this.rodBar.set(this.rodVal),this.lineBar.set(this.lineVal);return}if(this.pullPressed?(this.rodVal+=o.rodUp*i,this.lineVal+=o.lineUp*i):(this.rodVal-=o.down*i,this.lineVal-=o.down*i),this.rodVal=J.Math.Clamp(this.rodVal,0,100),this.lineVal=J.Math.Clamp(this.lineVal,0,100),this.rodBar.set(this.rodVal),this.lineBar.set(this.lineVal),this.rodVal>=100&&this.lineVal>=100)return Math.random()<.5?this.breakRod():this.breakLine();if(this.rodVal>=100)return this.breakRod();if(this.lineVal>=100)return this.breakLine();const n=this.logicShoreY-this.bobber.y,r=J.Math.Clamp(n/160,.5,1);if(this.pullPressed)this.noPullTime=0,this.bobber.y+=o.pullSpeed*r*i;else{this.noPullTime+=i;const b=this.castTopY+8,y=this.bobber.y-b,k=J.Math.Clamp(y/60,.25,1);this.bobber.y-=o.fishPullSpeed*k*i}if(this.fishTargetX!=null){const b=this.fishTargetX-this.bobber.x;let y=this.pullPressed?.35:1;this.bobber.y>=this.logicShoreY-6&&(y*=.25);const k=this.fishSideSpeed*i*y,P=J.Math.Clamp(b,-k,k);this.bobber.x+=P}this.bobber.x=J.Math.Clamp(this.bobber.x,20,this.scale.width-20);const h=this.state==="fight"?this.visualBottomY:this.castBottomY;if(this.bobber.y=J.Math.Clamp(this.bobber.y,this.castTopY+8,h),this.noPullTime>o.escapeLimit||this.bobber.y<=this.castTopY+8)return this.fishEscape("–†—ã–±–∞ —Å–æ—Ä–≤–∞–ª–∞—Å—å");const l=this.bobber.y>=this.logicShoreY-6,d=Math.max(this.rodVal,this.lineVal)<this.SAFE_THR+10;if(l&&d){const b=this.pullPressed?1:.6;if(this.holdAcc+=i*b,this.holdAcc>=this.HOLD_NEED)return this.landFish()}else this.holdAcc=0}breakRod(){var t;this.showToast("–£–¥–æ—á–∫–∞ —Å–ª–æ–º–∞–ª–∞—Å—å!"),this.gear.rod.durability=Math.max(0,(this.gear.rod.durability??100)-20),this.chargeBaitOnce(),(t=this.slots)==null||t.update(this.gear),this.endFight("break")}breakLine(){var e,s;this.showToast("–õ–µ—Å–∫–∞ –ø–æ—Ä–≤–∞–ª–∞—Å—å!"),this.gear.line.durability=Math.max(0,(this.gear.line.durability??100)-25);const t=(e=this.gear.hook)==null?void 0:e.id;if(t){const i=this.gear.hook.count|0;this.gear.hook.count=Math.max(0,i-1);const o=this.inventory.hookPacks||(this.inventory.hookPacks={});o[t]=Math.max(0,(o[t]|0)-1),o[t]===0&&this.showToast("–ö—Ä—é—á–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å")}this.chargeBaitOnce(),(s=this.slots)==null||s.update(this.gear),this.endFight("break")}fishEscape(t="–†—ã–±–∞ —É—à–ª–∞"){this.showToast(t),this.chargeBaitOnce(),this.endFight("escape")}async landFish(){var n,r,h,l,c,d,f,u;this.chargeBaitOnce();const t=this.fish;this.barsDock.setMode("idle"),this.setPullUI("idle");const e={locationId:((r=(n=this.locationMgr).getCurrentId)==null?void 0:r.call(n))||this.locationMgr.current||this.locId||"lake",depthM:this._hookDepthAtCast??this._castDepthM??this.rigDepthM,bait:((h=this._getActiveBaitId)==null?void 0:h.call(this))??this.activeBaitId??"worm"};t.imageKey=t.imageKey||(t.kind==="fish"?Mt.key("fish",t.id):Mt.key("pick",t.id)),this.state;const s=this.uiLock;this.state="result",this.uiLock=!0;const i=await Qs(this,t,e);if(this.uiLock=s,this.state="idle",t.kind!=="fish"){const p=((l=t==null?void 0:t.reward)==null?void 0:l.coins)|0;i==="take"&&p>0&&(this.wallet.coins=(this.wallet.coins|0)+p,this.hud.setWallet(this.wallet.coins|0,this.wallet.gold|0),(c=this.commitState)==null||c.call(this),Dt(this.wallet)),this.setPullUI("idle"),this.clearAttempt();return}const o=p=>{var _,b,y,k,P,M;const g=this.progress.xpForFish(t),m=this.progress.grantCatchXP(t,{released:p});(y=(b=(_=this.hud)==null?void 0:_.level)==null?void 0:b.update)==null||y.call(b),m.leveled>0&&((M=(P=(k=this.hud)==null?void 0:k.level)==null?void 0:P.pulse)==null||M.call(P)),Js({level:this.progress.level,xp:this.progress.xp}),this.showToast(`+${p?g*2:g} XP`)};i==="keep"&&this.keepnet.length<this.keepnetCap?(this.keepnet.push(t),this.hud.setKeepnet(this.keepnet.length,this.keepnetCap),(d=this.commitState)==null||d.call(this),o(!1)):o(!0),(u=(f=this.ioClient)==null?void 0:f.announceCatch)==null||u.call(f,{fishId:t.id,name:t.name,weightKg:t.weightKg,lengthCm:t.lengthCm,rarity:t.rarity,photoKey:t.imageKey}),this.clearAttempt(),this.state="idle"}updateWalletHUD(){var t;(t=this.hud)==null||t.setWallet(this.wallet.coins|0,this.wallet.gold|0,this.wallet.perks|0)}endFight(){var t,e;this.hud.setSonarFollowX(!1),(e=(t=this.hud).setSonarFight)==null||e.call(t,!1),this.clearAttempt(),this.barsDock.setMode("idle"),this.setPullUI("idle"),this.state="idle",this.tailPx=0}_getActiveBaitId(){return this.activeBaitId||"worm"}_getBaitCount(){var e,s;const t=this._getActiveBaitId();return((s=(e=this.inventory)==null?void 0:e.bait)==null?void 0:s[t])|0}_setBaitCount(t){var i;const e=this._getActiveBaitId(),s=this.inventory.bait||(this.inventory.bait={});s[e]=Math.max(0,t|0),this.gear.inv.bait=s[e],(i=this.slots)==null||i.update(this.gear)}chargeBaitOnce(){if(this.baitCharged)return;const t=this._getBaitCount();t<=0||(this.baitCharged=!0,this._setBaitCount(t-1))}openBaitModal(){var _,b,y;if(this.state==="fight"){this.showToast("–ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –Ω–∞–∂–∏–≤–∫—É –≤–æ –≤—Ä–µ–º—è –≤—ã–≤–∞–∂–∏–≤–∞–Ω–∏—è");return}const t=this.scale.width,e=this.scale.height,s=Math.min(520,t-80),i=Math.min(360,e-120),o=Math.round(t/2),n=Math.round(e/2),r=2100;this.uiLock=!0;const h=this.add.container(0,0).setDepth(r),l=this.add.rectangle(0,0,t,e,0,.6).setOrigin(0,0).setScrollFactor(0).setInteractive(),c=this.add.rectangle(o+2,n+3,s,i,0,.22),d=this.add.rectangle(o,n,s,i,2040883,1).setStrokeStyle(2,16777215,.22),f=this.add.text(o,n-i/2+16,"–í—ã–±–æ—Ä –Ω–∞–∂–∏–≤–∫–∏",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(.5,0),u=this.add.text(o+s/2-18,n-i/2+6,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(1,0).setInteractive();h.add([l,c,d,f,u]);const p=((_=this.inventory)==null?void 0:_.bait)||{},g=Object.keys(p);if(g.length===0){const k=this.add.text(o,n,"–ù–∞–∂–∏–≤–∫–∏ –Ω–µ—Ç",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#cfd8dc"}).setOrigin(.5);h.add(k)}else{const k={};(((b=at==null?void 0:at.items)==null?void 0:b.bait)||[]).forEach(A=>k[A.id]=A.name);const P=56,M=10,I=g.length*P+(g.length-1)*M;let x=Math.round(n-I/2+P/2)+10;g.forEach(A=>{const F=s-40,C=P,T=this.add.container(o,x),B=this.add.rectangle(0,0,F,C,2765124,1).setStrokeStyle(2,16777215,.16).setInteractive({useHandCursor:!0}),K=k[A]||A,D=p[A]|0,S=this.add.text(-F/2+12,0,K,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(0,.5),w=this.add.text(S.x+S.width+10,0,`‚Ä¢ ${D} —à—Ç.`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#a7ffeb"}).setOrigin(0,.5),W=110,R=this.add.rectangle(F/2-W/2-8,0,W,30,3884642,1).setStrokeStyle(2,16777215,.18),E=this.add.text(R.x,R.y,D>0?"–í—ã–±—Ä–∞—Ç—å":"–ù–µ—Ç",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff"}).setOrigin(.5);D>0?R.setInteractive({useHandCursor:!0}).on("pointerover",()=>R.setFillStyle(4411508,1)).on("pointerout",()=>R.setFillStyle(3884642,1)).on("pointerdown",()=>{var X,H;this.activeBaitId=A,this.gear.inv.bait=p[A]|0,(X=this.slots)==null||X.update(this.gear),this.showToast(`–ù–∞–∂–∏–≤–∫–∞: ${K}`),(H=this.commitState)==null||H.call(this),m()}):(R.setFillStyle(2896966,1),E.setColor("#bfc7d9")),T.add([B,S,w,R,E]),h.add(T),x+=P+M})}const m=()=>{h.destroy(),this.time.delayedCall(16,()=>this.uiLock=!1)};u.on("pointerdown",m),l.on("pointerdown",k=>{k.stopPropagation(),m()}),(y=this.input.keyboard)==null||y.once("keydown-ESC",m)}clearAttempt(){var t,e;this.hookTO&&(this.hookTO.remove(),this.hookTO=null),this.slipTO&&(this.slipTO.remove(),this.slipTO=null),this.hookActive=!1,this.sideTimer&&(this.sideTimer.remove(),this.sideTimer=null),this.fishTargetX=null,this.fishSideSpeed=0,this.biteTimer&&(this.biteTimer.remove(),this.biteTimer=null),this.bobber&&(this.bobber.stopAllTweens(),this.bobber.destroy(),this.bobber=null),this.hud.hideSonar(),(e=(t=this.hud).setSonarFight)==null||e.call(t,!1),this.fish=null,this.params=null,this.kickTweening=!1,this.holdAcc=0,this.baitCharged=!1,this.jerkTO&&(this.jerkTO.remove(),this.jerkTO=null)}showToast(t){const e=this.scale.width,s=this.scale.height;this.toast&&this.toast.destroy();const i=this.add.text(e/2,s-20,t,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5,1);this.toast=i,this.tweens.add({targets:i,alpha:0,duration:1500,delay:900,onComplete:()=>i.destroy()})}}const ne={_default:{kgPrice:60,premiumMult:2.5,premiumMinKg:1.2,recordKg:5},–û–∫—É–Ω—å:{kgPrice:70,premiumMult:2.6,premiumMinKg:1,recordKg:3.5},–©—É–∫–∞:{kgPrice:18,premiumMult:2.2,premiumMinKg:3,recordKg:9},–ö–∞—Ä–ø:{kgPrice:12,premiumMult:2.4,premiumMinKg:2.5,recordKg:8}};function zt(a){return ne[a==null?void 0:a.name]||ne._default}function ii(a){const t=zt(a);return a.weightKg>=t.premiumMinKg}function oi(a){const t=zt(a);return a.weightKg>=t.recordKg}function ai(a){const t=zt(a);return Math.round(a.weightKg*t.kgPrice)}function ni(a){const t=zt(a);return Math.round(a.weightKg*t.kgPrice*t.premiumMult)}function ri(a){const t=[],e=[],s=[];for(const r of a)oi(r)?s.push(r):ii(r)?e.push(r):t.push(r);const i=t.reduce((r,h)=>r+ai(h),0),o=e.reduce((r,h)=>r+ni(h),0),n=s.length;return{small:t,prem:e,rec:s,sumSmall:i,sumPrem:o,cntRec:n}}class hi{constructor(t,e,s,i,o){this.scene=t,this.keepnet=e,this.wallet=s,this.onChange=i,this.onClose=o,this.kill=[],this.depthBase=3100,this.toast=H=>{const G=this.scene.add.text(Math.round(this.scene.scale.width/2),Math.round(this.scene.scale.height-64),H,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(.5).setDepth(this.depthBase+10).setScrollFactor(0);this.scene.tweens.add({targets:G,y:G.y-12,alpha:0,delay:600,duration:1600,onComplete:()=>G.destroy()})};const n=this.scene.scale.width,r=this.scene.scale.height,h=18,l=t.add.rectangle(0,0,n,r,0,.72).setOrigin(0,0).setInteractive().setDepth(this.depthBase).setScrollFactor(0);l.on("pointerdown",(H,G,L,Y)=>Y==null?void 0:Y.stopPropagation()),l.on("wheel",(H,G,L,Y,j)=>j==null?void 0:j.stopPropagation()),this.kill.push(l);const c=Math.min(1060,n-80),d=Math.min(620,r-80),f=Math.round(n/2),u=Math.round(r/2),p=t.add.rectangle(f+2,u+3,c,d,0,.22).setDepth(this.depthBase+1).setScrollFactor(0),g=t.add.rectangle(f,u,c,d,2040883,1).setStrokeStyle(2,16777215,.22).setDepth(this.depthBase+1).setScrollFactor(0);this.kill.push(p,g);const m=u-d/2+16,_=t.add.text(f-c/2+20,m,"–ü–†–û–î–ê–ñ–ê –†–´–ë–´",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#ffffff",fontStyle:"bold"}).setOrigin(0,0).setDepth(this.depthBase+2),b=t.add.text(f+c/2-14,m-8,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(1,0).setDepth(this.depthBase+2).setInteractive({useHandCursor:!0});b.on("pointerdown",()=>this.close()),this.kill.push(_,b);const y=f-c/2+h,k=m+48,P=c-h*2,M=36,I=16,x=Math.floor((P-I)/2),A=y,F=y+x+I,C=this._sectionCaption(A,k,x,"–û–ø—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂–∏"),T=this._sectionCaption(F,k,x,"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã");this.kill.push(C.g,C.t,T.g,T.t);const B=k+M+8,K=u+d/2-h-B,D=t.add.rectangle(A,B,x,K,988189,1).setOrigin(0,0).setStrokeStyle(2,16777215,.12).setDepth(this.depthBase+1),S=t.add.rectangle(F,B,x,K,988189,1).setOrigin(0,0).setStrokeStyle(2,16777215,.12).setDepth(this.depthBase+1);this.kill.push(D,S),this.leftRoot=t.add.container(A+12,B+12).setDepth(this.depthBase+2),this.ordersRoot=t.add.container(F+12,B+12).setDepth(this.depthBase+2),this.summaryBar=this._buildSummaryBar(A,B,x,K),this.kill.push(this.summaryBar.grp),this.kill.push(this.leftRoot,this.ordersRoot),this.sellCards=[];let w=0;this.sellCards.push(this._buildSellOption(this.leftRoot,{y:w,w:x-24,h:120,icon:"rare",title:"–†–µ–¥–∫–∞—è —Ä—ã–±–∞",subtitle:"–ü—Ä–æ–¥–∞—Ç—å —Ä–µ–¥–∫—É—é —Ä—ã–±—É –∑–∞ –∑–æ–ª–æ—Ç–æ",countText:()=>{var H;return`–£ –≤–∞—Å: ${((H=this._cache)==null?void 0:H.cntRec)|0} —à—Ç`},estText:()=>{var H;return`–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${((H=this._cache)==null?void 0:H.cntRec)|0} –∑–æ–ª–æ—Ç—ã—Ö`},button:{label:"–°–∫–æ—Ä–æ",disabled:!0,onClick:()=>this.soon()}})),w+=132,this.sellCards.push(this._buildSellOption(this.leftRoot,{y:w,w:x-24,h:120,icon:"big",title:"–ö—Ä—É–ø–Ω–∞—è —Ä—ã–±–∞",subtitle:"–ü—Ä–æ–¥–∞—Ç—å –≤—Å—é –∫—Ä—É–ø–Ω—É—é —Ä—ã–±—É (–î–æ—Ä–æ–≥–æ)",countText:()=>{var H,G;return`–£ –≤–∞—Å: ${((G=(H=this._cache)==null?void 0:H.prem)==null?void 0:G.length)|0} —à—Ç`},estText:()=>{var H;return`–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${((H=this._cache)==null?void 0:H.sumPrem)|0} —Å–µ—Ä–µ–±—Ä–∞`},button:{label:"–ü—Ä–æ–¥–∞—Ç—å",onClick:()=>this.sellPremium()}})),w+=132,this.sellCards.push(this._buildSellOption(this.leftRoot,{y:w,w:x-24,h:120,icon:"all",title:"–í—Å—è —Ä—ã–±–∞",subtitle:"–ü—Ä–æ–¥–∞—Ç—å –≤—Å—é —Ä—ã–±—É –æ–ø—Ç–æ–º (–î–µ—à–µ–≤–æ)",countText:()=>`–£ –≤–∞—Å: ${this.keepnet.length|0} —à—Ç`,estText:()=>{var H,G;return`–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${(((H=this._cache)==null?void 0:H.sumSmall)|0)+(((G=this._cache)==null?void 0:G.sumPrem)|0)} —Å–µ—Ä–µ–±—Ä–∞`},button:{label:"–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë",onClick:()=>this.sellAll()}})),this.orders=[{id:"bream",name:"–õ–µ—â",price:90,tex:"fish_bream"},{id:"catfish",name:"–°–æ–º",price:200,tex:"fish_catfish"},{id:"croaker",name:"–ì–æ—Ä–±—ã–ª—å —Å—É–¥–∞—á–∏–π",price:45,tex:"fish_croaker"},{id:"asp",name:"–ñ–µ—Ä–µ—Ö",price:75,tex:"fish_asp"}];const W=12,z=Math.floor((x-24-W)/2),R=196;let E=0,X=0;for(const H of this.orders){const G=0+E*(z+W),L=0+X*(R+W);this._buildOrderCard(this.ordersRoot,H,G,L,z,R),E++,E>=2&&(E=0,X++)}this.leftRoot.setAlpha(0),this.ordersRoot.setAlpha(0),t.tweens.add({targets:this.leftRoot,alpha:1,duration:200,ease:"Sine.out"}),t.tweens.add({targets:this.ordersRoot,alpha:1,duration:200,ease:"Sine.out",delay:70}),this.refresh()}_sectionCaption(t,e,s,i){const o=this.scene.add.rectangle(t,e,s,36,725017,1).setOrigin(0,0).setStrokeStyle(2,16777215,.1).setDepth(this.depthBase+1),n=this.scene.add.text(t+s/2,e+6,i,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#e9f0ff",fontStyle:"bold"}).setOrigin(.5,0).setDepth(this.depthBase+2);return{g:o,t:n}}_buildSellOption(t,{y:e,w:s,h:i,icon:o,title:n,subtitle:r,countText:h,estText:l,button:c}){const d=this.depthBase+2,f=this.scene,u=f.add.rectangle(0,e,s,i,2765124,1).setOrigin(0,0).setStrokeStyle(2,16777215,.16).setDepth(d).setInteractive();u.on("pointerover",()=>u.setFillStyle(3358810,1)),u.on("pointerout",()=>u.setFillStyle(2765124,1)),t.add(u),this.kill.push(u);const p=f.add.rectangle(12,e+12,110,i-24,988189,1).setOrigin(0,0).setStrokeStyle(2,16777215,.1).setDepth(d+1);t.add(p),this.kill.push(p);const g=this._drawSellIcon(o,p.x+55,p.y+(i-24)/2,34);t.add(g),this.kill.push(g);const m=134,_=f.add.text(m,e+14,n,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(0,0).setDepth(d+1),b=f.add.text(m,_.y+22,r,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#cfd8dc"}).setOrigin(0,0).setDepth(d+1),y=f.add.text(m,b.y+20,"",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#a9b7d0"}).setOrigin(0,0).setDepth(d+1),k=f.add.text(m,y.y+18,"",{fontFamily:"Arial, sans-serif",fontSize:"13px",color:"#a9b7d0"}).setOrigin(0,0).setDepth(d+1);t.add(_),t.add(b),t.add(y),t.add(k),this.kill.push(_,b,y,k);const P=140,M=36,I=s-P-12,x=e+i-M-12,A=f.add.rectangle(I,x,P,M,c!=null&&c.disabled?4937064:2792847,1).setOrigin(0,0).setStrokeStyle(2,16777215,.18).setDepth(d+1),F=f.add.text(I+P/2,x+M/2,(c==null?void 0:c.label)||"–ü—Ä–æ–¥–∞—Ç—å",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff"}).setOrigin(.5).setDepth(d+2);t.add(A),t.add(F),this.kill.push(A,F),c!=null&&c.disabled||A.setInteractive({useHandCursor:!0}).on("pointerover",()=>A.setFillStyle(3322787,1)).on("pointerout",()=>A.setFillStyle(2792847,1)).on("pointerdown",c.onClick);const C=()=>{y.setText(h?h():""),k.setText(l?l():"")};return C(),{update:C}}_drawSellIcon(t,e,s,i=32){const o=this.scene.add.graphics().setDepth(this.depthBase+3);if(o.lineStyle(2,16777215,1),t==="rare"){o.strokeCircle(e-i/3,s,i/4),o.beginPath(),o.moveTo(e-i/6,s),o.lineTo(e+i/2,s),o.strokePath();for(let n=-2;n<=2;n++)o.beginPath(),o.moveTo(e+n*6,s),o.lineTo(e+n*6-6,s-6),o.moveTo(e+n*6,s),o.lineTo(e+n*6-6,s+6),o.strokePath();o.fillStyle(16777215,1).fillCircle(e+i/2+2,s,2)}else if(t==="big")o.strokeEllipse(e,s,i*1.2,i*.7),o.beginPath(),o.moveTo(e+i*.6,s),o.lineTo(e+i*.9,s-i*.2),o.lineTo(e+i*.9,s+i*.2),o.closePath(),o.strokePath(),o.fillStyle(16777215,1).fillCircle(e-i*.25,s-i*.08,2);else for(let n=0;n<3;n++){const r=s-i*.22+n*i*.22;o.strokeEllipse(e-i*.1,r,i*.7,i*.38),o.beginPath(),o.moveTo(e+i*.25,r),o.lineTo(e+i*.45,r-i*.12),o.moveTo(e+i*.25,r),o.lineTo(e+i*.45,r+i*.12),o.strokePath()}return o}_buildOrderCard(t,e,s,i,o,n){var _;const r=this.depthBase+2,h=this.scene,l=h.add.rectangle(s,i,o,n,2765124,1).setOrigin(0,0).setStrokeStyle(2,16777215,.16).setDepth(r).setInteractive({useHandCursor:!0});l.on("pointerover",()=>l.setFillStyle(3358810,1)),l.on("pointerout",()=>l.setFillStyle(2765124,1)),l.on("pointerdown",()=>this.soon()),t.add(l),this.kill.push(l);const c=n-74,d=h.add.rectangle(s+8,i+8,o-16,c,988189,1).setOrigin(0,0).setStrokeStyle(2,16777215,.1).setDepth(r+1);if(t.add(d),this.kill.push(d),e.tex&&((_=h.textures)!=null&&_.exists(e.tex))){const b=h.add.image(d.x+d.width/2,d.y+d.height/2,e.tex).setDepth(r+2),y=Math.min((d.width-16)/b.width,(d.height-16)/b.height);b.setScale(y),t.add(b),this.kill.push(b)}else{const b=h.add.graphics().setDepth(r+2);b.lineStyle(2,7066111,.9).beginPath();const y=d.x+12,k=(d.width-24)/5;for(let P=0;P<=5;P++){const M=y+P*k,I=d.y+d.height/2+(P%2?-12:12);P===0?b.moveTo(M,I):b.lineTo(M,I)}b.strokePath(),t.add(b),this.kill.push(b)}const f=h.add.text(s+o/2,d.y+d.height+8,e.name,{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff",align:"center",wordWrap:{width:o-16}}).setOrigin(.5,0).setDepth(r+2);t.add(f),this.kill.push(f);const u=96,p=28,g=h.add.rectangle(s+(o-u)/2,i+n-p-10,u,p,988189,1).setOrigin(0,0).setStrokeStyle(2,16777215,.12).setDepth(r+2),m=h.add.text(g.x+u/2,g.y+p/2,`${e.price|0} ü™ô`,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#e9f0ff"}).setOrigin(.5).setDepth(r+3);t.add(g),t.add(m),this.kill.push(g,m)}refresh(){var h;const{small:t,prem:e,rec:s,sumSmall:i,sumPrem:o,cntRec:n}=ri(this.keepnet);this._cache={small:t,prem:e,rec:s,sumSmall:i,sumPrem:o,cntRec:n},(h=this.sellCards)==null||h.forEach(l=>(l==null?void 0:l.update)&&l.update());const r=this.scene.keepnetCap|0||25;this.summaryBar.set(this.wallet.coins|0,`${this.keepnet.length|0}/${r}`,this.wallet.gold|0)}sellSmall(){const{small:t,sumSmall:e}=this._cache;t.length&&(this.keepnet.splice(0,this.keepnet.length,...this.keepnet.filter(s=>!t.includes(s))),this.wallet.coins+=e,this.toast(`–ü—Ä–æ–¥–∞–Ω–æ –ø–æ –∫–≥: +${e} –º–æ–Ω.`),this.onChange&&this.onChange(),this.refresh())}sellPremium(){const{prem:t,sumPrem:e}=this._cache;t.length&&(this.keepnet.splice(0,this.keepnet.length,...this.keepnet.filter(s=>!t.includes(s))),this.wallet.coins+=e,this.toast(`–ü—Ä–æ–¥–∞–Ω–æ —Ü–µ–Ω–Ω–æ–µ: +${e} –º–æ–Ω.`),this.onChange&&this.onChange(),this.refresh())}sellAll(){const{small:t,prem:e,sumSmall:s,sumPrem:i}=this._cache,o=[...t,...e];if(!o.length)return;this.keepnet.splice(0,this.keepnet.length,...this.keepnet.filter(r=>!o.includes(r)));const n=(s|0)+(i|0);this.wallet.coins+=n,this.toast(`–ü—Ä–æ–¥–∞–Ω–æ –≤—Å—ë: +${n} –º–æ–Ω.`),this.onChange&&this.onChange(),this.refresh()}soon(){this.toast("–°–∫–æ—Ä–æ: —Å–ø–µ—Ü-–∑–∞–∫–∞–∑—ã –∏ —Ä–µ–¥–∫–∞—è —Ä—ã–±–∞ –∑–∞ –∑–æ–ª–æ—Ç–æ")}close(){this.kill.forEach(t=>{try{t.destroy()}catch{}}),this.onClose&&this.onClose()}_buildSummaryBar(t,e,s,i){const o=this.scene,n=this.depthBase+2,r=t+12,h=e+i-60,l=s-24,c=52,d=o.add.container(r,h).setDepth(n),f=o.add.rectangle(0,0,l,c,1778224,1).setOrigin(0,0).setStrokeStyle(2,16777215,.12),u=o.add.rectangle(l/2,6,l-10,8,16777215,.05).setOrigin(.5,0);d.add([f,u]);const p=8,g=Math.floor((l-p*4)/3),m=c-16,_=this._makePill(d,p,8,g,m,2503242,(k,P,M)=>this._iconCoin(k,P,M),"0"),b=this._makePill(d,p*2+g,8,g,m,2503242,(k,P,M)=>this._iconKeep(k,P,M),"0/0"),y=this._makePill(d,p*3+g*2,8,g,m,2765640,(k,P,M)=>this._iconGold(k,P,M),"0");return{grp:d,set:(k,P,M)=>{_.text.setText(String(k)),b.text.setText(P),y.text.setText(String(M))}}}_makePill(t,e,s,i,o,n,r,h="0"){const l=this.scene,c=this.depthBase+3,d=l.add.container(e,s).setDepth(c),f=l.add.rectangle(0,0,i,o,n,1).setOrigin(0,0).setStrokeStyle(2,16777215,.12),u=l.add.rectangle(i/2,4,i-10,6,16777215,.06).setOrigin(.5,0),p=l.add.graphics({x:14,y:Math.floor(o/2)});r(p,0,0);const g=l.add.text(30,Math.floor(o/2),h,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#eaf2ff"}).setOrigin(0,.5);return d.add([f,u,p,g]),t.add(d),this.kill.push(d,f,u,p,g),{c:d,text:g}}_iconCoin(t,e,s){t.fillStyle(16176227,1).fillCircle(e,s,8),t.fillStyle(16777215,.6).fillCircle(e-3,s-3,2),t.lineStyle(2,16777215,.18).strokeCircle(e,s,8)}_iconGold(t,e,s){const n=[];for(let r=0;r<10;r++){const h=-Math.PI/2+r*Math.PI/5,l=r%2?3.6:8;n.push({x:e+Math.cos(h)*l,y:s+Math.sin(h)*l})}t.fillStyle(16770170,1).fillPoints(n,!0),t.lineStyle(2,16777215,.18).strokePoints(n,!0)}_iconKeep(t,e,s){t.lineStyle(2,12179455,1),t.strokeEllipse(e-2,s,14,8),t.beginPath(),t.moveTo(e+5,s),t.lineTo(e+11,s-4),t.moveTo(e+5,s),t.lineTo(e+11,s+4),t.strokePath(),t.fillStyle(16777215,1).fillCircle(e-7,s-1.2,1.2)}}class li{constructor(t,e,s,i=1,o,n){var z;this.s=t,this.wallet=e,this.inventory=s,this.level=i|0,this.onChange=o,this.onClose=n,Ee(ce),this.kill=[],this.depthBase=O.z.modal+50;const r=this.s.scale.width,h=this.s.scale.height,l=Math.min(1060,r-80),c=Math.min(620,h-80),d=Math.round(r/2),f=Math.round(h/2),u=this.s.add.rectangle(0,0,r,h,0,.72).setOrigin(0,0).setDepth(this.depthBase).setScrollFactor(0).setInteractive();u.on("pointerdown",(R,E,X,H)=>H==null?void 0:H.stopPropagation()),u.on("wheel",(R,E,X,H,G,L)=>L==null?void 0:L.stopPropagation()),this.kill.push(u);const p=this.s.add.rectangle(d+2,f+3,l,c,0,.22).setDepth(this.depthBase+1).setScrollFactor(0),g=this.s.add.rectangle(d,f,l,c,1382948,1).setStrokeStyle(2,16777215,.22).setDepth(this.depthBase+1).setScrollFactor(0);this.kill.push(p,g);const m=f-c/2+16,_=this.s.add.text(d-l/2+20,m,"–ú–ê–ì–ê–ó–ò–ù",{fontFamily:"Arial, sans-serif",fontSize:"28px",color:"#ffffff",fontStyle:"bold"}).setOrigin(0,0).setDepth(this.depthBase+2),b=this.s.add.text(d+l/2-14,m-8,"‚úï",{fontFamily:"Arial, sans-serif",fontSize:"22px",color:"#ffffff"}).setOrigin(1,0).setDepth(this.depthBase+2).setInteractive({useHandCursor:!0});b.on("pointerdown",()=>this.close()),this.kill.push(_,b);const y=this.s.add.text(d-l/2+20,m+34,`–£—Ä–æ–≤–µ–Ω—å: ${this.level}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#8ea6c9"}).setOrigin(0,0).setDepth(this.depthBase+2);this.kill.push(y),this._walletText=this.s.add.text(d+l/2-20,m+34,`ü™ô ${this.wallet.coins|0}   ‚òÖ ${this.wallet.gold|0}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#cfd8ff"}).setOrigin(1,0).setDepth(this.depthBase+2),this.kill.push(this._walletText);const k=18,P=260,M=m+70,I=c-(M-(f-c/2))-k,x=Math.round(d-l/2+k+P/2),A=this.s.add.rectangle(x,Math.round(M+I/2),P,I,988189,1).setStrokeStyle(2,16777215,.12).setDepth(this.depthBase+1);this.kill.push(A);const F=l-P-k*3,C=Math.round(x+P/2+k+F/2),T=this.s.add.rectangle(C,Math.round(M+I/2),F,I,988189,1).setStrokeStyle(2,16777215,.12).setDepth(this.depthBase+1);this.kill.push(T),this._catViewport={x,y:Math.round(M+I/2),w:P,h:I},this._onWheel=(R,E,X,H,G,L)=>{if(!this._catViewport||!this._listViewport)return;const Y=R.x,j=R.y;if(this._ptIn(Y,j,this._catViewport)){L==null||L.stopPropagation(),this._scrollCats(H);return}if(this._ptIn(Y,j,this._listViewport)){L==null||L.stopPropagation(),this._scrollList(H);return}},this.s.input.on("wheel",this._onWheel),this.catRoot=this.s.add.container(0,0).setDepth(this.depthBase+2),this.kill.push(this.catRoot);const B=this.s.make.graphics({x:0,y:0,add:!1});B.fillStyle(16777215).fillRect(Math.round(this._catViewport.x-this._catViewport.w/2),Math.round(this._catViewport.y-this._catViewport.h/2),this._catViewport.w,this._catViewport.h);const K=B.createGeometryMask();this.catRoot.setMask(K),this.kill.push(B),this._onWheel=(R,E,X,H,G,L)=>{const Y=R.x,j=R.y;if(this._ptIn(Y,j,this._catViewport)){L==null||L.stopPropagation(),this._scrollCats(H);return}if(this._ptIn(Y,j,this._listViewport)){L==null||L.stopPropagation(),this._scrollList(H);return}},this.s.input.on("wheel",this._onWheel),this._listViewport={x:C,y:Math.round(M+I/2),w:F,h:I},this._onWheel=(R,E,X,H,G,L)=>{if(!this._catViewport||!this._listViewport)return;const Y=R.x,j=R.y;if(this._ptIn(Y,j,this._catViewport)){L==null||L.stopPropagation(),this._scrollCats(H);return}if(this._ptIn(Y,j,this._listViewport)){L==null||L.stopPropagation(),this._scrollList(H);return}},this.s.input.on("wheel",this._onWheel),this.cardsRoot=this.s.add.container(0,0).setDepth(this.depthBase+2);const D=this.s.make.graphics({x:0,y:0,add:!1});D.fillStyle(16777215).fillRect(Math.round(this._listViewport.x-this._listViewport.w/2),Math.round(this._listViewport.y-this._listViewport.h/2),this._listViewport.w,this._listViewport.h);const S=D.createGeometryMask();this.cardsRoot.setMask(S),this.kill.push(this.cardsRoot,D),this._labelMap={sets:"–°–µ—Ç—ã",rods:"–£–¥–æ—á–∫–∏",reels:"–ö–∞—Ç—É—à–∫–∏",lines:"–õ–µ—Å–∫–∞",hooks:"–ö—Ä—é—á–∫–∏",bait:"–ù–∞–∂–∏–≤–∫–∞",accessories:"–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",ex_rods:"–≠–∫—Å–∫–ª—é–∑–∏–≤. —É–¥–∏–ª–∏—â–∞",ex_reels:"–≠–∫—Å–∫–ª—é–∑–∏–≤. –∫–∞—Ç—É—à–∫–∏"};const w=["rods","reels","lines","hooks","bait","accessories","sets","ex_rods","ex_reels"],W=Object.keys(at.items||{});this.categories=at.categories&&at.categories.length?at.categories:w.filter(R=>W.includes(R)),this.categories.length===0&&(this.categories=["rods"]),this.activeTab=this.categories[0],this._buildCategories(),this._renderList(!0),(z=this.s.input.keyboard)==null||z.once("keydown-ESC",()=>this.close())}_buildCategories(){var l;this.catRoot.removeAll(!0);const{x:t,y:e,w:s,h:i}=this._catViewport,o=10,n=58,r=12;let h=Math.round(e-i/2)+8+n/2;this._catBtns=[];for(const c of this.categories){const d=this.s.add.rectangle(t,h,s-14,n,1778224,1).setStrokeStyle(2,16777215,.12).setDepth(this.depthBase+2).setInteractive({useHandCursor:!0}).on("pointerover",()=>d.setFillStyle(2239294,1)).on("pointerout",()=>d.setFillStyle(c===this.activeTab?2372171:1778224,1)).on("pointerdown",()=>this._switchTab(c));this.catRoot.add(d);const f=this._drawCatIcon(c,t-(s-14)/2+r+16,h);this.catRoot.add(f);const u=this.s.add.text(t-(s-14)/2+r+36,h,this._labelMap[c]||c,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#e9f0ff"}).setOrigin(0,.5).setDepth(this.depthBase+3);this.catRoot.add(u),this._catBtns.push({r:d,t:u,cat:c}),h+=n+o}this._updateCatVisual(),this._catsMinY=((l=this.catRoot.first)==null?void 0:l.y)||0,this._catsMaxY=Math.max(this._catsMinY,Math.round(e+i/2)-12)}_ptIn(t,e,s){return t>=s.x-s.w/2&&t<=s.x+s.w/2&&e>=s.y-s.h/2&&e<=s.y+s.h/2}_drawCatIcon(t,e,s){const i=this.s.add.graphics().setDepth(this.depthBase+3);switch(i.lineStyle(2,11911897,1),i.fillStyle(11911897,1),t){case"rods":{i.lineStyle(2,10406399,1),i.beginPath(),i.moveTo(e-14,s+10),i.lineTo(e+14,s-10),i.strokePath(),i.fillCircle(e+10,s-8,2);break}case"reels":{i.lineStyle(2,10406399,1),i.strokeCircle(e,s,10),i.beginPath(),i.moveTo(e+10,s),i.lineTo(e+16,s),i.strokePath();break}case"lines":{i.lineStyle(2,10406399,1),i.strokeRect(e-10,s-10,20,20),i.beginPath(),i.moveTo(e-6,s-6),i.lineTo(e+6,s+6),i.moveTo(e+6,s-6),i.lineTo(e-6,s+6),i.strokePath();break}case"hooks":{i.lineStyle(2,10406399,1),i.beginPath(),i.moveTo(e-6,s-12),i.lineTo(e-6,s+6),i.arc(e,s+6,6,Math.PI,Math.PI*1.8,!1),i.strokePath();break}case"bait":{i.lineStyle(2,10406399,1),i.strokeCircle(e-4,s,5),i.strokeCircle(e+6,s-2,4);break}case"accessories":{i.lineStyle(2,10406399,1),i.strokeRoundedRect(e-12,s-10,24,20,4),i.beginPath(),i.moveTo(e,s-6),i.lineTo(e,s+6),i.moveTo(e-6,s),i.lineTo(e+6,s),i.strokePath();break}case"sets":{i.lineStyle(2,10406399,1),i.strokeRoundedRect(e-12,s-10,24,20,3),i.beginPath(),i.moveTo(e-12,s-3),i.lineTo(e+12,s-3),i.strokePath();break}default:i.strokeCircle(e,s,8)}return i}_switchTab(t){this.activeTab!==t&&(this.activeTab=t,this._updateCatVisual(),this._renderList(!0))}_updateCatVisual(){var t;(t=this._catBtns)==null||t.forEach(({r:e,t:s,cat:i})=>{const o=i===this.activeTab;e.setFillStyle(o?2372171:1778224,1),e.setStrokeStyle(2,7066111,o?.6:.12),s.setColor(o?"#ffffff":"#c9d3e7"),s.setFontStyle(o?"bold":"normal")})}_scrollCats(t){var c;if(!((c=this._catBtns)!=null&&c.length))return;const e=Phaser.Math.Clamp(t,-60,60),s=this._catBtns[0].r,i=this._catBtns[this._catBtns.length-1].r,o=Math.round(this._catViewport.y-this._catViewport.h/2+8+s.height/2),n=Math.round(this._catViewport.y+this._catViewport.h/2-8-i.height/2);this.catRoot.iterate(d=>{d.y!=null&&(d.y-=e)});const r=s.y,h=i.y;let l=0;r>o&&(l=r-o),h<n&&(l=h-n),l&&this.catRoot.iterate(d=>{d.y!=null&&(d.y-=l)})}_getItemsForActiveTab(){var s;let e=[...((s=at.items)==null?void 0:s[this.activeTab])||[]];return e.sort((i,o)=>(i.level|0)-(o.level|0)||(i.price|0)-(o.price|0)||String(i.id).localeCompare(String(o.id))),e}_renderList(t=!1){this.cardsRoot.removeAll(!0);const e=this._getItemsForActiveTab(),s=14,i=4,o=Math.floor((this._listViewport.w-s*(i-1)-24)/i),n=Math.min(240,o),r=214;let h=0,l=Math.round(this._listViewport.y-this._listViewport.h/2)+12+r/2;const c=Math.round(this._listViewport.x-this._listViewport.w/2)+12+Math.floor((o-n)/2);for(const d of e){const f=c+h*o+n/2,u=this._makeCard(d,f,l,n,r);this.cardsRoot.add(u),h++,h>=i&&(h=0,l+=r+s)}this._listMinY=Math.round(this._listViewport.y-this._listViewport.h/2)+8+r/2,this._listMaxY=Math.max(this._listMinY,l),t&&(this.cardsRoot.setAlpha(0),this.s.tweens.add({targets:this.cardsRoot,alpha:1,duration:180,ease:"Sine.inOut"}))}_makeCard(t,e,s,i,o){var M,I;const n=this.depthBase+3,r=[],h=this.s.add.rectangle(e,s,i,o,1778224,1).setStrokeStyle(2,16777215,.14).setDepth(n).setInteractive();h.on("pointerover",()=>h.setFillStyle(2173502,1)),h.on("pointerout",()=>h.setFillStyle(1778224,1)),r.push(h);const l=90,c=this.s.add.rectangle(e,Math.round(s-o/2+l/2+8),i-16,l,988189,1).setStrokeStyle(2,16777215,.08).setDepth(n+1);r.push(c);const d=this.s.add.graphics().setDepth(n+2);d.lineStyle(2,7066111,.9),d.beginPath(),d.moveTo(c.x-(i-16)/2+10,c.y+20),d.lineTo(c.x-(i-16)/2+40,c.y-10),d.lineTo(c.x-(i-16)/2+70,c.y+10),d.lineTo(c.x-(i-16)/2+100,c.y-6),d.strokePath(),r.push(d);const f=this.s.add.text(e,c.y+c.height/2+6,t.name||t.id,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff",align:"center",wordWrap:{width:i-18}}).setOrigin(.5,0).setDepth(n+2);r.push(f);const u=this.s.add.text(e,f.y+f.height+2,this._statsText(t),{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#a9b7d0",align:"center",wordWrap:{width:i-18}}).setOrigin(.5,0).setDepth(n+2);r.push(u);const p=this.s.add.text(e-i/2+10,s+o/2-44,`–¢—Ä–µ–±. —É—Ä.: ${t.level??1}`,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#8ea6c9"}).setOrigin(0,1).setDepth(n+2);if(r.push(p),!t.contains&&this.activeTab!=="bait"&&this._owns(this.activeTab,t.id)){const x=this.s.add.text(e+i/2-10,s-o/2+10,"–£–∂–µ –µ—Å—Ç—å",{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#a7ffeb"}).setOrigin(1,0).setDepth(n+4);r.push(x)}const g=Math.min(160,i-18),_=this.s.add.rectangle(e,s+o/2-16,g,32,2792847,1).setStrokeStyle(2,16777215,.18).setDepth(n+2),b=`${t.price|0}ü™ô`,y=this.s.add.text(e,_.y,`–ö—É–ø–∏—Ç—å ‚Ä¢ ${b}`,{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#ffffff"}).setOrigin(.5).setDepth(n+3);r.push(_,y);const{canBuy:k,reason:P}=this._canBuy(t);if(k?_.setInteractive({useHandCursor:!0}).on("pointerover",()=>_.setFillStyle(3322787,1)).on("pointerout",()=>_.setFillStyle(2792847,1)).on("pointerdown",()=>this._attemptBuy(t)):(_.setFillStyle(4937064,1).disableInteractive(),y.setColor("#c7c7c7"),y.setText(P||"–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ")),!t.contains){let x="";if(this.activeTab==="bait"){const A=((M=this.inventory.bait)==null?void 0:M[t.id])|0;x=A?`–í –Ω–∞–ª–∏—á–∏–∏: ${A} —à—Ç.`:""}else if(this.activeTab==="hooks"){const A=((I=this.inventory.hookPacks)==null?void 0:I[t.id])|0;x=A?`–ö—Ä—é—á–∫–æ–≤: ${A} —à—Ç.`:""}if(x){const A=this.s.add.text(e,u.y+u.height+2,x,{fontFamily:"Arial, sans-serif",fontSize:"12px",color:"#a7ffeb"}).setOrigin(.5,0).setDepth(n+2);r.push(A)}}return r}_scrollList(t){var d;if(!((d=this.cardsRoot.list)!=null&&d.length))return;const e=Phaser.Math.Clamp(t,-80,80);this.cardsRoot.iterate(f=>{f.y!=null&&(f.y-=e)});const s=this.cardsRoot.list.filter(f=>(f==null?void 0:f.type)==="Rectangle");if(!s.length)return;const i=s[0],o=s[s.length-1],n=Math.round(this._listViewport.y-this._listViewport.h/2+12+i.height/2),r=Math.round(this._listViewport.y+this._listViewport.h/2-12-i.height/2),h=i.y,l=o.y;let c=0;h>n&&(c=h-n),l<r&&(c=l-r),c&&this.cardsRoot.iterate(f=>{f.y!=null&&(f.y-=c)})}_owns(t,e){if(t==="bait")return!1;const s=this.inventory[t]||[];return Array.isArray(s)&&s.includes(e)}_statsText(t){return t.contains?t.contains.map(s=>s.kind==="bait"?"–Ω–∞–∂–∏–≤–∫–∞ √ó"+(s.qty||0):{rods:"—É–¥–æ—á–∫–∞",reels:"–∫–∞—Ç—É—à–∫–∞",lines:"–ª–µ—Å–∫–∞",hooks:"–∫—Ä—é—á–æ–∫"}[s.kind]||s.kind).join(" ‚Ä¢ "):"capKg"in t?`–ü—Ä–æ—á–Ω–æ—Å—Ç—å: ${(+t.capKg).toFixed(2)} –∫–≥`:"pullBoost"in t?`–¢—è–≥–∞: √ó${(+t.pullBoost).toFixed(2)}`:"control"in t?`–ö–æ–Ω—Ç—Ä–æ–ª—å: √ó${(+t.control).toFixed(2)}`:"pack"in t?`–ü–∞—á–∫–∞: ${t.pack|0} —à—Ç.`:"keepnetCap"in t?`–°–∞–¥–æ–∫: ${t.keepnetCap|0} –º–µ—Å—Ç`:""}_canBuy(t){return this.level<(t.level??1)?{canBuy:!1,reason:"üîí –£—Ä–æ–≤–µ–Ω—å"}:(this.wallet.coins|0)<(t.price|0)?{canBuy:!1,reason:"–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç"}:!t.contains&&this.activeTab!=="bait"&&this.activeTab!=="accessories"&&this._owns(this.activeTab,t.id)?{canBuy:!1,reason:"–£–∂–µ –µ—Å—Ç—å"}:t.contains&&t.contains.every(s=>s.kind==="bait"?!1:(this.inventory[s.kind]||[]).includes(s.id))?{canBuy:!1,reason:"–ö–æ–º–ø–ª–µ–∫—Ç —É–∂–µ –µ—Å—Ç—å"}:{canBuy:!0,reason:""}}_attemptBuy(t){var i;const{canBuy:e,reason:s}=this._canBuy(t);if(!e){this._toast(s||"–ü–æ–∫—É–ø–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");return}if(this.wallet.coins=(this.wallet.coins|0)-(t.price|0),Dt(this.wallet),t.contains)for(const o of t.contains)this._grantItem(o.kind,o.id,o.qty||0);else{const o=this.activeTab,n=o==="bait"&&t.pack||0;this._grantItem(o,t.id,n,t)}if(ae({itemId:t.id,kind:this.activeTab}),t.contains)for(const o of t.contains)ae({itemId:o.id,kind:o.kind});Zs(this.inventory),(i=this._walletText)==null||i.setText(`ü™ô ${this.wallet.coins|0}   ‚òÖ ${this.wallet.gold|0}`),this._renderList(),this.onChange&&this.onChange(),this._toast("–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞")}_grantItem(t,e,s=0,i=null){var n;if(t==="bait"){const r=this.inventory.bait||(this.inventory.bait={});r[e]=(r[e]|0)+(s|0);return}if(t==="hooks"){const r=s||(i==null?void 0:i.pack)|0||5,h=this.inventory.hookPacks||(this.inventory.hookPacks={});h[e]=(h[e]|0)+r;const l=this.inventory.hooks||(this.inventory.hooks=[]);l.includes(e)||l.push(e);return}if(t==="accessories"){if(i&&i.keepnetCap){typeof this.s.keepnetCap=="number"&&(this.s.keepnetCap=i.keepnetCap|0);const r=(n=this.inventory).upgrades||(n.upgrades={});r.keepnetCap=i.keepnetCap|0}return}const o=this.inventory[t]||(this.inventory[t]=[]);o.includes(e)||o.push(e)}_toast(t){const e=this.s.add.text(Math.round(this.s.scale.width/2),Math.round(this.s.scale.height-64),t,{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(.5).setDepth(this.depthBase+10).setScrollFactor(0);this.s.tweens.add({targets:e,y:e.y-12,alpha:0,delay:600,duration:1600,onComplete:()=>e.destroy()})}close(){this._onWheel&&this.s.input.off("wheel",this._onWheel),this.kill.forEach(t=>{try{t.destroy()}catch{}}),this.onClose&&this.onClose()}}class ci{constructor(t,e,{x:s=320,y:i=46,width:o=420,showPerks:n=!0,labels:r={coins:"–°–µ—Ä–µ–±—Ä–æ",gold:"–ó–æ–ª–æ—Ç–æ",perks:"–ü–µ—Ä–∫–∏"}}={}){this.s=t,this.wallet=e||{coins:0,gold:0,perks:0},this.w=o,this.h=54,this.c=t.add.container(s,i).setDepth(952);const h=t.add.rectangle(0,0,this.w,this.h,1383207,1).setOrigin(.5).setStrokeStyle(2,16777215,.14),l=t.add.rectangle(0,-this.h/2+8,this.w-16,10,16777215,.05).setOrigin(.5);this.c.add([h,l]);const c=8,d=n?3:2,f=Math.floor((this.w-c*(d+1))/d),u=34,p=0;if(this.pillCoins=this._makePill(-this.w/2+c+f/2,p,f,u,2173500,this._icCoin.bind(this),r.coins),this.pillGold=this._makePill(this.pillCoins.grp.x+f/2+c+f/2,p,f,u,2765640,this._icGold.bind(this),r.gold),n){const g=this.pillGold.grp.x+f/2+c+f/2;this.pillPerk=this._makePill(g,p,f,u,2436673,this._icPerk.bind(this),r.perks)}this.set(this.wallet.coins|0,this.wallet.gold|0,this.wallet.perks|0)}set(t,e,s=0){this.coins=t|0,this.gold=e|0,this.perks=s|0,this.pillCoins.value.setText(String(this.coins)),this.pillGold.value.setText(String(this.gold)),this.pillPerk&&this.pillPerk.value.setText(String(this.perks))}setPosition(t,e){this.c.setPosition(t,e)}getBounds(){return new Phaser.Geom.Rectangle(this.c.x-this.w/2,this.c.y-this.h/2,this.w,this.h)}_makePill(t,e,s,i,o,n,r){const h=this.s.add.container(t,e);this.c.add(h);const l=this.s.add.rectangle(0,0,s,i,o,1).setOrigin(.5).setStrokeStyle(2,16777215,.12),c=this.s.add.rectangle(0,-i/2+5,s-10,8,16777215,.06).setOrigin(.5),d=this.s.add.graphics({x:-s/2+16,y:0});n(d,0,0);const f=this.s.add.text(d.x+18,-9,r,{fontFamily:"Arial, sans-serif",fontSize:"11px",color:"#a9b7d0"}).setOrigin(0,.5),u=this.s.add.text(d.x+18,8,"0",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#eaf2ff"}).setOrigin(0,.5),p=this.s.add.rectangle(s/2-14,0,22,22,16777215,.1).setOrigin(.5).setStrokeStyle(2,16777215,.14),g=this.s.add.text(p.x,p.y-1,"+",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#ffffff"}).setOrigin(.5);return h.add([l,c,d,f,u,p,g]),{grp:h,value:u}}_icCoin(t,e,s){t.fillStyle(16176227,1).fillCircle(e,s,8),t.fillStyle(16777215,.6).fillCircle(e-3,s-3,2),t.lineStyle(2,16777215,.18).strokeCircle(e,s,8)}_icGold(t,e,s){const n=[];for(let r=0;r<10;r++){const h=-Math.PI/2+r*Math.PI/5,l=r%2?3.6:8;n.push({x:e+Math.cos(h)*l,y:s+Math.sin(h)*l})}t.fillStyle(16770170,1).fillPoints(n,!0),t.lineStyle(2,16777215,.18).strokePoints(n,!0)}_icPerk(t,e,s){t.lineStyle(2,12179455,1),t.strokeCircle(e,s,8),t.beginPath(),t.moveTo(e-5,s),t.lineTo(e+5,s),t.moveTo(e,s-5),t.lineTo(e,s+5),t.strokePath()}}class di extends Phaser.Scene{constructor(){super("Base")}preload(){this.load.image("base_bg","assets/ui/base_bg.jpg")}create(t){var h,l,c,d,f,u,p,g;const e=((h=v==null?void 0:v.defaults)==null?void 0:h.call(v))??{wallet:{coins:0,gold:0},keepnet:[],keepnetCap:25};this.state=((l=v==null?void 0:v.get)==null?void 0:l.call(v,"state",t==null?void 0:t.state))??{},this.wallet=((c=v==null?void 0:v.get)==null?void 0:c.call(v,"wallet",t==null?void 0:t.wallet))??e.wallet,this.keepnet=((d=v==null?void 0:v.get)==null?void 0:d.call(v,"keepnet",t==null?void 0:t.keepnet))??e.keepnet,this.keepnetCap=((f=v==null?void 0:v.get)==null?void 0:f.call(v,"keepnetCap",t==null?void 0:t.keepnetCap))??e.keepnetCap,this.inventory=((u=v==null?void 0:v.get)==null?void 0:u.call(v,"inventory"))??{rods:["rod_wood_1"],reels:["reel_rusty"],lines:["line_old_1"],hooks:["hook_rusty"],bait:{worm:25}},this.playerLevel=((p=v==null?void 0:v.get)==null?void 0:p.call(v,"level"))??1;const s=this.scale.width,i=this.scale.height;this.bg=this.add.image(s/2,i/2,"base_bg").setDepth(-100).setOrigin(.5),this._fitCover(this.bg),this.bgDim=this.add.rectangle(s/2,i/2,s,i,725538,.42).setDepth(-99).setScrollFactor(0),this.add.text(12,10,"–ë–∞–∑–∞",{fontFamily:"Arial, sans-serif",fontSize:"26px",color:"#ffffff"}).setDepth(940).setOrigin(0,0),this.walletBadge=new ci(this,this.wallet,{x:300,y:36}),this.updateWallet(),this._makeBackButton(),this.menu=this.add.container(s/2,i/2).setDepth(950);const o=(m,_,{enabled:b=!0,icon:y=null}={})=>{const M=this.add.rectangle(0,0,360,56,b?2831178:2304056,1).setStrokeStyle(2,16777215,b?.18:.1).setOrigin(.5).setDepth(951);b?M.setInteractive({useHandCursor:!0}).on("pointerover",()=>M.setFillStyle(3292248,1)).on("pointerout",()=>M.setFillStyle(2831178,1)).on("pointerdown",_):M.setAlpha(.6);const I=this.add.text(0,0,`${y?y+" ":""}${m}`,{fontFamily:"Arial, sans-serif",fontSize:"20px",color:"#ffffff"}).setOrigin(.5).setDepth(952),x=this.add.container(0,0,[M,I]);return this.menu.add(x),x},n=[o("–ü—Ä–æ–¥–∞—Ç—å —Ä—ã–±—É",()=>this.openMarket(),{icon:"üß∫"}),o("–ú–∞–≥–∞–∑–∏–Ω",()=>this.openShop(),{enabled:!0,icon:"üõí"}),o("–£–ª—É—á—à–µ–Ω–∏—è (WIP)",()=>{},{enabled:!1,icon:"üõ†Ô∏è"}),o("–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (WIP)",()=>{},{enabled:!1,icon:"üéí"})],r=16;n.forEach((m,_)=>m.setPosition(0,_*(56+r))),this.add.text(s/2,i-10,"–ù–∞ ¬´–ë–∞–∑–µ¬ª –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ —Ä—ã–±–∞–ª–∫–∞. –ó–¥–µ—Å—å ‚Äî —Ç–æ—Ä–≥–æ–≤–ª—è, –ø–µ—Ä–∫–∏, –º–∞–≥–∞–∑–∏–Ω –∏ –ø—Ä.",{fontFamily:"Arial, sans-serif",fontSize:"14px",color:"#9fb1db"}).setOrigin(.5,1).setDepth(930),(g=this.input.keyboard)==null||g.on("keydown-ESC",()=>{this.commitToVM(),this.scene.start("Start")}),this.scale.on("resize",()=>this.layout()),this.layout()}commitToVM(){var t,e,s,i,o;(t=v.set)==null||t.call(v,"wallet",this.wallet),(e=v.set)==null||e.call(v,"keepnet",this.keepnet),(s=v.set)==null||s.call(v,"keepnetCap",this.keepnetCap),(i=v.set)==null||i.call(v,"inventory",this.inventory),(o=v.set)==null||o.call(v,"level",this.playerLevel)}layout(){var n,r;const t=this.scale.width,e=this.scale.height;this._fitCover(this.bg),this.menu.setPosition(t/2,Math.round(e*.4)),this.bgDim.setPosition(t/2,e/2),this.bgDim.setSize(t,e);const s=this._backBadge,i=t-150,o=36;(n=this._backBtn)==null||n.setPosition(i,o),(r=this._backLbl)==null||r.setPosition(i,o),s==null||s.setPosition(i+140,o)}_makeBackButton(){const e=this.scale.width-150,s=36,i=170,o=40;this._backBtn=this.add.rectangle(e,s,i,o,3555931,1).setStrokeStyle(2,16777215,.2).setDepth(953).setInteractive({useHandCursor:!0}).on("pointerover",()=>this._backBtn.setFillStyle(3951206,1)).on("pointerout",()=>this._backBtn.setFillStyle(3555931,1)).on("pointerdown",()=>{this.commitToVM(),this.scene.start("Start")}),this._backLbl=this.add.text(e,s,"‚Üê –ö –≤–æ–¥–æ—ë–º—É",{fontFamily:"Arial, sans-serif",fontSize:"18px",color:"#ffffff"}).setOrigin(.5).setDepth(954);const h=this.add.rectangle(e+140,s,86,30,2765640,1).setOrigin(.5).setStrokeStyle(2,16777215,.12).setDepth(954),l=this.add.text(h.x,h.y,"0/0",{fontFamily:"Arial, sans-serif",fontSize:"16px",color:"#eaf2ff"}).setOrigin(.5).setDepth(955);this._backBadge={r:h,t:l,setPosition:(c,d)=>{h.setPosition(c,d),l.setPosition(c,d)}},this.refreshKeepnetPill()}refreshKeepnetPill(){this._backBadge&&this._backBadge.t.setText(`${this.keepnet.length}/${this.keepnetCap}`)}updateWallet(){var t;(t=this.walletBadge)==null||t.set(this.wallet.coins|0,this.wallet.gold|0)}openMarket(){new hi(this,this.keepnet,this.wallet,()=>{this.updateWallet(),this.refreshKeepnetPill(),this.commitToVM(),Dt(this.wallet)},()=>{this.updateWallet(),this.refreshKeepnetPill(),this.commitToVM(),Dt(this.wallet)})}openShop(){new li(this,this.wallet,this.inventory,this.playerLevel,()=>{this.updateWallet(),this.commitToVM()},()=>{this.updateWallet(),this.commitToVM()})}_fitCover(t){const e=this.scale.width,s=this.scale.height,i=Math.max(e/t.width,s/t.height);t.setScale(i).setPosition(e/2,s/2)}}class fi extends Phaser.Scene{constructor(){super("Auth")}preload(){}create(){var d,f;const t=this.scale.width,e=this.scale.height,s=t/2,i=e/2,o=Math.min(420,t-60),n=300;this.add.rectangle(s,i,o,n,1053728,1).setStrokeStyle(2,16777215,.18),this.add.text(s,i-n/2+16,"–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è / –í—Ö—ñ–¥",{fontFamily:"Arial",fontSize:"20px",color:"#fff"}).setOrigin(.5,0),this.add.dom(s,i-20).createFromHTML(`
      <div style="display:flex; flex-direction:column; gap:8px; width:${o-60}px">
        <input id="email"    type="text" placeholder="Email –∞–±–æ username" style="padding:8px;border-radius:8px;border:1px solid #445;background:#0e1220;color:#fff" />
        <input id="username" type="text" placeholder="–ù—ñ–∫ (–¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó)" style="padding:8px;border-radius:8px;border:1px solid #445;background:#0e1220;color:#fff" />
        <input id="pass"     type="password" placeholder="–ü–∞—Ä–æ–ª—å" style="padding:8px;border-radius:8px;border:1px solid #445;background:#0e1220;color:#fff" />
        <div style="display:flex; gap:12px; margin-top:8px;">
          <button id="btnReg"  style="flex:1;padding:10px;border-radius:10px;border:none;background:#2b74ff;color:#fff">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
          <button id="btnLog"  style="flex:1;padding:10px;border-radius:10px;border:1px solid #5a6;color:#cfe">–£–≤—ñ–π—Ç–∏</button>
        </div>
        <div id="err" style="color:#f88; min-height:20px; font:12px Arial;"></div>
      </div>
    `);const r=document,h=u=>r.getElementById(u),l=u=>{const p=h("err");p&&(p.textContent=u||"")},c=async()=>{try{this.scene.start("Start",{})}catch{l("–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É")}};(d=h("btnReg"))==null||d.addEventListener("click",async()=>{l("");const u=h("email").value.trim(),p=h("username").value.trim(),g=h("pass").value;try{const m=await Ct.register(u,p,g);pt.token=m.token,await c()}catch{l("–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—è")}}),(f=h("btnLog"))==null||f.addEventListener("click",async()=>{l("");const u=h("email").value.trim(),p=h("pass").value;try{const g=await Ct.login(u,p);pt.token=g.token,await c()}catch{l("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ")}})}}(async()=>{var e;try{await pt.ensure()}catch{}const a=((e=pt==null?void 0:pt.user)==null?void 0:e.id)||"guest";if(v.init({persist:!0,key:`rf.vm.u:${a}`}),a!=="guest"){const s="rf.vm.u:guest";!localStorage.getItem(`rf.vm.u:${a}`)&&localStorage.getItem(s)&&localStorage.setItem(`rf.vm.u:${a}`,localStorage.getItem(s))}console.log("[BOOT] VM key =",v._lsKey,"raw =",localStorage.getItem(v._lsKey));const t={type:Phaser.AUTO,title:"Overlord Rising",description:"",parent:"game-container",width:1280,height:720,backgroundColor:"#000000",pixelArt:!1,scene:[si,di,fi],scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},dom:{createContainer:!0}};new Phaser.Game(t)})();
//# sourceMappingURL=index.js.map
